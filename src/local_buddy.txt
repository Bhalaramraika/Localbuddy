--- FILE: .env ---


--- FILE: README.md ---
# Firebase Studio

This is a NextJS starter in Firebase Studio.

To get started, take a look at src/app/page.tsx.

--- FILE: apphosting.yaml ---
# Settings to manage and configure a Firebase App Hosting backend.
# https://firebase.google.com/docs/app-hosting/configure

runConfig:
  # Increase this value if you'd like to automatically spin up
  # more instances in response to increased traffic.
  maxInstances: 1

--- FILE: components.json ---
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.ts",
    "css": "src/app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}
--- FILE: docs/backend.json ---
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the Local Buddy Pro application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user (matches auth.uid)."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "photoUrl": {
          "type": "string",
          "description": "URL of the user's profile photo.",
          "format": "uri"
        },
        "location": {
          "type": "string",
          "description": "The user's location (e.g., city, state)."
        },
        "walletBalance": {
          "type": "number",
          "description": "The user's current wallet balance."
        },
        "xp": {
          "type": "number",
          "description": "The user's experience points."
        },
        "level": {
          "type": "string",
          "description": "The user's current level (e.g., Rookie, Pro, Local Hero)."
        },
        "verificationStatus": {
          "type": "string",
          "description": "The user's verification status (e.g., pending, verified)."
        },
        "mobileVerified": {
          "type": "boolean",
          "description": "Indicates if the user's mobile number is verified."
        },
        "aadharVerified": {
          "type": "boolean",
          "description": "Indicates if the user's Aadhar/ID is verified."
        },
        "joinDate": {
          "type": "string",
          "description": "The date the user joined the platform.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "walletBalance"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task posted on the Local Buddy Pro platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the task."
        },
        "title": {
          "type": "string",
          "description": "The title of the task."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the task."
        },
        "category": {
          "type": "string",
          "description": "The category of the task (e.g., Household, Tech, Delivery)."
        },
        "budget": {
          "type": "number",
          "description": "The budget allocated for the task."
        },
        "location": {
          "type": "string",
          "description": "The location where the task needs to be performed."
        },
        "status": {
          "type": "string",
          "description": "The current status of the task (e.g., Open, Assigned, Completed)."
        },
        "posterId": {
          "type": "string",
          "description": "Reference to User who posted the task."
        },
        "buddyId": {
          "type": "string",
          "description": "Reference to User who is assigned to the task."
        },
        "deadline": {
          "type": "string",
          "description": "The deadline for the task completion.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "posterId",
        "budget",
        "status"
      ]
    },
    "Chat": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Chat",
      "type": "object",
      "description": "Represents a chat session between a poster and a buddy for a specific task.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat session."
        },
        "taskId": {
          "type": "string",
          "description": "Reference to Task that this chat is associated with."
        },
        "participantIds": {
          "type": "array",
          "description": "Array of user IDs participating in the chat.",
          "items": {
            "type": "string"
          }
        },
        "messages": {
          "type": "array",
          "description": "Array of messages in the chat session.",
          "items": {
            "type": "object",
            "properties": {
              "senderId": { "type": "string" },
              "text": { "type": "string" },
              "timestamp": { "type": "string", "format": "date-time" }
            }
          }
        }
      },
      "required": [
        "id",
        "taskId",
        "participantIds"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a transaction record (Lock, Release, Add, Withdraw).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User that initiated the transaction."
        },
        "taskId": {
          "type": "string",
          "description": "Reference to Task that the transaction is for (if applicable)."
        },
        "type": {
          "type": "string",
          "description": "The type of transaction (e.g., Lock, Release, Add, Withdraw)."
        },
        "amount": {
          "type": "number",
          "description": "The amount involved in the transaction."
        },
        "status": {
          "type": "string",
          "description": "The status of the transaction (e.g., Success, Pending, Failed)."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp of the transaction.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "type",
        "amount",
        "status",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "paths": {
      "/users/{userId}": {
        "schema": {
          "$ref": "#/entities/User"
        },
        "description": "Stores user profiles. Uses path-based ownership for private user data."
      },
      "/tasks/{taskId}": {
        "schema": {
          "$ref": "#/entities/Task"
        },
        "description": "Stores tasks posted on the platform. Includes 'posterId' to associate the task with the user who posted it, as well as 'buddyId' to save the user assigned to the task."
      },
      "/chats/{chatId}": {
        "schema": {
          "$ref": "#/entities/Chat"
        },
        "description": "Stores chat sessions between users for specific tasks. Includes 'taskId' and a list of participantIds to secure the chat."
      },
      "/transactions/{transactionId}": {
        "schema": {
          "$ref": "#/entities/Transaction"
        },
        "description": "Stores transaction records related to wallet operations. Includes 'userId' and 'taskId' to track user and task associations."
      }
    }
  }
}

--- FILE: firestore.rules ---
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // WARNING: This rule is for development only and is completely insecure.
    // It allows anyone (authenticated or not) to read and write to the entire database.
    // You MUST secure your database before going to production.
    match /{document=**} {
      allow read, write: if true;
    }
  }
}

--- FILE: next.config.ts ---

import type {NextConfig} from 'next';

const nextConfig: NextConfig = {
  /* config options here */
  typescript: {
    ignoreBuildErrors: true,
  },
  eslint: {
    ignoreDuringBuilds: true,
  },
  
  images: {
    unoptimized: true,
  },
};

export default nextConfig;

--- FILE: package.json ---
{
  "name": "nextn",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev --turbopack",
    "genkit:dev": "genkit start -- tsx src/ai/dev.ts",
    "genkit:watch": "genkit start -- tsx --watch src/ai/dev.ts",
    "build": "NODE_ENV=production next build",
    "start": "next start",
    "lint": "next lint",
    "typecheck": "tsc --noEmit"
  },
  "dependencies": {
    "@genkit-ai/google-genai": "^1.20.0",
    "@genkit-ai/next": "^1.20.0",
    "@hookform/resolvers": "^4.1.3",
    "@radix-ui/react-accordion": "^1.2.3",
    "@radix-ui/react-alert-dialog": "^1.1.6",
    "@radix-ui/react-avatar": "^1.1.3",
    "@radix-ui/react-checkbox": "^1.1.4",
    "@radix-ui/react-collapsible": "^1.1.11",
    "@radix-ui/react-dialog": "^1.1.6",
    "@radix-ui/react-dropdown-menu": "^2.1.6",
    "@radix-ui/react-label": "^2.1.2",
    "@radix-ui/react-menubar": "^1.1.6",
    "@radix-ui/react-popover": "^1.1.6",
    "@radix-ui/react-progress": "^1.1.2",
    "@radix-ui/react-radio-group": "^1.2.3",
    "@radix-ui/react-scroll-area": "^1.2.3",
    "@radix-ui/react-select": "^2.1.6",
    "@radix-ui/react-separator": "^1.1.2",
    "@radix-ui/react-slider": "^1.2.3",
    "@radix-ui/react-slot": "^1.2.3",
    "@radix-ui/react-switch": "^1.1.3",
    "@radix-ui/react-tabs": "^1.1.3",
    "@radix-ui/react-toast": "^1.2.6",
    "@radix-ui/react-tooltip": "^1.1.8",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "date-fns": "^3.6.0",
    "dotenv": "^16.5.0",
    "embla-carousel-react": "^8.6.0",
    "firebase": "^11.9.1",
    "framer-motion": "^11.5.10",
    "genkit": "^1.20.0",
    "lucide-react": "^0.475.0",
    "next": "15.3.3",
    "patch-package": "^8.0.0",
    "razorpay": "^2.9.4",
    "react": "^18.3.1",
    "react-day-picker": "^8.10.1",
    "react-dom": "^18.3.1",
    "react-hook-form": "^7.54.2",
e    "recharts": "^2.15.1",
    "tailwind-merge": "^3.0.1",
    "tailwindcss-animate": "^1.0.7",
    "zod": "^3.24.2"
  },
  "devDependencies": {
    "@types/node": "^20",
    "@types/react": "^18",
    "@types/react-dom": "^18",
    "genkit-cli": "^1.20.0",
    "postcss": "^8",
    "tailwindcss": "^3.4.1",
    "typescript": "^5"
  }
}

--- FILE: src/ai/dev.ts ---

import './flows/suggestion-flow';
import './flows/description-flow';

--- FILE: src/ai/flows/description-flow.ts ---
'use server';

import { ai } from '@/ai/genkit';
import { GenerateDescriptionInputSchema, GenerateDescriptionOutputSchema, type GenerateDescriptionInput, type GenerateDescriptionOutput } from '@/ai/schemas/description-schema';

const descriptionPrompt = ai.definePrompt({
    name: 'generateDescriptionPrompt',
    input: { schema: GenerateDescriptionInputSchema },
    output: { schema: GenerateDescriptionOutputSchema },
    prompt: `Generate a concise, clear, and compelling task description of up to 50 words based on the following task title:

Task Title: "{{title}}"

The description should briefly explain what the task involves and what is expected. It should be written in a way that is easy to understand for a general audience.
`,
});

const generateDescriptionFlow = ai.defineFlow(
  {
    name: 'generateDescriptionFlow',
    inputSchema: GenerateDescriptionInputSchema,
    outputSchema: GenerateDescriptionOutputSchema,
  },
  async (input) => {
    const { output } = await descriptionPrompt(input);
    if (!output) {
      throw new Error('AI failed to generate a description.');
    }
    return output;
  }
);

export async function generateDescription(input: GenerateDescriptionInput): Promise<GenerateDescriptionOutput> {
  return generateDescriptionFlow(input);
}

--- FILE: src/ai/flows/suggestion-flow.ts ---

'use server';

import { ai } from '@/ai/genkit';
import { TaskSuggestionInputSchema, TaskSuggestionOutputSchema, type TaskSuggestionInput, type TaskSuggestionOutput } from '@/ai/schemas/suggestion-schema';


const suggestionPrompt = ai.definePrompt({
    name: 'taskSuggestionPrompt',
    input: { schema: TaskSuggestionInputSchema },
    output: { schema: TaskSuggestionOutputSchema },
    prompt: `You are a helpful assistant in a cyberpunk-themed task-runner app. Your goal is to suggest relevant and interesting tasks to users.

    Based on the user's profile, suggest 3-5 tasks.

    User Profile:
    - Skills: {{#each userSkills}}{{{this}}}{{#unless @last}}, {{/unless}}{{/each}}
    {{#if currentLocation}}- Location: {{{currentLocation}}}{{/if}}

    {{#if taskHistory}}
    Task History:
    {{#each taskHistory}}
    - "{{{title}}}" (Category: {{{category}}})
    {{/each}}
    {{/if}}

    For each suggestion, provide a catchy title, a relevant category from this list (Household, Tech, Cleaning, Delivery, Tutoring, Other), a brief reasoning for the suggestion, and an estimated earning. The reasoning should be encouraging and align with the cyberpunk theme. Ensure the output is a valid JSON object matching the provided schema.
    `,
});


const getTaskSuggestionsFlow = ai.defineFlow(
  {
    name: 'getTaskSuggestionsFlow',
    inputSchema: TaskSuggestionInputSchema,
    outputSchema: TaskSuggestionOutputSchema,
  },
  async (input) => {
    const { output } = await suggestionPrompt(input);
    if (!output) {
      throw new Error('AI failed to generate task suggestions.');
    }
    return output;
  }
);


export async function getTaskSuggestions(input: TaskSuggestionInput): Promise<TaskSuggestionOutput> {
  return getTaskSuggestionsFlow(input);
}

--- FILE: src/ai/genkit.ts ---
import {genkit} from 'genkit';
import {googleAI} from '@genkit-ai/google-genai';

// If you have a GEMINI_API_KEY in your environment, you can omit the apiKey parameter.
// The .env file is a good place to put your API key.
export const ai = genkit({
  plugins: [googleAI({apiKey: process.env.GEMINI_API_KEY})],
  model: googleAI.model('gemini-2.5-flash'),
});

--- FILE: src/ai/schemas/description-schema.ts ---
import { z } from 'zod';

export const GenerateDescriptionInputSchema = z.object({
  title: z.string().describe("The title of the task for which to generate a description."),
});

export type GenerateDescriptionInput = z.infer<typeof GenerateDescriptionInputSchema>;

export const GenerateDescriptionOutputSchema = z.object({
  description: z.string().describe('The generated task description.'),
});

export type GenerateDescriptionOutput = z.infer<typeof GenerateDescriptionOutputSchema>;

--- FILE: src/ai/schemas/suggestion-schema.ts ---
import { z } from 'zod';

export const TaskSuggestionInputSchema = z.object({
  userSkills: z.array(z.string()).describe("A list of the user's skills."),
  currentLocation: z.string().optional().describe("The user's current general location (e.g., city or neighborhood)."),
  taskHistory: z.array(z.object({
    title: z.string(),
    category: z.string(),
    completed: z.boolean(),
  })).optional().describe('A list of tasks the user has previously interacted with.'),
});

export type TaskSuggestionInput = z.infer<typeof TaskSuggestionInputSchema>;

export const TaskSuggestionOutputSchema = z.object({
  suggestions: z.array(z.object({
    title: z.string().describe('The suggested task title.'),
    category: z.string().describe('The category of the task.'),
    reasoning: z.string().describe('A brief explanation for why this task is a good suggestion for the user.'),
    estimatedEarning: z.number().describe('An estimated earning potential for this task in the local currency.'),
  })),
});

export type TaskSuggestionOutput = z.infer<typeof TaskSuggestionOutputSchema>;

--- FILE: src/app/(main)/layout.tsx ---

'use client';
import { Home, Wallet, MessageSquare, User as UserIcon, Plus } from 'lucide-react';
import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { cn } from '@/lib/utils';
import { useUser } from '@/firebase';
import { Loader } from 'lucide-react';
import * as React from 'react';
import { ProfileSetupDialog } from '@/components/ProfileSetupDialog';

export default function MainAppLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const pathname = usePathname();
  const { user, isUserLoading, userData, isUserDataLoading } = useUser();
  const [isProfileSetupOpen, setIsProfileSetupOpen] = React.useState(false);

  const navItems = [
    { href: '/', label: 'Home', icon: Home },
    { href: '/wallet', label: 'Wallet', icon: Wallet },
    { href: '/tasks/create', label: 'Create', icon: Plus, isCenter: true },
    { href: '/chat', label: 'Chat', icon: MessageSquare },
    { href: '/profile', label: 'Profile', icon: UserIcon },
  ];

  const isAuthPage = pathname.startsWith('/auth') || pathname.startsWith('/admin');

  if (isUserLoading && !isAuthPage) {
    return (
      <div className="w-full h-screen flex flex-col items-center justify-center">
        <Loader className="w-12 h-12 animate-spin text-main-accent" />
        <p className="mt-4 text-lg text-gray-600">Loading your space...</p>
      </div>
    );
  }

  const showNav = user && !isAuthPage && !isProfileSetupOpen;
  const showProfileDialog = user && !isUserDataLoading && userData && !userData.profileCompleted;

  if (isAuthPage) {
    return <>{children}</>;
  }

  return (
    <div className="w-full max-w-md mx-auto flex flex-col gap-6 text-foreground pb-28">
      {showProfileDialog && <ProfileSetupDialog onOpenChange={setIsProfileSetupOpen} />}
      {children}
      {showNav && (
        <footer className="fixed bottom-5 left-1/2 -translate-x-1/2 w-full max-w-[340px] z-50">
          <nav className="glass-card flex items-center justify-around p-2.5 rounded-full">
            {navItems.map((item) => {
              const isActive = pathname === item.href;

              if (item.isCenter) {
                return (
                  <Link href={item.href} key={item.label}>
                    <div className={cn(
                      'w-14 h-14 bg-main-accent rounded-full flex items-center justify-center cursor-pointer transition-transform duration-300 hover:scale-110 shadow-lg shadow-black/30',
                      isActive ? 'ring-4 ring-white/50' : ''
                    )}>
                      <item.icon className="w-8 h-8 text-white" />
                    </div>
                  </Link>
                );
              }

              return (
                <Link
                  key={item.label}
                  href={item.href}
                  className={cn(
                    'flex flex-col items-center gap-1 transition-colors w-16',
                    isActive ? 'text-main-accent' : 'text-gray-500 hover:text-main-accent'
                  )}
                >
                  <div className={cn('p-2 rounded-full transition-all duration-300', isActive ? 'bg-main-accent/20' : '')}>
                    <item.icon className="w-5 h-5" style={isActive ? { filter: 'drop-shadow(0 0 5px var(--main-accent))' } : {}} />
                  </div>
                </Link>
              );
            })}
          </nav>
        </footer>
      )}
    </div>
  );
}

--- FILE: src/app/admin/layout.tsx ---

'use client';
import { Home, Users, BarChart2, Settings, LifeBuoy } from 'lucide-react';
import { SidebarProvider, Sidebar, SidebarTrigger, SidebarMenu, SidebarMenuItem, SidebarMenuButton, SidebarHeader, SidebarContent, SidebarFooter, SidebarInset } from '@/components/ui/sidebar';
import * as React from 'react';
import Link from 'next/link';
import { usePathname } from 'next/navigation';

export default function AdminLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const pathname = usePathname();

  const isActive = (path: string) => {
    return pathname === path;
  };

  return (
    <SidebarProvider>
      <div className="w-full min-h-screen flex">
        <Sidebar collapsible="icon" side="left" variant="sidebar" className="glass-card !bg-transparent !border-0">
          <SidebarContent className="p-2">
            <SidebarHeader>
              <div className="flex items-center justify-between p-2">
                <span className="text-2xl font-bold text-main-accent">Admin</span>
                <SidebarTrigger />
              </div>
            </SidebarHeader>
            <SidebarMenu>
              <SidebarMenuItem>
                <Link href="/admin" passHref>
                  <SidebarMenuButton tooltip="Dashboard" isActive={isActive('/admin')}>
                    <Home />
                    <span>Dashboard</span>
                  </SidebarMenuButton>
                </Link>
              </SidebarMenuItem>
              <SidebarMenuItem>
                <Link href="/admin/users" passHref>
                  <SidebarMenuButton tooltip="Users" isActive={isActive('/admin/users')}>
                    <Users />
                    <span>Users</span>
                  </SidebarMenuButton>
                </Link>
              </SidebarMenuItem>
              <SidebarMenuItem>
                <Link href="/admin/analytics" passHref>
                  <SidebarMenuButton tooltip="Analytics" isActive={isActive('/admin/analytics')}>
                    <BarChart2 />
                    <span>Analytics</span>
                  </SidebarMenuButton>
                </Link>
              </SidebarMenuItem>
            </SidebarMenu>
          </SidebarContent>
          <SidebarFooter>
            <SidebarMenu>
              <SidebarMenuItem>
                <Link href="/admin/settings" passHref>
                  <SidebarMenuButton tooltip="Settings" isActive={isActive('/admin/settings')}>
                    <Settings />
                    <span>Settings</span>
                  </SidebarMenuButton>
                </Link>
              </SidebarMenuItem>
              <SidebarMenuItem>
                <SidebarMenuButton tooltip="Support">
                  <LifeBuoy />
                  <span>Support</span>
                </SidebarMenuButton>
              </SidebarMenuItem>
            </SidebarMenu>
          </SidebarFooter>
        </Sidebar>
        <SidebarInset className="p-4 md:p-8 !m-0 !bg-transparent w-full">
            {children}
        </SidebarInset>
      </div>
    </SidebarProvider>
  );
}

--- FILE: src/app/admin/page.tsx ---

'use client';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Users, Briefcase, IndianRupee, Activity } from 'lucide-react';
import { ChartContainer, ChartTooltip, ChartTooltipContent } from '@/components/ui/chart';
import { Bar, BarChart, CartesianGrid, XAxis, YAxis, ResponsiveContainer } from 'recharts';

const chartData = [
  { month: "January", total: Math.floor(Math.random() * 5000) + 1000 },
  { month: "February", total: Math.floor(Math.random() * 5000) + 1000 },
  { month: "March", total: Math.floor(Math.random() * 5000) + 1000 },
  { month: "April", total: Math.floor(Math.random() * 5000) + 1000 },
  { month: "May", total: Math.floor(Math.random() * 5000) + 1000 },
  { month: "June", total: Math.floor(Math.random() * 5000) + 1000 },
  { month: "July", total: Math.floor(Math.random() * 5000) + 1000 },
  { month: "August", total: Math.floor(Math.random() * 5000) + 1000 },
  { month: "September", total: Math.floor(Math.random() * 5000) + 1000 },
  { month: "October", total: Math.floor(Math.random() * 5000) + 1000 },
  { month: "November", total: Math.floor(Math.random() * 5000) + 1000 },
  { month: "December", total: Math.floor(Math.random() * 5000) + 1000 },
];

const chartConfig = {
  total: {
    label: "Total",
    color: "hsl(var(--chart-1))",
  },
};

export default function AdminDashboard() {
  return (
    <div className="flex flex-col gap-8 text-foreground">
      <h1 className="text-4xl font-bold text-main-accent">Admin Dashboard</h1>

      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
        <Card className="glass-card">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium text-gray-500">Total Revenue</CardTitle>
            <IndianRupee className="h-4 w-4 text-green-500" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">₹45,231.89</div>
            <p className="text-xs text-muted-foreground">+20.1% from last month</p>
          </CardContent>
        </Card>
        <Card className="glass-card">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium text-gray-500">Active Users</CardTitle>
            <Users className="h-4 w-4 text-main-accent" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">+2350</div>
            <p className="text-xs text-muted-foreground">+180.1% from last month</p>
          </CardContent>
        </Card>
        <Card className="glass-card">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium text-gray-500">Tasks Completed</CardTitle>
            <Briefcase className="h-4 w-4 text-secondary-accent" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">+12,234</div>
            <p className="text-xs text-muted-foreground">+19% from last month</p>
          </CardContent>
        </Card>
        <Card className="glass-card">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium text-gray-500">Platform Activity</CardTitle>
            <Activity className="h-4 w-4 text-destructive-accent" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">+573</div>
            <p className="text-xs text-muted-foreground">+201 since last hour</p>
          </CardContent>
        </Card>
      </div>

      <div className="glass-card p-4">
        <h2 className="text-xl font-bold mb-4">Revenue Overview</h2>
        <ChartContainer config={chartConfig} className="min-h-[200px] w-full">
            <ResponsiveContainer width="100%" height={350}>
                <BarChart data={chartData}>
                    <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="rgba(0,0,0,0.1)" />
                    <XAxis
                    dataKey="month"
                    stroke="#666"
                    fontSize={12}
                    tickLine={false}
                    axisLine={false}
                    />
                    <YAxis
                    stroke="#666"
                    fontSize={12}
                    tickLine={false}
                    axisLine={false}
                    tickFormatter={(value) => `₹${value}`}
                    />
                    <ChartTooltip 
                        cursor={false}
                        content={<ChartTooltipContent 
                            labelClassName="text-black font-bold" 
                            className="bg-white/80 backdrop-blur-sm !border-main-accent" 
                        />}
                    />
                    <Bar dataKey="total" fill="var(--main-accent)" radius={[4, 4, 0, 0]} />
                </BarChart>
          </ResponsiveContainer>
        </ChartContainer>
      </div>
    </div>
  );
}

--- FILE: src/app/api/genkit/[[...path]]/route.ts ---
import {nextHandler} from '@genkit-ai/next';
import '@/ai/dev';

export const POST = nextHandler();

--- FILE: src/app/api/razorpay/route.ts ---
import { NextRequest, NextResponse } from 'next/server';
import Razorpay from 'razorpay';
import { z } from 'zod';

const orderSchema = z.object({
  amount: z.number().int().min(100, { message: "Amount must be at least ₹1 (100 paise)." }),
  currency: z.string().default('INR'),
});

export async function POST(req: NextRequest) {
  const keyId = process.env.RAZORPAY_KEY_ID;
  const keySecret = process.env.RAZORPAY_KEY_SECRET;

  if (!keyId || !keySecret) {
    console.error("Razorpay keys are not defined in environment variables.");
    return NextResponse.json(
      { error: "Payment gateway is not configured. Please contact support." },
      { status: 500 }
    );
  }

  try {
    const body = await req.json();
    const parsedBody = orderSchema.safeParse(body);

    if (!parsedBody.success) {
      return NextResponse.json({ error: "Invalid request body", details: parsedBody.error.errors }, { status: 400 });
    }

    const { amount, currency } = parsedBody.data;

    const razorpay = new Razorpay({
      key_id: keyId,
      key_secret: keySecret,
    });

    const options = {
      amount,
      currency,
      receipt: `receipt_order_${new Date().getTime()}`,
    };

    const order = await razorpay.orders.create(options);

    return NextResponse.json(order, { status: 200 });
  } catch (error) {
    console.error('Error creating Razorpay order:', error);
    const errorMessage = error instanceof Error ? error.message : "An unknown error occurred";
    return NextResponse.json({ error: "Failed to create payment order.", details: errorMessage }, { status: 500 });
  }
}

--- FILE: src/app/auth/AuthForm.tsx ---
'use client';

import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import { Button } from '@/components/ui/button';
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form';
import { Input } from '@/components/ui/input';
import { useToast } from '@/hooks/use-toast';
import { useAuth, useUser } from '@/firebase';
import {
  initiateEmailSignUp,
  initiateEmailSignIn,
  initiateGoogleSignIn,
} from '@/firebase/non-blocking-login';
import * as React from 'react';
import { Loader } from 'lucide-react';
import { useRouter } from 'next/navigation';
import { GoogleIcon } from '@/components/ui/icons';

const formSchema = z.object({
  email: z.string().email({ message: 'Invalid email address.' }),
  password: z
    .string()
    .min(6, { message: 'Password must be at least 6 characters.' }),
});

type AuthFormProps = {
  mode: 'login' | 'signup';
};

export default function AuthForm({ mode }: AuthFormProps) {
  const { toast } = useToast();
  const auth = useAuth();
  const { user, isUserLoading } = useUser();
  const router = useRouter();

  const [isLoading, setIsLoading] = React.useState(false);

  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      email: '',
      password: '',
    },
  });
  
  React.useEffect(() => {
    if (!isUserLoading && user) {
      router.replace('/');
    }
  }, [user, isUserLoading, router]);


  const handleGoogleSignIn = () => {
    setIsLoading(true);
    initiateGoogleSignIn(auth);
  }

  const onSubmit = async (values: z.infer<typeof formSchema>) => {
    setIsLoading(true);
    try {
      if (mode === 'signup') {
        await initiateEmailSignUp(auth, values.email, values.password);
        toast({
          title: 'Account Created!',
          description: "We're setting up your profile. Redirecting...",
        });

      } else {
        await initiateEmailSignIn(auth, values.email, values.password);
        toast({
          title: 'Logging In...',
          description: 'Authenticating your credentials.',
        });
      }
    } catch (error: any) {
      toast({
        variant: 'destructive',
        title: 'Authentication Failed',
        description: error.message || 'An unknown error occurred.',
      });
      setIsLoading(false);
    }
  };

  if (isUserLoading || user) {
    return (
       <div className="w-full h-screen flex flex-col items-center justify-center">
        <Loader className="w-12 h-12 animate-spin text-main-accent" />
        <p className="mt-4 text-lg text-gray-600">Checking credentials...</p>
      </div>
    )
  }

  return (
    <div className="glass-card p-8">
      <Form {...form}>
        <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
          <FormField
            control={form.control}
            name="email"
            render={({ field }) => (
              <FormItem>
                <FormLabel>Email</FormLabel>
                <FormControl>
                  <Input
                    placeholder="you@example.com"
                    {...field}
                    className="glass-card"
                    disabled={isLoading}
                  />
                </FormControl>
                <FormMessage />
              </FormItem>
            )}
          />
          <FormField
            control={form.control}
            name="password"
            render={({ field }) => (
              <FormItem>
                <FormLabel>Password</FormLabel>
                <FormControl>
                  <Input
                    type="password"
                    placeholder="••••••••"
                    {...field}
                    className="glass-card"
                    disabled={isLoading}
                  />
                </FormControl>
                <FormMessage />
              </FormItem>
            )}
          />
          <Button type="submit" className="w-full h-12 text-lg font-bold cyan-glow-button" disabled={isLoading}>
            {isLoading && <Loader className="mr-2 h-5 w-5 animate-spin" />}
            {mode === 'login' ? 'Log In' : 'Sign Up'}
          </Button>
        </form>
      </Form>
      <div className="relative my-6">
        <div className="absolute inset-0 flex items-center">
          <span className="w-full border-t border-gray-300" />
        </div>
        <div className="relative flex justify-center text-xs uppercase">
          <span className="bg-white/60 px-2 text-gray-500 backdrop-blur-sm">Or continue with</span>
        </div>
      </div>
      <Button variant="outline" className="w-full h-12 text-md glass-card border-gray-300 hover:bg-gray-100 hover:text-foreground transition-all transform hover:scale-105" onClick={handleGoogleSignIn} disabled={isLoading}>
          {isLoading ? <Loader className="mr-3 h-5 w-5 animate-spin" /> : <GoogleIcon className="mr-3 h-5 w-5" />}
          Continue with Google
      </Button>
    </div>
  );
}
--- FILE: src/app/auth/MobileAuthForm.tsx ---

'use client';

import { useForm, Controller } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import { Button } from '@/components/ui/button';
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form';
import { Input } from '@/components/ui/input';
import { useToast } from '@/hooks/use-toast';
import { useAuth, useUser } from '@/firebase';
import {
  initiatePhoneNumberSignIn,
  confirmOtpCode,
} from '@/firebase/non-blocking-login';
import * as React from 'react';
import { Loader } from 'lucide-react';
import { useRouter } from 'next/navigation';
import type { ConfirmationResult, RecaptchaVerifier } from 'firebase/auth';
import { RecaptchaVerifier as FirebaseRecaptchaVerifier } from 'firebase/auth';

const phoneSchema = z.object({
  countryCode: z.string().startsWith('+', "Country code must start with '+'").min(2),
  phone: z.string().length(10, 'Please enter a valid 10-digit phone number.'),
});

const otpSchema = z.object({
  otp: z.string().length(6, 'OTP must be 6 digits.'),
});

export default function MobileAuthForm() {
  const { toast } = useToast();
  const auth = useAuth();
  const { user, isUserLoading } = useUser();
  const router = useRouter();

  const [isLoading, setIsLoading] = React.useState(false);
  const [step, setStep] = React.useState<'phone' | 'otp'>('phone');
  const [confirmationResult, setConfirmationResult] = React.useState<ConfirmationResult | null>(null);
  const [fullPhoneNumber, setFullPhoneNumber] = React.useState('');
  
  const recaptchaVerifierRef = React.useRef<RecaptchaVerifier | null>(null);
  const recaptchaContainerRef = React.useRef<HTMLDivElement>(null);


  const phoneForm = useForm<z.infer<typeof phoneSchema>>({
    resolver: zodResolver(phoneSchema),
    defaultValues: {
      countryCode: '+91',
      phone: '',
    },
  });

  const otpForm = useForm<z.infer<typeof otpSchema>>({
    resolver: zodResolver(otpSchema),
    defaultValues: {
      otp: '',
    },
  });

  React.useEffect(() => {
    if (auth && !recaptchaVerifierRef.current && step === 'phone' && recaptchaContainerRef.current) {
        recaptchaVerifierRef.current = new FirebaseRecaptchaVerifier(auth, recaptchaContainerRef.current, {
            'size': 'compact',
            'callback': () => {},
            'expired-callback': () => {}
        });
        recaptchaVerifierRef.current.render();
    }
  }, [auth, step]);


  React.useEffect(() => {
    if (!isUserLoading && user) {
      router.replace('/');
    }
  }, [user, isUserLoading, router]);

  const onPhoneSubmit = async (values: z.infer<typeof phoneSchema>) => {
    setIsLoading(true);
    const appVerifier = recaptchaVerifierRef.current;
    if (!appVerifier) {
        toast({ variant: 'destructive', title: 'reCAPTCHA not initialized.' });
        setIsLoading(false);
        return;
    }

    const phoneNumber = `${values.countryCode}${values.phone}`;
    setFullPhoneNumber(phoneNumber);

    try {
        const confirmation = await initiatePhoneNumberSignIn(
            auth,
            phoneNumber,
            appVerifier
        );
        setConfirmationResult(confirmation);
        setStep('otp');
        toast({ title: 'OTP Sent!', description: `An OTP has been sent to ${phoneNumber}.` });
    } catch (error: any) {
        console.error("OTP Send Error:", error);
        let description = error.message || 'An unknown error occurred. Please ensure your domain is authorized in Firebase console.';
        if (error.code === 'auth/billing-not-enabled') {
            description = 'The free quota for this project has been exceeded. Please enable billing in your Firebase project to continue.';
        } else if (error.code === 'auth/too-many-requests') {
            description = 'Too many requests. Please try again later.';
        }
        toast({
            variant: 'destructive',
            title: 'Failed to Send OTP',
            description: description,
        });
        
        if(window.grecaptcha && recaptchaVerifierRef.current?.widgetId !== undefined) {
             window.grecaptcha.reset(recaptchaVerifierRef.current.widgetId);
        }

    } finally {
        setIsLoading(false);
    }
  };


  const onOtpSubmit = async (values: z.infer<typeof otpSchema>) => {
    setIsLoading(true);
    if (!confirmationResult) {
      toast({ variant: 'destructive', title: 'Verification session expired. Please try again.' });
      setIsLoading(false);
      setStep('phone');
      return;
    }
    try {
      await confirmOtpCode(confirmationResult, values.otp);
      toast({ title: 'Success!', description: 'You are now logged in.' });
    } catch (error: any) {
      toast({
        variant: 'destructive',
        title: 'Invalid OTP',
        description: error.message || 'The OTP you entered is incorrect.',
      });
      setIsLoading(false);
    }
  };

  if (isUserLoading || user) {
    return (
       <div className="w-full h-screen flex flex-col items-center justify-center">
        <Loader className="w-12 h-12 animate-spin text-main-accent" />
        <p className="mt-4 text-lg text-gray-600">Checking credentials...</p>
      </div>
    )
  }

  return (
    <div className="glass-card p-8">
      {step === 'phone' ? (
        <Form {...phoneForm}>
          <form onSubmit={phoneForm.handleSubmit(onPhoneSubmit)} className="space-y-6">
             <FormItem>
                <FormLabel>Mobile Number</FormLabel>
                <div className="flex items-center gap-2">
                    <FormField
                        control={phoneForm.control}
                        name="countryCode"
                        render={({ field }) => (
                            <FormControl>
                                <Input {...field} className="glass-card w-20" />
                            </FormControl>
                        )}
                    />
                    <FormField
                        control={phoneForm.control}
                        name="phone"
                        render={({ field }) => (
                            <FormControl>
                                <Input
                                    placeholder="98765 43210"
                                    {...field}
                                    className="glass-card flex-1"
                                    type="tel"
                                    inputMode="numeric"
                                    maxLength={10}
                                />
                            </FormControl>
                        )}
                    />
                </div>
                <FormMessage>{phoneForm.formState.errors.phone?.message || phoneForm.formState.errors.countryCode?.message}</FormMessage>
             </FormItem>
            
            <div ref={recaptchaContainerRef} id="recaptcha-container" className="flex justify-center my-4"></div>

            <Button 
                type="submit" 
                className="w-full h-12 text-lg font-bold cyan-glow-button" 
                disabled={isLoading}
            >
              {isLoading && <Loader className="mr-2 h-5 w-5 animate-spin" />}
              Send OTP
            </Button>
          </form>
        </Form>
      ) : (
        <Form {...otpForm}>
          <form onSubmit={otpForm.handleSubmit(onOtpSubmit)} className="space-y-6">
             <p className="text-center text-sm text-gray-500">
                Enter the OTP sent to {fullPhoneNumber}
             </p>
            <FormField
              control={otpForm.control}
              name="otp"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Enter OTP</FormLabel>
                  <FormControl>
                    <Input 
                      placeholder="123456" 
                      {...field} 
                      className="glass-card text-center tracking-[1rem]" 
                      maxLength={6} 
                      type="tel"
                      inputMode="numeric"
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            <Button type="submit" className="w-full h-12 text-lg font-bold cyan-glow-button" disabled={isLoading}>
              {isLoading && <Loader className="mr-2 h-5 w-5 animate-spin" />}
              Verify OTP
            </Button>
             <Button variant="link" size="sm" onClick={() => setStep('phone')} className="w-full">
                Change Number
             </Button>
          </form>
        </Form>
      )}
    </div>
  );
}

--- FILE: src/app/auth/layout.tsx ---
'use client';

export default function AuthLayout({
    children,
}: {
    children: React.ReactNode;
}) {
    // This div container is kept to center the auth forms on the page.
    return (
        <div className="w-full max-w-md mx-auto flex flex-col gap-8 text-foreground min-h-[calc(100vh-100px)] justify-center">
            {children}
        </div>
    );
}

--- FILE: src/app/auth/login/page.tsx ---
'use client';
import Link from "next/link";
import AuthForm from "../AuthForm";
import MobileAuthForm from "../MobileAuthForm";
import { useState } from 'react';
import { Button } from "@/components/ui/button";

export default function LoginPage() {
    const [authMethod, setAuthMethod] = useState<'email' | 'mobile'>('email');

    return (
        <>
            <header className="text-center">
                <h1 className="text-4xl font-bold text-main-accent">Welcome Back</h1>
                <p className="text-gray-500 mt-2">Log in to continue your journey in the cyber-verse.</p>
            </header>
            
            {authMethod === 'email' ? <AuthForm mode="login" /> : <MobileAuthForm />}

            <div className="text-center mt-4">
                <Button variant="link" onClick={() => setAuthMethod(authMethod === 'email' ? 'mobile' : 'email')}>
                    {authMethod === 'email' ? 'Continue with Mobile' : 'Continue with Email'}
                </Button>
            </div>

            <p className="text-center text-sm text-gray-500 mt-6">
                Don&apos;t have an account?{' '}
                <Link href="/auth/signup" className="font-semibold text-main-accent hover:underline">
                    Sign up
                </Link>
            </p>
        </>
    );
}

--- FILE: src/app/auth/signup/page.tsx ---
'use client';
import Link from "next/link";
import AuthForm from "../AuthForm";

export default function SignupPage() {
    return (
        <>
            <header className="text-center">
                <h1 className="text-4xl font-bold text-main-accent">Create Your Identity</h1>
                <p className="text-gray-500 mt-2">Join the ranks of elite task runners.</p>
            </header>
            <AuthForm mode="signup" />
            <p className="text-center text-sm text-gray-500 mt-6">
                Already have an account?{' '}
                <Link href="/auth/login" className="font-semibold text-main-accent hover:underline">
                    Log in
                </Link>
            </p>
        </>
    );
}

--- FILE: src/app/chat/page.tsx ---

'use client';
import Image from 'next/image';
import { Phone, Mic, MoreVertical, Paperclip, Send, Camera, Play, Pause, Trash2, FileText, MapPin, Loader, IndianRupee, MessageCircle } from 'lucide-react';
import { PlaceHolderImages } from '@/lib/placeholder-images';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import * as React from 'react';
import { cn, timeAgo } from '@/lib/utils';
import { ScrollArea } from '@/components/ui/scroll-area';
import { useSearchParams, useRouter } from 'next/navigation';
import { useUser, useFirestore, useDoc, useMemoFirebase, updateDocumentNonBlocking, addDocumentNonBlocking, useCollection } from '@/firebase';
import { doc, collection, writeBatch, runTransaction, getDoc, increment, query, where, orderBy, onSnapshot, serverTimestamp } from 'firebase/firestore';

const getImage = (id: string) => PlaceHolderImages.find(img => img.id === id);

const UserAvatar = ({ imageUrl, alt, borderColor }: { imageUrl: string; alt: string; borderColor?: string }) => (
    <Image src={imageUrl} alt={alt} width={32} height={32} className={cn("rounded-full border-2", borderColor ? borderColor : 'border-transparent')} />
);

const MessageBubble = ({ children, isOutgoing }: { children: React.ReactNode, isOutgoing: boolean }) => (
    <div
        className={cn(
            "glass-card max-w-xs p-3 rounded-2xl group relative",
            isOutgoing ? "rounded-br-lg bg-gray-100" : "rounded-bl-lg bg-main-accent/10"
        )}
    >
        {children}
        <div className="absolute -bottom-5 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
             <Trash2 className="w-4 h-4 text-red-400 cursor-pointer hover:text-destructive-accent" />
        </div>
    </div>
);

const MessageTimestamp = ({ time, isOutgoing }: { time: string; isOutgoing: boolean }) => (
    <span className={cn("text-xs text-gray-500 mt-1", isOutgoing ? 'text-right' : 'text-left')}>{time}</span>
);

const ChatMessage = ({ text, isOutgoing, time, senderDetails, currentUserDetails }: { text: React.ReactNode; isOutgoing: boolean; time: string, senderDetails?: any, currentUserDetails?: any }) => {
    const avatarUrl = isOutgoing ? currentUserDetails?.photoUrl : senderDetails?.photoUrl;
    const borderColor = isOutgoing ? "border-secondary-accent" : "border-main-accent";
    
    return (
        <div className={cn("flex items-end gap-2", isOutgoing ? "justify-end" : "justify-start")}>
            {!isOutgoing && avatarUrl && <UserAvatar imageUrl={avatarUrl} alt={senderDetails?.name || 'User'} borderColor={borderColor} />}
            <div className="flex flex-col">
                <MessageBubble isOutgoing={isOutgoing}>
                    {text}
                </MessageBubble>
                <MessageTimestamp time={time} isOutgoing={isOutgoing} />
            </div>
             {isOutgoing && avatarUrl && <UserAvatar imageUrl={avatarUrl} alt="My Avatar" borderColor={borderColor} />}
        </div>
    );
};


const ChatHeader = ({ taskData, isLoading, otherParticipant }: { taskData: any, isLoading: boolean, otherParticipant: any }) => {
    const userAvatar = otherParticipant?.photoUrl || getImage('user2')?.imageUrl;

    if (isLoading || !taskData) {
        return (
            <header className="glass-card flex items-center justify-between p-3">
                <Loader className="w-6 h-6 animate-spin" />
            </header>
        )
    }

    return (
        <header className="glass-card flex items-center justify-between p-3">
            <div className="flex items-center gap-3">
                {userAvatar && (
                    <Image
                        src={userAvatar}
                        alt={otherParticipant?.name || "Participant's Avatar"}
                        width={40}
                        height={40}
                        className="rounded-full border-2 border-main-accent"
                    />
                )}
                <div>
                    <span className="font-bold text-lg">{taskData.title}</span>
                    <p className={cn(
                        "text-xs flex items-center gap-1",
                        taskData.status === 'Open' && 'text-blue-500',
                        taskData.status === 'assigned' && 'text-yellow-500',
                        taskData.status === 'completed' && 'text-green-500',
                        taskData.status === 'paid' && 'text-purple-500',
                    )}>
                        <span className="w-2 h-2 bg-current rounded-full inline-block animate-pulse"></span>
                        Status: {taskData.status}
                    </p>
                </div>
            </div>
            <div className="flex items-center gap-4">
                <Phone className="w-6 h-6 cursor-pointer hover:text-main-accent transition-colors" />
                <div className="relative px-4 py-1.5 rounded-full bg-destructive-accent/80 cursor-pointer shadow-[0_0_10px_var(--destructive-accent)] hover:bg-destructive-accent transition-all hover:scale-110">
                    <span className="font-bold text-sm text-white">SOS</span>
                </div>
                <MoreVertical className="w-6 h-6 cursor-pointer hover:text-main-accent transition-colors" />
            </div>
        </header>
    );
};

const AttachmentMenu = ({ onSelect }: { onSelect: (type: string) => void }) => (
    <div className="absolute bottom-32 left-4 w-48 glass-card p-2 rounded-lg shadow-lg">
        <div className="flex flex-col gap-1">
            <button onClick={() => onSelect('camera')} className="flex items-center gap-2 p-2 text-sm rounded-md hover:bg-gray-100"><Camera className="w-5 h-5 text-main-accent"/> Photo/Video</button>
            <button onClick={() => onSelect('document')} className="flex items-center gap-2 p-2 text-sm rounded-md hover:bg-gray-100"><FileText className="w-5 h-5 text-secondary-accent"/> Document</button>
            <button onClick={() => onSelect('location')} className="flex items-center gap-2 p-2 text-sm rounded-md hover:bg-gray-100"><MapPin className="w-5 h-5 text-green-500"/> Location</button>
        </div>
    </div>
);

const ChatFooter = ({ onSend, taskData, user, chatId }: { onSend: (message: any) => void; taskData: any, user: any, chatId: string | null }) => {
    const [message, setMessage] = React.useState('');
    const [showAttachments, setShowAttachments] = React.useState(false);
    const firestore = useFirestore();

    const handleSend = () => {
        if (message.trim() && firestore && chatId) {
            const messagesCol = collection(firestore, 'chats', chatId, 'messages');
            addDocumentNonBlocking(messagesCol, {
                text: message,
                senderId: user.uid,
                timestamp: serverTimestamp()
            });
            setMessage('');
        }
    };

    const handleAttachmentSelect = (type: string) => {
        setShowAttachments(false);
    };

    const handleRequestPayment = () => {
        if (!firestore || !taskData) return;
        const taskRef = doc(firestore, 'tasks', taskData.id);
        updateDocumentNonBlocking(taskRef, { status: 'completed' });
    };

    const handleReleasePayment = async () => {
        if (!firestore || !taskData || !user) return;
        const { id: taskId, budget, posterId, buddyId } = taskData;
    
        try {
            await runTransaction(firestore, async (transaction) => {
                const posterRef = doc(firestore, "users", posterId);
                const buddyRef = doc(firestore, "users", buddyId);
                const taskRef = doc(firestore, "tasks", taskId);
    
                const buddyDoc = await transaction.get(buddyRef);
    
                if (!buddyDoc.exists()) {
                    throw "User not found";
                }
    
                transaction.update(buddyRef, { walletBalance: increment(budget), xp: increment(10) }); 
                transaction.update(taskRef, { status: 'paid' });
    
                const buddyTransaction = {
                    userId: buddyId,
                    taskId,
                    type: 'release',
                    amount: budget,
                    status: 'success',
                    timestamp: serverTimestamp(),
                };
                transaction.set(doc(collection(firestore, 'transactions')), buddyTransaction);

                 const posterTransaction = {
                    userId: posterId,
                    taskId,
                    type: 'withdraw',
                    amount: budget,
                    status: 'success',
                    timestamp: serverTimestamp(),
                };
                transaction.set(doc(collection(firestore, 'transactions')), posterTransaction);
            });
    
        } catch (error) {
            console.error("Payment release failed:", error);
        }
    };
    
    const isBuddy = user?.uid === taskData?.buddyId;
    const isPoster = user?.uid === taskData?.posterId;

    const renderActionButtons = () => {
        if (!taskData) return null;

        switch(taskData.status) {
            case 'assigned':
                if (isBuddy) {
                    return (
                        <Button onClick={handleRequestPayment} className="flex-1 h-14 text-lg font-bold rounded-full bg-yellow-500 text-white hover:bg-yellow-600">
                            Request Payment
                        </Button>
                    );
                }
                return <p className="text-center text-sm text-gray-500 w-full">Waiting for buddy to complete the task.</p>;
            case 'completed':
                 if (isPoster) {
                    return (
                        <Button onClick={handleReleasePayment} className="flex-1 h-14 text-lg font-bold rounded-full cyan-glow-button">
                           <IndianRupee className="w-5 h-5 mr-2" /> Release Payment
                        </Button>
                    );
                }
                return <p className="text-center text-sm text-gray-500 w-full">Payment requested. Waiting for release.</p>;
            case 'paid':
                return <p className="text-center text-sm text-green-500 w-full">Payment for this task has been completed.</p>;
            default:
                return (
                     <Button onClick={handleSend} className="flex-1 h-14 text-lg font-bold rounded-full cyan-glow-button">
                        <Send className="w-5 h-5 mr-2" /> Send
                    </Button>
                );
        }
    }


    return (
        <div className="mt-auto">
            {showAttachments && <AttachmentMenu onSelect={handleAttachmentSelect} />}
            <div className="glass-card p-4">
                <div className="relative flex items-center w-full mb-4">
                    <button onClick={() => setShowAttachments(!showAttachments)} className="absolute left-4 z-10">
                        <Paperclip className="w-6 h-6 text-gray-400 cursor-pointer hover:text-main-accent" />
                    </button>
                    <Input
                        type="text"
                        placeholder="Your text here..."
                        className="glass-card w-full h-12 px-12 rounded-full border-none focus-visible:ring-2 focus-visible:ring-main-accent"
                        value={message}
                        onChange={(e) => setMessage(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && handleSend()}
                    />
                    <div className="absolute right-4 flex items-center gap-3">
                        <Camera className="w-6 h-6 text-gray-400 cursor-pointer hover:text-main-accent" />
                        <Mic className="w-6 h-6 text-gray-400 cursor-pointer hover:text-main-accent" />
                    </div>
                </div>
                <div className="flex items-center gap-4">
                   {renderActionButtons()}
                </div>
            </div>
        </div>
    );
};

function ChatWindow({ taskId }: { taskId: string }) {
    const { user } = useUser();
    const firestore = useFirestore();
    const [messages, setMessages] = React.useState<any[]>([]);
    const [participants, setParticipants] = React.useState<any>({});
  
    const taskDocRef = useMemoFirebase(() => {
      if (!firestore || !taskId) return null;
      return doc(firestore, 'tasks', taskId);
    }, [firestore, taskId]);
  
    const { data: taskData, isLoading: isTaskLoading } = useDoc(taskDocRef);
  
    const chatQuery = useMemoFirebase(() => {
        if (!firestore || !taskId || !user) return null;
        return query(collection(firestore, 'chats'), where('taskId', '==', taskId));
    }, [firestore, taskId, user]);
  
    const { data: chatData } = useCollection(chatQuery);
    const chatId = chatData && chatData.length > 0 ? chatData[0].id : null;
    
    const participantIds = taskData ? [taskData.posterId, taskData.buddyId].filter(Boolean) : [];
    const otherParticipantId = participantIds.find(id => id !== user?.uid);
    
    const otherParticipantRef = useMemoFirebase(() => {
      if (!firestore || !otherParticipantId) return null;
      return doc(firestore, 'users', otherParticipantId);
    }, [firestore, otherParticipantId]);
  
    const { data: otherParticipantData } = useDoc(otherParticipantRef);
  
    const messagesQuery = useMemoFirebase(() => {
        if (!firestore || !chatId) return null;
        return query(collection(firestore, 'chats', chatId, 'messages'), orderBy('timestamp', 'asc'));
    }, [firestore, chatId]);
  
    const { data: liveMessages } = useCollection(messagesQuery);
  
      React.useEffect(() => {
          if (liveMessages && firestore && user) {
              const participantIds = [...new Set(liveMessages.map(msg => msg.senderId))];
              
              const fetchParticipants = async () => {
                  const usersData: any = {};
                  const idsToFetch = participantIds.filter(id => !participants[id]);
                  
                  if (idsToFetch.length > 0) {
                      for (const id of idsToFetch) {
                          const userDoc = await getDoc(doc(firestore, 'users', id));
                          if (userDoc.exists()) {
                              usersData[id] = userDoc.data();
                          }
                      }
                      setParticipants(prev => ({ ...prev, ...usersData }));
                  }
              };
  
              fetchParticipants();
              setMessages(liveMessages);
          }
      }, [liveMessages, firestore, user, participants]);
  
    const userDocRef = useMemoFirebase(() => {
      if (!firestore || !user) return null;
      return doc(firestore, 'users', user.uid);
    }, [firestore, user]);
    
    const { data: userData } = useDoc(userDocRef);
  
    const handleSend = (newMessage: any) => {
        // This is now handled by the ChatFooter component directly
    };
  
    const scrollAreaRef = React.useRef<HTMLDivElement>(null);
  
    React.useEffect(() => {
      if (scrollAreaRef.current) {
          const viewport = scrollAreaRef.current.querySelector('div[data-radix-scroll-area-viewport]');
          if(viewport) {
              viewport.scrollTop = viewport.scrollHeight;
          }
      }
    }, [messages]);
  
    // Create chat if it doesn't exist
    React.useEffect(() => {
      if (firestore && taskId && taskData && user && chatData && chatData.length === 0 && (user.uid === taskData.posterId || user.uid === taskData.buddyId)) {
          const chatCol = collection(firestore, 'chats');
          addDocumentNonBlocking(chatCol, {
              taskId: taskId,
              participantIds: [taskData.posterId, taskData.buddyId].filter(Boolean),
              lastMessage: { text: "Chat created", timestamp: serverTimestamp() },
          });
      }
    }, [firestore, taskId, taskData, user, chatData]);
  
  
    if (isTaskLoading) {
        return (
            <div className="flex items-center justify-center h-full">
                <Loader className="w-12 h-12 animate-spin text-main-accent" />
            </div>
        );
    }
  
    return (
      <div className="w-full h-[calc(100vh-150px)] flex flex-col">
        <ChatHeader taskData={taskData} isLoading={isTaskLoading} otherParticipant={otherParticipantData} />
        <ScrollArea className="flex-grow my-4 -mx-4" ref={scrollAreaRef}>
          <div className="p-4 space-y-6">
              {messages.map((msg, index) => (
                  <div key={index}>
                      <ChatMessage 
                          text={<p className="text-sm">{msg.text}</p>} 
                          isOutgoing={msg.senderId === user?.uid} 
                          time={msg.timestamp ? new Date(msg.timestamp?.toDate()).toLocaleTimeString('en-US', { hour: '2-digit', minute:'2-digit' }) : 'sending...'} 
                          senderDetails={participants[msg.senderId]}
                          currentUserDetails={userData} 
                      />
                  </div>
              ))}
          </div>
        </ScrollArea>
        <ChatFooter onSend={handleSend} taskData={taskData} user={user} chatId={chatId} />
      </div>
    );
  }

function ChatList({ activeTaskId }: { activeTaskId: string | null }) {
    const { user } = useUser();
    const firestore = useFirestore();
    const router = useRouter();

    const allChatsQuery = useMemoFirebase(() => {
        if (!firestore || !user) return null;
        return query(collection(firestore, 'chats'), where('participantIds', 'array-contains', user.uid), orderBy('lastMessage.timestamp', 'desc'));
    }, [firestore, user]);

    const { data: chats, isLoading } = useCollection(allChatsQuery);

    const taskIds = useMemoFirebase(() => chats ? chats.map(c => c.taskId) : [], [chats]);
    const taskDocsQuery = useMemoFirebase(() => {
        if (!firestore || !taskIds || taskIds.length === 0) return null;
        return query(collection(firestore, 'tasks'), where('id', 'in', taskIds));
    }, [firestore, taskIds]);
    
    // This is a limitation of react-firebase-hooks that we can't easily query for documents with a list of IDs.
    // A proper implementation might need a custom hook or fetching them manually.
    // For now we will fetch tasks individually. This is inefficient.
    
    if (isLoading) {
        return <div className="h-full flex items-center justify-center"><Loader className="w-8 h-8 animate-spin"/></div>
    }

    return (
        <ScrollArea className="h-full">
            <div className="p-2 space-y-2">
                {chats && chats.map(chat => (
                    <ChatItem key={chat.id} chat={chat} isActive={chat.taskId === activeTaskId} />
                ))}
            </div>
        </ScrollArea>
    )
}

function ChatItem({ chat, isActive }: { chat: any, isActive: boolean}) {
    const firestore = useFirestore();
    const router = useRouter();
    const { user } = useUser();

    const taskDocRef = useMemoFirebase(() => {
        if (!firestore || !chat.taskId) return null;
        return doc(firestore, 'tasks', chat.taskId);
    }, [firestore, chat.taskId]);
    const { data: taskData } = useDoc(taskDocRef);

    const otherParticipantId = chat.participantIds.find((id: string) => id !== user?.uid);
    const otherParticipantRef = useMemoFirebase(() => {
        if (!firestore || !otherParticipantId) return null;
        return doc(firestore, 'users', otherParticipantId);
    }, [firestore, otherParticipantId]);
    const { data: otherParticipantData } = useDoc(otherParticipantRef);

    const handleClick = () => {
        router.push(`/chat?taskId=${chat.taskId}`);
    };

    const avatarUrl = otherParticipantData?.photoUrl || getImage('user2')?.imageUrl;

    return (
        <div onClick={handleClick} className={cn("flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors", isActive ? "glass-card bg-main-accent/10" : "hover:bg-gray-100/50")}>
            {avatarUrl && <UserAvatar imageUrl={avatarUrl} alt={otherParticipantData?.name || 'User'} />}
            <div className="flex-1 overflow-hidden">
                <p className="font-bold truncate">{taskData?.title || 'Loading task...'}</p>
                <p className="text-sm text-gray-500 truncate">{chat.lastMessage?.text || 'No messages yet'}</p>
            </div>
            <div className="text-xs text-gray-400 self-start">
                {chat.lastMessage?.timestamp && timeAgo(chat.lastMessage.timestamp.toDate())}
            </div>
        </div>
    )
}


function ChatPageContent() {
    const searchParams = useSearchParams();
    const taskId = searchParams.get('taskId');
  
    return (
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 w-full h-[calc(100vh-150px)]">
            <div className="col-span-1 glass-card p-2 hidden md:flex flex-col">
                <h2 className="text-xl font-bold p-3">Messages</h2>
                <ChatList activeTaskId={taskId} />
            </div>
            <div className="col-span-1 md:col-span-2">
                {taskId ? (
                    <ChatWindow taskId={taskId} />
                ) : (
                    <div className="h-full flex-col gap-4 flex items-center justify-center text-center text-gray-500">
                        <MessageCircle className="w-24 h-24 text-gray-300"/>
                        <h2 className="text-xl font-bold">Select a chat</h2>
                        <p>Choose from your existing conversations on the left, or start a new one by accepting a task.</p>
                        <div className="md:hidden mt-4 w-full max-w-sm">
                            <ChatList activeTaskId={taskId} />
                        </div>
                    </div>
                )}
            </div>
        </div>
    );
  }


export default function ChatPage() {
    return (
        <React.Suspense fallback={<Loader className="w-12 h-12 animate-spin" />}>
            <ChatPageContent />
        </React.Suspense>
    )
}

--- FILE: src/app/globals.css ---
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background-start-rgb: 255, 255, 255;
    --background-end-rgb: 245, 245, 245;
    --background-gradient: linear-gradient(to bottom right, rgb(var(--background-start-rgb)), rgb(var(--background-end-rgb)));

    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 222.2 84% 4.9%;

    --foreground: 0 0% 3.9%;
    --primary-foreground: 0 0% 98%;
    --secondary-foreground: 0 0% 98%;
    --destructive-foreground: 0 0% 98%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent-foreground: 0 0% 98%;
    --popover-foreground: 0 0% 3.9%;
    --card-foreground: 0 0% 3.9%;

    --primary: 222.2 47.4% 11.2%;
    --secondary: 217.2 32.6% 17.5%;
    --destructive: 0 62.8% 30.6%;
    --muted: 217.2 32.6% 17.5%;
    --accent: 217.2 32.6% 17.5%;
    --popover: 0 0% 100%;
    --card: 0 0% 100%;

    --radius: 0.5rem;
    
    --font-sans: 'Poppins', sans-serif;

    --main-accent: #10B981; /* Trust Green */
    --secondary-accent: #F59E0B; /* Gold/Yellow */
    --highlight: #3B82F6; /* Active Blue */
    --destructive-accent: #EF4444; /* Alert Red */
  }
}

@layer base {
  body {
    color: hsl(var(--foreground));
    background-color: #ADD8E6; /* Transparent Blue */
    min-height: 100vh;
    font-family: var(--font-sans);
  }
}

@layer components {
  .glass-card {
    background-color: rgba(255, 255, 255, 0.75);
    -webkit-backdrop-filter: blur(20px);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 24px;
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
  }

  .glass-pill {
    background-color: rgba(255, 255, 255, 0.5);
    -webkit-backdrop-filter: blur(32px);
    backdrop-filter: blur(32px);
    border: 1px solid rgba(255, 255, 255, 0.08);
    box-shadow: 0 4px 16px 0 rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
  }
  
  .pill-active {
    background: var(--highlight);
    color: white;
    box-shadow: 0 0 15px var(--highlight);
    transition: all 0.3s ease;
  }

  .cyan-glow-button {
    background: var(--main-accent);
    box-shadow: 0 0 20px var(--main-accent);
    color: white;
    font-weight: bold;
    border-radius: 9999px;
    transition: all 0.3s ease;
  }
}

/* Custom toast variant */
.toast[data-variant="blur-blue"] {
  background-color: rgba(29, 78, 216, 0.8) !important; /* bg-blue-700/80 */
  backdrop-filter: blur(16px) !important;
  -webkit-backdrop-filter: blur(16px) !important;
  color: white !important;
  border-color: rgba(59, 130, 246, 0.5) !important; /* border-blue-400/50 */
}

.toast[data-variant="blur-blue"] [data-description] {
  color: rgba(219, 234, 254, 1) !important; /* text-blue-100 */
}

.toast[data-variant="blur-blue"] [data-close-button] {
  color: rgba(191, 219, 254, 1) !important; /* text-blue-200 */
}
.toast[data-variant="blur-blue"] [data-close-button]:hover {
  color: white !important;
}

--- FILE: src/app/layout.tsx ---
import type { Metadata } from 'next';
import { Poppins } from 'next/font/google';
import './globals.css';
import { cn } from '@/lib/utils';
import { Toaster } from '@/components/ui/toaster';
import MainAppLayout from './(main)/layout';
import { FirebaseClientProvider } from '@/firebase/client-provider';

const poppins = Poppins({
  subsets: ['latin'],
  weight: ['300', '400', '500', '600', '700'],
  variable: '--font-sans',
});

export const metadata: Metadata = {
  title: 'Cyberpunk Task App',
  description: 'A dark mode glassmorphism and neon cyberpunk UI',
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={cn(
          'min-h-screen bg-background font-sans antialiased',
          poppins.variable
        )}
      >
        <FirebaseClientProvider>
          <main className="relative flex flex-col items-center p-4 sm:p-6 md:p-8">
            <MainAppLayout>{children}</MainAppLayout>
          </main>
          <Toaster />
        </FirebaseClientProvider>
      </body>
    </html>
  );
}

--- FILE: src/app/leaderboard/page.tsx ---

'use client';

import Image from 'next/image';
import { Crown, Trophy, TrendingUp, TrendingDown, Loader } from 'lucide-react';
import { PlaceHolderImages } from '@/lib/placeholder-images';
import { cn } from '@/lib/utils';
import { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';
import { useCollection, useFirestore, useMemoFirebase } from '@/firebase';
import { collection, query, orderBy, limit, where, Timestamp } from 'firebase/firestore';
import * as React from 'react';

const getImage = (id: string) => PlaceHolderImages.find(img => img.id === id);

type LeaderboardUser = {
  rank: number;
  name: string;
  photoUrl: string;
  score: number;
  change: number; // Placeholder for now
};

const RankIndicator = ({ rank }: { rank: number }) => {
  if (rank === 1) return <Crown className="w-6 h-6 text-yellow-500" style={{ filter: 'drop-shadow(0 0 5px #f59e0b)' }} />;
  if (rank === 2) return <Trophy className="w-5 h-5 text-gray-400" />;
  if (rank === 3) return <Trophy className="w-5 h-5 text-yellow-700" />;
  return <span className="font-bold text-lg">{rank}</span>;
};

const ChangeIndicator = ({ change }: { change: number }) => {
  if (change > 0) return <TrendingUp className="w-5 h-5 text-green-500" />;
  if (change < 0) return <TrendingDown className="w-5 h-5 text-red-500" />;
  return <span className="text-gray-500">-</span>;
};

const LeaderboardRow = ({ user }: { user: LeaderboardUser }) => {
  const isTopThree = user.rank <= 3;

  return (
    <div className={cn(
      "flex items-center gap-4 p-3 glass-pill mb-3 transition-all duration-300 hover:bg-gray-100 hover:border-gray-300 border border-transparent rounded-lg cursor-pointer group",
      isTopThree && 'border-yellow-500/30'
    )}>
      <div className="w-10 text-center flex items-center justify-center">
        <RankIndicator rank={user.rank} />
      </div>
      <Image src={user.photoUrl} alt={user.name} width={48} height={48} className="rounded-full border-2 border-gray-300 group-hover:border-main-accent transition-colors" />
      <div className="flex-grow">
        <p className="font-bold text-foreground text-lg">{user.name}</p>
        <p className="text-sm text-green-600">{user.score.toLocaleString()} XP</p>
      </div>
      <div className="w-12 text-center flex justify-center items-center gap-1">
        <ChangeIndicator change={user.change} />
        {user.change !== 0 && <span className={cn("text-sm", user.change > 0 ? 'text-green-500' : 'text-red-500')}>{Math.abs(user.change)}</span>}
      </div>
    </div>
  );
};


const LeaderboardContent = ({ period }: { period: 'daily' | 'weekly' | 'all-time' }) => {
    const firestore = useFirestore();

    const usersQuery = useMemoFirebase(() => {
        if (!firestore) return null;

        const baseQuery = query(collection(firestore, 'users'), orderBy('xp', 'desc'), limit(10));
        // Note: For daily/weekly, you would typically query a separate aggregated collection
        // or add a `where` clause on a timestamp. For this implementation, we will use the same
        // all-time data as a placeholder for daily and weekly tabs to ensure they are functional.
        return baseQuery;
    }, [firestore, period]);

    const { data: users, isLoading } = useCollection(usersQuery);

    const leaderboardData: LeaderboardUser[] = (users || []).map((user, index) => ({
        rank: index + 1,
        name: user.name,
        photoUrl: user.photoUrl,
        score: user.xp,
        change: 0 // This is a placeholder as we don't track rank change
    }));

    if (isLoading) {
        return (
            <div className="flex justify-center items-center h-40">
                <Loader className="w-12 h-12 animate-spin text-main-accent" />
            </div>
        );
    }
    
    if (leaderboardData.length > 0) {
        return (
            <div className="flex flex-col gap-2">
                {leaderboardData.map(user => (
                    <LeaderboardRow key={user.rank} user={user} />
                ))}
            </div>
        );
    }

    return (
        <div className="text-center text-gray-500 py-10 glass-card">
            <p>The leaderboard is empty. Complete some tasks to get started!</p>
        </div>
    );
};


export default function LeaderboardPage() {
  return (
    <>
      <header className="glass-card p-6 text-center">
        <div className="flex justify-center items-center gap-4">
            <Trophy className="w-10 h-10 text-yellow-500" style={{ filter: 'drop-shadow(0 0 10px #f59e0b)' }}/>
            <h1 className="text-4xl font-bold">Leaderboard</h1>
            <Trophy className="w-10 h-10 text-yellow-500" style={{ filter: 'drop-shadow(0 0 10px #f59e0b)' }}/>
        </div>
        <p className="text-gray-500 text-sm mt-2">See who's dominating the task world.</p>
      </header>
      
      <Tabs defaultValue="all-time" className="w-full">
        <TabsList className="grid w-full grid-cols-3 glass-card p-1 h-auto">
          <TabsTrigger value="daily" className="data-[state=active]:pill-active data-[state=inactive]:glass-card">Daily</TabsTrigger>
          <TabsTrigger value="weekly" className="data-[state=active]:pill-active data-[state=inactive]:glass-card">Weekly</TabsTrigger>
          <TabsTrigger value="all-time" className="data-[state=active]:pill-active data-[state=inactive]:glass-card">All-Time</TabsTrigger>
        </TabsList>
        <TabsContent value="all-time" className="mt-6">
            <LeaderboardContent period="all-time" />
        </TabsContent>
        <TabsContent value="daily" className="mt-6">
             <LeaderboardContent period="daily" />
        </TabsContent>
        <TabsContent value="weekly" className="mt-6">
             <LeaderboardContent period="weekly" />
        </TabsContent>
      </Tabs>
    </>
  );
}

--- FILE: src/app/page.tsx ---

'use client';

import Image from 'next/image';
import {
  Bell,
  Siren,
  Shield,
  Users,
  ChevronRight,
  Plus,
  Zap,
  User,
  Loader,
  Trophy,
  Briefcase,
} from 'lucide-react';
import { Button } from '@/components/ui/button';
import { PlaceHolderImages } from '@/lib/placeholder-images';
import * as React from 'react';
import { cn, formatCurrency, timeAgo } from '@/lib/utils';
import { getTaskSuggestions, TaskSuggestionInput } from '@/ai/flows/suggestion-flow';
import { useToast } from '@/hooks/use-toast';
import { useUser, useFirestore, useCollection, useMemoFirebase, useDoc, updateDocumentNonBlocking, addDocumentNonBlocking } from '@/firebase';
import { collection, doc, query, where, limit, orderBy, serverTimestamp } from 'firebase/firestore';
import Link from 'next/link';
import { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';
import { useRouter } from 'next/navigation';

const getImage = (id: string) =>
  PlaceHolderImages.find((img) => img.id === id);

const TaskCardImage = React.memo(({ imageUrl, title, tag }: { imageUrl: string, title: string, tag: string }) => (
    <div className="relative w-full h-40 rounded-lg overflow-hidden border border-black/5">
        <Image src={imageUrl} alt={title} fill className="object-cover transition-transform duration-500 group-hover:scale-110" />
        <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
        <div className={`absolute top-2 right-2 bg-black/50 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg transition-all duration-300 backdrop-blur-sm`}>
            {tag}
        </div>
    </div>
));
TaskCardImage.displayName = 'TaskCardImage';

const TaskCardHeader = React.memo(({ title, price, tag, hasImage }: { title: string, price: number, tag: string, hasImage: boolean }) => (
    <div className="flex justify-between items-start">
        <div className="flex flex-col">
            <h2 className="text-xl font-bold text-foreground transition-colors duration-300 group-hover:text-main-accent">{title}</h2>
            <p className="text-2xl font-bold text-gray-800 mt-1">{formatCurrency(price)}</p>
        </div>
        {!hasImage && (
            <div className="bg-black/50 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg backdrop-blur-sm">
                {tag}
            </div>
        )}
    </div>
));
TaskCardHeader.displayName = 'TaskCardHeader';

const TaskCardButton = React.memo(({ task, user, onAccept }: { task: any, user: User | null, onAccept: (taskId: string, posterId: string) => void }) => {
    const [isLoading, setIsLoading] = React.useState(false);
    const router = useRouter();

    const isAcceptedByMe = task.status === 'assigned' && task.buddyId === user?.uid;
    const isMyTask = task.posterId === user?.uid;
    const isUnavailable = task.status !== 'Open';
    const isAiGenerated = task.posterId === 'ai_generated';

    const handleClick = async (e: React.MouseEvent) => {
        e.preventDefault(); 
        if (!user || isAiGenerated || !task.id) return;
        setIsLoading(true);
        await onAccept(task.id, task.posterId);
        router.push(`/chat?taskId=${task.id}`);
    };

    if (isAiGenerated) {
        return <Button disabled className="w-full h-12 text-base font-bold" variant="outline">AI Suggestion</Button>;
    }
    
    if (isMyTask) {
         return <Button disabled className="w-full h-12 text-base font-bold" variant="outline">Your Task</Button>;
    }
    
    if (isAcceptedByMe) {
        return <Button disabled className="w-full h-12 text-base font-bold bg-green-600 text-white">Task Accepted</Button>;
    }

    return (
        <Button 
            className="w-full h-12 text-base font-bold transition-all duration-300 ease-in-out transform hover:scale-105 bg-black text-white hover:bg-black/80"
            onClick={handleClick}
            disabled={isLoading || isUnavailable || !user}
        >
            {isLoading && <Loader className="w-5 h-5 animate-spin mr-2" />}
            {isUnavailable ? 'Task Unavailable' : "Accept Task"}
            {!isUnavailable && <Zap className="ml-2 w-5 h-5"/>}
        </Button>
    );
});
TaskCardButton.displayName = 'TaskCardButton';

const TaskCard = React.memo(({ task, user, onAccept }: { task: any, user: User | null, onAccept: (taskId: string, posterId: string) => void }) => {
  const { title, budget, category, reasoning } = task;
  const imageUrl = getImage(`task_${category?.toLowerCase()}`)?.imageUrl;
  
  const content = (
     <div className="glass-card p-4 flex flex-col gap-4 group transition-all duration-300 hover:shadow-2xl hover:shadow-gray-300 hover:-translate-y-1">
      {imageUrl && <TaskCardImage imageUrl={imageUrl} title={title} tag={category} />}
      <TaskCardHeader title={title} price={budget} tag={category} hasImage={!!imageUrl} />
      {reasoning && <p className="text-sm text-gray-600 border-l-2 border-gray-300 pl-3">{reasoning}</p>}
      <TaskCardButton task={task} user={user} onAccept={onAccept} />
    </div>
  )

  if (task.posterId === 'ai_generated' || !task.id) {
    return content;
  }
  
  return <Link href={`/tasks/${task.id}`}>{content}</Link>;
});
TaskCard.displayName = 'TaskCard';

const AdvancedListItem = React.memo(({ icon, title, subtitle, tag, tagColor, href }: { icon: React.ReactNode, title: string, subtitle: string, tag: string, tagColor: string, href?: string }) => {
    const content = (
        <div className="flex items-center gap-4 p-3 glass-pill mb-3 transition-all duration-300 hover:bg-gray-100/80 rounded-lg cursor-pointer group">
            <div className="p-3 bg-gray-100 rounded-full transition-all duration-300 group-hover:bg-black/10 group-hover:scale-110">
                {React.cloneElement(icon as React.ReactElement, { className: 'w-6 h-6 transition-colors duration-300 group-hover:text-black' })}
            </div>
            <div className="flex-grow">
                <p className="font-bold text-foreground">{title}</p>
                <p className="text-sm text-gray-500 group-hover:text-gray-600">{subtitle}</p>
            </div>
            <div className="flex items-center gap-2">
               <span className={`text-xs font-semibold px-2 py-1 rounded-full ${tagColor}`}>{tag}</span>
               <ChevronRight className="w-5 h-5 text-gray-500 transition-transform duration-300 group-hover:translate-x-1 group-hover:text-black" />
            </div>
        </div>
    );
    
    if (href) {
        return <Link href={href}>{content}</Link>;
    }

    return content;
});
AdvancedListItem.displayName = 'AdvancedListItem';

const HeaderWalletBalance = React.memo(({ balance, isLoading }: { balance: number, isLoading: boolean }) => {
    return (
        <div className="glass-card rounded-full px-4 py-2 hover:border-gray-300/80 border border-transparent transition-all">
          <p className="text-sm font-medium text-gray-700">
            Wallet: {isLoading ? <Loader className="w-4 h-4 inline-block animate-spin"/> : <span className="font-bold text-black transition-all duration-500">{formatCurrency(balance)}</span>}
          </p>
        </div>
    );
});
HeaderWalletBalance.displayName = 'HeaderWalletBalance';

const NotificationItem = React.memo(({ notification }: { notification: any }) => (
    <div className="flex items-start gap-3 p-3 hover:bg-gray-100 rounded-md">
        <div className="p-2 bg-main-accent/10 rounded-full mt-1">
            <Briefcase className="w-5 h-5 text-main-accent" />
        </div>
        <div>
            <p className="font-semibold text-sm text-foreground">{notification.title}</p>
            <p className="text-xs text-gray-500">{notification.message}</p>
            <p className="text-xs text-gray-400 mt-1">{timeAgo(notification.timestamp.toDate())}</p>
        </div>
    </div>
));
NotificationItem.displayName = 'NotificationItem';

const HeaderNotificationBell = React.memo(({ userId }: { userId: string }) => {
    const firestore = useFirestore();
    const notificationsQuery = useMemoFirebase(() => {
        if (!firestore || !userId) return null;
        return query(collection(firestore, `users/${userId}/notifications`), orderBy('timestamp', 'desc'), limit(10));
    }, [firestore, userId]);

    const { data: notifications } = useCollection(notificationsQuery);
    const unreadCount = notifications?.filter(n => !n.isRead).length || 0;

    return (
        <Popover>
            <PopoverTrigger asChild>
                <div className="relative glass-card p-3 rounded-full cursor-pointer hover:border-red-400/50 border border-transparent transition-all group">
                    <Bell className="w-6 h-6 text-gray-500 group-hover:text-red-500 transition-colors duration-300" />
                    {unreadCount > 0 && (
                         <span className="absolute top-1 right-1 block h-2 w-2 rounded-full bg-red-500 ring-2 ring-white animate-pulse group-hover:animate-none shadow-[0_0_8px_var(--destructive-accent)]"></span>
                    )}
                </div>
            </PopoverTrigger>
            <PopoverContent className="w-80 p-0">
                <div className="p-3 border-b">
                    <h3 className="font-semibold">Notifications</h3>
                </div>
                <div className="flex flex-col">
                    {notifications && notifications.length > 0 ? (
                        notifications.map(n => <NotificationItem key={n.id} notification={n} />)
                    ) : (
                        <p className="text-sm text-gray-500 text-center p-6">No new notifications.</p>
                    )}
                </div>
            </PopoverContent>
        </Popover>
    );
});
HeaderNotificationBell.displayName = 'HeaderNotificationBell';


const HeaderAvatar = React.memo(({ userAvatar }: { userAvatar?: { imageUrl: string, description: string }}) => {
    const defaultAvatar = getImage('user5');
    const avatar = userAvatar?.imageUrl ? userAvatar : defaultAvatar;
    return (
    <>
    {avatar && (
        <div className="glass-card p-1 rounded-full hover:border-black/20 border-2 border-transparent transition-all">
            <Image
                src={avatar.imageUrl}
                alt={avatar.description}
                width={48}
                height={48}
                className="rounded-full border-2 border-gray-200"
            />
        </div>
    )}
    </>
);
});
HeaderAvatar.displayName = 'HeaderAvatar';

const MainHeader = React.memo(({ user, userData, isUserLoading }: { user: User | null, userData: any, isUserLoading: boolean }) => {
    return (
        <header className="flex items-center justify-between w-full">
            <div className="flex items-center gap-4">
                <HeaderAvatar userAvatar={userData?.photoUrl ? { imageUrl: userData.photoUrl, description: 'User avatar' } : undefined} />
                {user && <HeaderNotificationBell userId={user.uid} />}
            </div>
            <HeaderWalletBalance balance={userData?.walletBalance || 0} isLoading={isUserLoading} />
        </header>
    );
});
MainHeader.displayName = 'MainHeader';

const QuickActionCard = React.memo(({ icon, title, bgColor, href }: { icon: React.ReactNode, title: string, bgColor: string, href: string }) => {
    return (
        <Link href={href} key={title}>
            <div className="flex-shrink-0 w-28 h-28 flex flex-col items-center justify-center gap-2 glass-card cursor-pointer group hover:-translate-y-1 transition-transform duration-300">
                <div className={cn("p-3 rounded-full transition-all duration-300 group-hover:scale-110", bgColor)}>
                    {React.cloneElement(icon as React.ReactElement, { className: 'w-5 h-5 text-white' })}
                </div>
                <p className="font-bold text-sm text-center text-foreground">{title}</p>
            </div>
        </Link>
    );
});
QuickActionCard.displayName = 'QuickActionCard';

const QuickActionsSection = React.memo(() => {
    const actions = [
        { title: 'Create Task', icon: <Plus />, bgColor: 'bg-main-accent', href: '/tasks/create' },
        { title: 'Leaderboard', icon: <Trophy />, bgColor: 'bg-yellow-500', href: '/leaderboard' },
        { title: 'Verify ID', icon: <Shield />, bgColor: 'bg-green-500', href: '/profile/verify' },
        { title: 'SOS Alerts', icon: <Siren />, bgColor: 'bg-destructive-accent', href: '/sos' },
        { title: 'Refer a Buddy', icon: <Users />, bgColor: 'bg-blue-500', href: '/refer' },
    ];
    return (
        <section className="w-full">
            <h2 className="text-xl font-bold mb-4 px-2">Quick Actions</h2>
            <div className="flex items-center gap-4 overflow-x-auto pb-2 -mx-4 px-4">
                {actions.map((action) => (
                    <QuickActionCard key={action.title} {...action} />
                ))}
            </div>
        </section>
    );
});
QuickActionsSection.displayName = 'QuickActionsSection';

const TaskFilters = React.memo(({ activeFilter, setActiveFilter }: { activeFilter: string, setActiveFilter: (filter: string) => void }) => {
    const filters = ['All', 'Household', 'Tech', 'Cleaning', 'Delivery', 'Tutoring', 'Other'];
    return (
        <section className="w-full">
            <div className="flex items-center gap-3 overflow-x-auto pb-2 -ml-4 pl-4">
                {filters.map((filter) => (
                    <button
                        key={filter}
                        onClick={() => setActiveFilter(filter)}
                        className={cn(
                            'px-5 py-2 rounded-full text-sm font-semibold transition-all duration-300 whitespace-nowrap transform hover:-translate-y-0.5',
                            activeFilter === filter
                                ? 'bg-black text-white shadow-md'
                                : 'glass-card text-gray-500 hover:bg-gray-200/60 hover:text-foreground'
                        )}
                    >
                        {filter}
                    </button>
                ))}
            </div>
        </section>
    );
});
TaskFilters.displayName = 'TaskFilters';


export default function HomePage() {
  const { user, isUserLoading: isAuthLoading } = useUser();
  const firestore = useFirestore();
  const { toast } = useToast();
  const [isGenerating, setIsGenerating] = React.useState(false);
  const [tasks, setTasks] = React.useState<any[]>([]);
  const [activeFilter, setActiveFilter] = React.useState('All');


  const userDocRef = useMemoFirebase(() => {
    if (!firestore || !user) return null;
    return doc(firestore, 'users', user.uid);
  }, [firestore, user]);
  
  const { data: userData, isLoading: isUserLoading } = useDoc(userDocRef);

  const tasksQuery = useMemoFirebase(() => {
    if (!firestore) return null;
    
    const queryConstraints = [where('status', 'in', ['Open', 'assigned'])];

    if (activeFilter !== 'All') {
        queryConstraints.push(where('category', '==', activeFilter));
    }
    
    return query(collection(firestore, 'tasks'), ...queryConstraints);

  }, [firestore, activeFilter, user]);

  const { data: firestoreTasks, isLoading: areTasksLoading } = useCollection(tasksQuery);
  
  const completedTasksQuery = useMemoFirebase(() => {
    if (!firestore || !user) return null;
    return query(collection(firestore, 'tasks'), where('buddyId', '==', user.uid), where('status', '==', 'paid'), limit(5));
  }, [firestore, user]);

  const { data: completedTasks } = useCollection(completedTasksQuery);


  React.useEffect(() => {
    if (firestoreTasks && user) {
        const myAcceptedTasks = firestoreTasks.filter(t => t.buddyId === user.uid);
        const openTasks = firestoreTasks.filter(t => t.status === 'Open' && t.buddyId !== user.uid);
        
        setTasks(prevTasks => {
            const aiTasks = prevTasks.filter(t => t.posterId === 'ai_generated');
            const combined = [...myAcceptedTasks, ...openTasks, ...aiTasks];
            const uniqueTasks = Array.from(new Map(combined.map(item => [item.id || `ai_${Math.random()}`, item])).values());
            return uniqueTasks;
        });
    } else if (firestoreTasks) {
         setTasks(firestoreTasks.filter(t => t.status === 'Open'));
    }
  }, [firestoreTasks, user]);

  const advancedListItems = [
      {
          icon: <Shield className="w-6 h-6 text-green-500" />,
          title: "Verify Your ID",
          subtitle: "Enhanced account security",
          tag: "Recommended",
          tagColor: "bg-green-100 text-green-800",
          href: "/profile/verify"
      },
      {
          icon: <Users className="w-6 h-6 text-blue-500" />,
          title: "Refer a Buddy",
          subtitle: "Earn rewards for inviting friends",
          tag: "New",
          tagColor: "bg-blue-100 text-blue-800",
          href: "/refer"
      }
  ];

    const handleAcceptTask = async (taskId: string, posterId: string) => {
        if (!user || !firestore) return;

        const taskRef = doc(firestore, 'tasks', taskId);
        const taskDoc = tasks.find(t => t.id === taskId);
        
        updateDocumentNonBlocking(taskRef, {
            status: 'assigned',
            buddyId: user.uid,
        });

        const notificationRef = collection(firestore, `users/${posterId}/notifications`);
        addDocumentNonBlocking(notificationRef, {
            userId: posterId,
            title: "Task Accepted!",
            message: `${userData?.name || 'A buddy'} has accepted your task: "${taskDoc?.title}"`,
            type: "TASK_ACCEPTED",
            taskId: taskId,
            isRead: false,
            timestamp: serverTimestamp(),
        });

        toast({
            title: "Task Accepted!",
            description: "You can find this task in your chat to coordinate."
        });
    };

  const handleGenerateSuggestions = async () => {
    if (!user || !userData) {
        toast({ variant: 'destructive', title: 'Please complete your profile first.' });
        return;
    }
    setIsGenerating(true);
    try {
        const input: TaskSuggestionInput = {
            userSkills: userData.skills || ["General Help", "Driving"],
            currentLocation: userData.location || "Not specified",
            taskHistory: completedTasks?.map(task => ({
                title: task.title,
                category: task.category,
                completed: true,
            })) || []
        };
        const result = await getTaskSuggestions(input);
        const newTasks = result.suggestions.map(s => ({
            ...s, 
            id: `ai_${Date.now()}_${Math.random()}`, 
            budget: s.estimatedEarning,
            reasoning: s.reasoning,
            status: 'Open',
            posterId: 'ai_generated'
        }));
        setTasks(prev => [...newTasks, ...prev.filter(t => t.posterId !== 'ai_generated')]);
        toast({
            title: "New Tasks Suggested!",
            description: "We've found some new tasks for you based on your profile.",
        });
    } catch (error) {
        console.error("Failed to get task suggestions", error);
        toast({
            variant: "destructive",
            title: "Uh oh! Something went wrong.",
            description: "Could not fetch AI suggestions. Please try again.",
        });
    } finally {
        setIsGenerating(false);
    }
  };

  return (
    <>
      <MainHeader user={user} userData={userData} isUserLoading={isAuthLoading || isUserLoading} />
      <QuickActionsSection />
      <TaskFilters activeFilter={activeFilter} setActiveFilter={setActiveFilter} />

      <section className="w-full">
        <Button onClick={handleGenerateSuggestions} disabled={isGenerating} className="w-full h-14 mb-6 text-lg font-bold bg-blue-500 text-white hover:bg-blue-600 transition-all duration-300 transform hover:scale-105 shadow-lg">
            {isGenerating ? (
                <>
                    <Loader className="mr-2 h-5 w-5 animate-spin" />
                    Generating Suggestions...
                </>
            ) : (
                "Get AI Suggestions"
            )}
        </Button>
      </section>

      <section className="w-full grid grid-cols-1 md:grid-cols-2 gap-6">
        {areTasksLoading ? (
            <div className="col-span-full flex justify-center items-center h-40">
                <Loader className="w-12 h-12 animate-spin text-main-accent" />
            </div>
        ) : tasks && tasks.length > 0 ? (
            tasks.map((task, index) => (
                <TaskCard key={task.id || index} task={task} user={user} onAccept={handleAcceptTask} />
            ))
        ) : (
            <div className="col-span-full text-center text-gray-500 py-10 glass-card">
                <p>No open tasks for this category. Try another filter!</p>
            </div>
        )}
      </section>

      <section className="glass-card p-4 w-full">
          <h3 className="font-bold text-lg mb-3 px-2">Priority Hub</h3>
          {advancedListItems.map(item => <AdvancedListItem key={item.title} {...item} />)}
      </section>
    </>
  );
}

--- FILE: src/app/profile/page.tsx ---

'use client';
import Image from 'next/image';
import { Check, Star, Award, Pen, Settings, LogOut, Edit, Camera, Wallet, Briefcase, Shield, Loader } from 'lucide-react';
import { PlaceHolderImages } from '@/lib/placeholder-images';
import { Button } from '@/components/ui/button';
import { Progress, CircleProgress } from '@/components/ui/progress';
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import * as React from 'react';
import { cn } from '@/lib/utils';
import { useUser, useFirestore, useDoc, useMemoFirebase, useAuth, useCollection, updateDocumentNonBlocking } from '@/firebase';
import { doc, collection, query, where } from 'firebase/firestore';
import { signOut } from 'firebase/auth';
import { useRouter } from 'next/navigation';
import Link from 'next/link';

const getImage = (id: string) => PlaceHolderImages.find(img => img.id === id);

const StatCard = ({ value, label, icon, isLoading }: { value: string, label: string, icon: React.ReactNode, isLoading?: boolean }) => (
  <div className="flex flex-col items-center glass-card p-4 rounded-lg flex-1 group transition-all duration-300 hover:-translate-y-1 hover:shadow-lg hover:shadow-gray-300">
    <div className="text-main-accent mb-2 transition-transform duration-300 group-hover:scale-125">{icon}</div>
    {isLoading ? <Loader className="w-6 h-6 animate-spin text-gray-400" /> : <p className="text-2xl font-bold text-foreground">{value}</p>}
    <p className="text-sm text-gray-500 group-hover:text-foreground">{label}</p>
  </div>
);

const Badge = ({ icon, color, label, achieved, description }: { icon: React.ReactNode, color: string, label: string, achieved: boolean, description: string }) => (
  <div className={cn("flex flex-col items-center gap-2 transition-opacity group relative", achieved ? 'opacity-100' : 'opacity-50')}>
    <div className={cn(`w-20 h-20 rounded-full flex items-center justify-center glass-card border-2 transition-all duration-300 group-hover:scale-105`, achieved ? color : 'border-gray-300')} style={achieved ? {boxShadow: `0 0 15px var(--${color.replace('border-','')})`} : {}}>
      {icon}
    </div>
    <p className="text-xs text-center font-medium">{label}</p>
    {achieved && 
        <div className="absolute bottom-full mb-2 w-48 p-2 text-xs text-center bg-black/80 text-white rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none">
            {description}
        </div>
    }
  </div>
);

const SkillPill = ({ name, level, xp, maxXp }: { name: string, level: number, xp: number, maxXp: number }) => (
    <div className="glass-pill px-4 py-2 group bg-gray-50">
        <div className="flex justify-between items-center">
            <span className="font-semibold text-sm">{name}</span>
            <span className="text-xs text-main-accent">Level {level}</span>
        </div>
        <Progress value={(xp/maxXp) * 100} className="h-1 mt-2 bg-gray-200 [&>div]:bg-main-accent transition-all duration-300 group-hover:[&>div]:shadow-[0_0_8px_var(--main-accent)]"/>
        <p className="text-xs text-gray-500 text-right mt-1">{xp}/{maxXp} XP</p>
    </div>
);

const ProfileHeader = ({ userData, user, isLoading }: { userData: any, user: any, isLoading: boolean }) => {
    const userAvatar = getImage('user2');
    const [isEditing, setIsEditing] = React.useState(false);
    const [name, setName] = React.useState(userData?.name || 'Loading...');
    const firestore = useFirestore();

    React.useEffect(() => {
        if (userData?.name) {
            setName(userData.name);
        }
    }, [userData]);
    
    const handleNameChange = () => {
        if (user && firestore && name !== userData.name) {
            const userRef = doc(firestore, 'users', user.uid);
            updateDocumentNonBlocking(userRef, { name: name });
        }
        setIsEditing(false);
    };

    if (isLoading) {
        return (
            <header className="flex flex-col items-center gap-4 glass-card p-6 w-full">
                <Loader className="w-12 h-12 animate-spin text-main-accent" />
            </header>
        )
    }

    return (
      <header className="flex flex-col items-center gap-4 glass-card p-6 w-full">
        <div className="relative group">
          <Image
              src={userData?.photoUrl || userAvatar?.imageUrl || ''}
              alt={userData?.name || "User Avatar"}
              width={120}
              height={120}
              className="rounded-full border-4 border-main-accent"
              style={{boxShadow: '0 0 20px rgba(0,0,0,0.2)'}}
            />
          <div className="absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
              <Camera className="w-8 h-8 text-white" />
          </div>
          {userData?.aadharVerified && (
            <div className="absolute bottom-1 right-1 bg-green-500 rounded-full p-1 border-2 border-white">
                <Check className="w-4 h-4 text-white" />
            </div>
          )}
        </div>
        <div className="text-center">
          <div className="flex items-center justify-center gap-2">
            {isEditing ? (
                <input type="text" value={name} onChange={(e) => setName(e.target.value)} onBlur={handleNameChange} onKeyPress={e => e.key === 'Enter' && handleNameChange()} className="bg-transparent border-b-2 border-main-accent text-3xl font-bold text-center w-64 focus:outline-none" autoFocus />
            ) : (
                <h1 className="text-3xl font-bold">{name}</h1>
            )}
            <button onClick={() => setIsEditing(!isEditing)}>
              {isEditing ? <Check className="w-5 h-5 text-green-500"/> : <Edit className="w-5 h-5 text-gray-400 cursor-pointer hover:text-main-accent"/>}
            </button>
          </div>
          <p className="text-lg text-gray-500">Level {userData?.level || 'N/A'}</p>
        </div>
        
        <div className="w-full px-4">
           <div className="relative w-full h-4 glass-pill rounded-full overflow-hidden">
                <div 
                    className="h-full rounded-full bg-main-accent" 
                    style={{
                        width: `${((userData?.xp || 0)/500)*100}%`,
                        boxShadow: '0 0 10px var(--main-accent)'
                    }}
                />
            </div>
            <div className="flex justify-between items-center text-xs text-gray-500 mt-1">
                <span>XP: {userData?.xp || 0} / 500</span>
                <span className="flex items-center gap-1">To Lvl up <Star className="w-4 h-4 text-yellow-400" /></span>
            </div>
        </div>
      </header>
    );
};

export default function ProfilePage() {
  const { user } = useUser();
  const firestore = useFirestore();
  const auth = useAuth();
  const router = useRouter();

  const userDocRef = useMemoFirebase(() => {
    if (!firestore || !user) return null;
    return doc(firestore, 'users', user.uid);
  }, [firestore, user]);

  const { data: userData, isLoading: isUserLoading } = useDoc(userDocRef);

  const completedTasksQuery = useMemoFirebase(() => {
    if (!firestore || !user) return null;
    return query(collection(firestore, 'tasks'), where('buddyId', '==', user.uid), where('status', 'in', ['completed', 'paid']));
  }, [firestore, user]);

  const { data: completedTasks, isLoading: isTasksLoading } = useCollection(completedTasksQuery);

  const handleLogout = async () => {
    try {
      await signOut(auth);
      router.push('/auth/login');
    } catch (error) {
      console.error("Error signing out: ", error);
    }
  };
  
  const tasksDone = completedTasks?.length || 0;
  const avgRating = "4.8";

  const allBadges = [
    { icon: <Shield className="w-10 h-10 text-green-500" />, color: "border-green-500", label: "Verified", achieved: userData?.aadharVerified || false, description: "Your identity has been successfully verified." },
    { icon: <Pen className="w-10 h-10 text-main-accent" />, color: "border-main-accent", label: "Fast Worker", achieved: tasksDone >= 10, description: "Completed 10+ tasks." },
    { icon: <Award className="w-10 h-10 text-yellow-500" />, color: "border-yellow-500", label: "5-Star Hero", achieved: false, description: "Maintained a 5-star rating over 20 tasks." },
    { icon: <Star className="w-10 h-10 text-gray-400" />, color: "border-gray-400", label: "Top Earner", achieved: (userData?.walletBalance || 0) > 10000, description: "Become one of the top earners on the platform." },
  ];
  
  const skills = userData?.skills?.map((skill: string) => ({
      name: skill,
      level: 1,
      xp: 50,
      maxXp: 100
  })) || [];

  const overallProgress = (userData?.xp / 500) * 100 || 0;

  return (
    <>
      <ProfileHeader userData={userData} user={user} isLoading={isUserLoading} />

      <section className="glass-card w-full p-4">
        <div className="flex justify-around gap-4">
          <StatCard value={`₹${(userData?.walletBalance || 0).toLocaleString()}`} label="Earnings" icon={<Wallet className="w-6 h-6"/>} isLoading={isUserLoading} />
          <StatCard value={String(tasksDone)} label="Tasks Done" icon={<Briefcase className="w-6 h-6"/>} isLoading={isTasksLoading}/>
          <StatCard value={tasksDone > 0 ? avgRating : 'N/A'} label="Avg. Rating" icon={<Star className="w-6 h-6"/>} isLoading={isTasksLoading}/>
        </div>
      </section>

      <section className="glass-card p-6 flex flex-col md:flex-row items-center gap-6 w-full">
        <div className="flex-shrink-0">
            {isUserLoading ? <Loader className="w-10 h-10 animate-spin" /> : <CircleProgress value={overallProgress} size={150} strokeWidth={12} color="var(--main-accent)" />}
        </div>
        <div className="text-center md:text-left">
            <h2 className="text-xl font-bold">Overall Progress</h2>
            <p className="text-gray-500 mt-1">You're doing great! Keep completing tasks to unlock new badges and higher-paying opportunities. Your consistency is your greatest asset.</p>
        </div>
      </section>

      <Tabs defaultValue="badges" className="w-full">
        <TabsList className="grid w-full grid-cols-2 glass-card p-1 h-auto">
          <TabsTrigger value="badges" className="data-[state=active]:pill-active data-[state=inactive]:glass-card">Badges</TabsTrigger>
          <TabsTrigger value="skills" className="data-[state=active]:pill-active data-[state=inactive]:glass-card">Skills</TabsTrigger>
        </TabsList>
        <TabsContent value="badges" className="mt-6">
            <section className="flex flex-col gap-4">
                <h2 className="text-xl font-bold px-2">Badge Showcase</h2>
                <div className="glass-card p-6">
                <div className="grid grid-cols-4 gap-4">
                    {allBadges.map(badge => <Badge key={badge.label} {...badge} />)}
                </div>
                </div>
            </section>
        </TabsContent>
        <TabsContent value="skills" className="mt-6">
             <section className="flex flex-col gap-4">
                <h2 className="text-xl font-bold px-2">Skill Set</h2>
                <div className="glass-card p-4 flex flex-col gap-3">
                    {skills.length > 0 ? skills.map((skill: any) => <SkillPill key={skill.name} {...skill} />) : (
                      <p className="text-center text-gray-500 py-4">You haven't added any skills yet. Go to settings to add them.</p>
                    )}
                </div>
            </section>
        </TabsContent>
      </Tabs>

      <footer className="mt-4 grid grid-cols-2 gap-4 w-full">
        <Link href="/profile/settings">
            <Button variant="outline" className="w-full h-12 text-md glass-card border-gray-200 hover:bg-gray-100 hover:text-foreground transition-all transform hover:scale-105">
                <Settings className="mr-2 h-5 w-5" />
                Settings
            </Button>
        </Link>
         <Button onClick={handleLogout} variant="outline" className="w-full h-12 text-md glass-card border-destructive-accent/50 text-destructive-accent hover:bg-destructive-accent/10 hover:text-destructive-accent transition-all transform hover:scale-105">
            <LogOut className="mr-2 h-5 w-5" />
            Logout
        </Button>
      </footer>
    </>
  );
}

--- FILE: src/app/profile/settings/account/page.tsx ---

'use client';
import { ArrowLeft, User, Mail, Shield } from 'lucide-react';
import Link from 'next/link';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Button } from '@/components/ui/button';

const SettingsItem = ({ icon, title, value, action }: { icon: React.ReactNode, title: string, value: string, action?: React.ReactNode }) => (
    <div className="flex items-center justify-between glass-pill p-4">
        <div className="flex items-center gap-4">
            {icon}
            <div>
                <p className="text-sm text-gray-500">{title}</p>
                <p className="font-semibold text-foreground">{value}</p>
            </div>
        </div>
        {action}
    </div>
);

export default function AccountSettingsPage() {
    return (
        <div className="w-full max-w-md mx-auto flex flex-col gap-6 text-foreground">
            <header className="flex items-center gap-4 p-4">
                <Link href="/profile/settings">
                    <ArrowLeft className="w-6 h-6 cursor-pointer hover:text-main-accent transition-colors" />
                </Link>
                <h1 className="text-3xl font-bold text-main-accent">Account Settings</h1>
            </header>

            <main className="flex flex-col gap-6 px-4">
                <Card className="glass-card">
                    <CardHeader>
                        <CardTitle>Personal Information</CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                        <SettingsItem icon={<User className="w-5 h-5 text-gray-500"/>} title="Name" value="Rakesh Sharma" action={<Button variant="ghost" size="sm">Edit</Button>} />
                        <SettingsItem icon={<Mail className="w-5 h-5 text-gray-500"/>} title="Email" value="rakesh@example.com" />
                    </CardContent>
                </Card>
                
                <Card className="glass-card">
                    <CardHeader>
                        <CardTitle>Security</CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                        <SettingsItem icon={<Shield className="w-5 h-5 text-gray-500"/>} title="Password" value="••••••••" action={<Button variant="ghost" size="sm">Change</Button>} />
                         <div className="text-center pt-4">
                            <Button variant="destructive">Delete Account</Button>
                        </div>
                    </CardContent>
                </Card>
            </main>
        </div>
    );
}

--- FILE: src/app/profile/settings/notifications/page.tsx ---

'use client';
import { ArrowLeft, Bell, MessageSquare, Briefcase } from 'lucide-react';
import Link from 'next/link';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Switch } from '@/components/ui/switch';
import { Label } from '@/components/ui/label';

const NotificationToggle = ({ id, icon, title, description }: { id: string, icon: React.ReactNode, title: string, description: string }) => (
    <div className="flex items-center justify-between glass-pill p-4">
        <div className="flex items-center gap-4">
            {icon}
            <div>
                <Label htmlFor={id} className="font-semibold text-foreground cursor-pointer">{title}</Label>
                <p className="text-sm text-gray-500">{description}</p>
            </div>
        </div>
        <Switch id={id} defaultChecked />
    </div>
);


export default function NotificationSettingsPage() {
    return (
        <div className="w-full max-w-md mx-auto flex flex-col gap-6 text-foreground">
            <header className="flex items-center gap-4 p-4">
                <Link href="/profile/settings">
                    <ArrowLeft className="w-6 h-6 cursor-pointer hover:text-main-accent transition-colors" />
                </Link>
                <h1 className="text-3xl font-bold text-main-accent">Notification Settings</h1>
            </header>

            <main className="flex flex-col gap-4 px-4">
                 <Card className="glass-card">
                    <CardHeader>
                        <CardTitle>Manage Your Alerts</CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                        <NotificationToggle 
                            id="push-notifications"
                            icon={<Bell className="w-5 h-5 text-main-accent" />}
                            title="Push Notifications"
                            description="For all important updates"
                        />
                        <NotificationToggle 
                            id="chat-notifications"
                            icon={<MessageSquare className="w-5 h-5 text-secondary-accent" />}
                            title="Chat Messages"
                            description="When you receive a new message"
                        />
                        <NotificationToggle 
                            id="task-updates"
                            icon={<Briefcase className="w-5 h-5 text-green-500" />}
                            title="Task Updates"
                            description="Status changes on your tasks"
                        />
                    </CardContent>
                </Card>
            </main>
        </div>
    );
}

--- FILE: src/app/profile/settings/page.tsx ---

'use client';
import { ArrowLeft, Bell, Lock, HelpCircle, FileText, User } from 'lucide-react';
import Link from 'next/link';

const SettingsItem = ({ icon, title, description, href }: { icon: React.ReactNode, title: string, description: string, href: string }) => (
    <Link href={href} className="w-full">
        <div className="flex items-center p-4 glass-card rounded-lg w-full hover:bg-gray-100 transition-colors cursor-pointer group">
            <div className="p-3 bg-gray-100 rounded-lg mr-4 transition-all duration-300 group-hover:scale-110 group-hover:bg-main-accent/20">
                {icon}
            </div>
            <div className="flex-grow">
                <p className="font-semibold text-foreground text-lg">{title}</p>
                <p className="text-sm text-gray-500">{description}</p>
            </div>
        </div>
    </Link>
);


export default function SettingsPage() {
    const settingsOptions = [
        { icon: <User className="w-6 h-6 text-main-accent"/>, title: "Account", description: "Manage your profile information", href: "/profile/settings/account" },
        { icon: <Bell className="w-6 h-6 text-yellow-500"/>, title: "Notifications", description: "Choose what you get notified about", href: "/profile/settings/notifications" },
        { icon: <Lock className="w-6 h-6 text-green-500"/>, title: "Privacy & Security", description: "Control your data and security", href: "/profile/settings/privacy" },
        { icon: <HelpCircle className="w-6 h-6 text-blue-500"/>, title: "Help & Support", description: "Get help or contact us", href: "/profile/settings/support" },
        { icon: <FileText className="w-6 h-6 text-purple-500"/>, title: "Terms & Conditions", description: "Read our terms of service", href: "/profile/settings/terms" },
    ];

    return (
        <div className="w-full max-w-md mx-auto flex flex-col gap-6 text-foreground">
            <header className="flex items-center gap-4 p-4">
                <Link href="/profile">
                    <ArrowLeft className="w-6 h-6 cursor-pointer hover:text-main-accent transition-colors" />
                </Link>
                <h1 className="text-3xl font-bold text-main-accent">Settings</h1>
            </header>

            <main className="flex flex-col gap-4 px-4">
                {settingsOptions.map((option) => (
                    <SettingsItem key={option.title} {...option} />
                ))}
            </main>
        </div>
    );
}

--- FILE: src/app/profile/settings/privacy/page.tsx ---

'use client';
import { ArrowLeft, User, MapPin } from 'lucide-react';
import Link from 'next/link';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Switch } from '@/components/ui/switch';
import { Label } from '@/components/ui/label';

const PrivacyToggle = ({ id, icon, title, description }: { id: string, icon: React.ReactNode, title: string, description: string }) => (
    <div className="flex items-center justify-between glass-pill p-4">
        <div className="flex items-center gap-4">
            {icon}
            <div>
                <Label htmlFor={id} className="font-semibold text-foreground cursor-pointer">{title}</Label>
                <p className="text-sm text-gray-500">{description}</p>
            </div>
        </div>
        <Switch id={id} />
    </div>
);

export default function PrivacySettingsPage() {
    return (
        <div className="w-full max-w-md mx-auto flex flex-col gap-6 text-foreground">
            <header className="flex items-center gap-4 p-4">
                <Link href="/profile/settings">
                    <ArrowLeft className="w-6 h-6 cursor-pointer hover:text-main-accent transition-colors" />
                </Link>
                <h1 className="text-3xl font-bold text-main-accent">Privacy & Security</h1>
            </header>

            <main className="flex flex-col gap-4 px-4">
                <Card className="glass-card">
                    <CardHeader>
                        <CardTitle>Control Your Data</CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                        <PrivacyToggle 
                            id="show-profile"
                            icon={<User className="w-5 h-5 text-main-accent" />}
                            title="Public Profile"
                            description="Allow others to see your profile"
                        />
                        <PrivacyToggle 
                            id="share-location"
                            icon={<MapPin className="w-5 h-5 text-green-500" />}
                            title="Share Location"
                            description="Share location for relevant tasks"
                        />
                    </CardContent>
                </Card>
            </main>
        </div>
    );
}

--- FILE: src/app/profile/settings/support/page.tsx ---

'use client';
import { ArrowLeft, LifeBuoy, BookOpen, MessageSquare } from 'lucide-react';
import Link from 'next/link';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

const SupportOption = ({ icon, title, description, href }: { icon: React.ReactNode, title: string, description: string, href: string }) => (
    <Link href={href}>
        <div className="glass-pill p-4 flex items-center gap-4 hover:bg-gray-100/80 rounded-lg cursor-pointer group">
            {icon}
            <div>
                <p className="font-semibold text-foreground group-hover:text-main-accent">{title}</p>
                <p className="text-sm text-gray-500">{description}</p>
            </div>
        </div>
    </Link>
);


export default function SupportPage() {
    return (
        <div className="w-full max-w-md mx-auto flex flex-col gap-6 text-foreground">
            <header className="flex items-center gap-4 p-4">
                <Link href="/profile/settings">
                    <ArrowLeft className="w-6 h-6 cursor-pointer hover:text-main-accent transition-colors" />
                </Link>
                <h1 className="text-3xl font-bold text-main-accent">Help & Support</h1>
            </header>

            <main className="flex flex-col gap-4 px-4">
                <Card className="glass-card">
                    <CardHeader>
                        <CardTitle>How can we help?</CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                        <SupportOption 
                            icon={<BookOpen className="w-6 h-6 text-main-accent"/>}
                            title="FAQ"
                            description="Find answers to common questions"
                            href="#"
                        />
                        <SupportOption 
                            icon={<MessageSquare className="w-6 h-6 text-secondary-accent"/>}
                            title="Live Chat"
                            description="Chat with a support agent"
                            href="#"
                        />
                        <SupportOption 
                            icon={<LifeBuoy className="w-6 h-6 text-destructive-accent"/>}
                            title="Contact Us"
                            description="Send us an email for any issue"
                            href="#"
                        />
                    </CardContent>
                </Card>
            </main>
        </div>
    );
}

--- FILE: src/app/profile/settings/terms/page.tsx ---

'use client';
import { ArrowLeft } from 'lucide-react';
import Link from 'next/link';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { ScrollArea } from '@/components/ui/scroll-area';

export default function TermsPage() {
    return (
        <div className="w-full max-w-md mx-auto flex flex-col gap-6 text-foreground">
            <header className="flex items-center gap-4 p-4">
                <Link href="/profile/settings">
                    <ArrowLeft className="w-6 h-6 cursor-pointer hover:text-main-accent transition-colors" />
                </Link>
                <h1 className="text-3xl font-bold text-main-accent">Terms & Conditions</h1>
            </header>

            <main className="flex flex-col gap-4 px-4">
                <Card className="glass-card">
                    <CardHeader>
                        <CardTitle>Last Updated: July 2024</CardTitle>
                    </CardHeader>
                    <CardContent>
                        <ScrollArea className="h-72 w-full">
                            <div className="space-y-4 text-sm text-gray-600">
                                <p>Welcome to Local Buddy Pro! These terms and conditions outline the rules and regulations for the use of Local Buddy Pro's Website, located at localbuddy.pro.</p>
                                
                                <h3 className="font-bold text-foreground">1. General Terms</h3>
                                <p>By accessing this app we assume you accept these terms and conditions. Do not continue to use Local Buddy Pro if you do not agree to take all of the terms and conditions stated on this page.</p>
                                
                                <h3 className="font-bold text-foreground">2. License</h3>
                                <p>Unless otherwise stated, Local Buddy Pro and/or its licensors own the intellectual property rights for all material on Local Buddy Pro. All intellectual property rights are reserved. You may access this from Local Buddy Pro for your own personal use subjected to restrictions set in these terms and conditions.</p>

                                <h3 className="font-bold text-foreground">3. User Responsibilities</h3>
                                <p>You must not: Republish material from Local Buddy Pro, sell, rent or sub-license material from Local Buddy Pro, or reproduce, duplicate or copy material from Local Buddy Pro.</p>
                            </div>
                        </ScrollArea>
                    </CardContent>
                </Card>
            </main>
        </div>
    );
}

--- FILE: src/app/profile/verify/page.tsx ---

'use client';
import { ArrowLeft, UploadCloud, FileCheck2, Loader, ShieldCheck } from 'lucide-react';
import Link from 'next/link';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import * as React from 'react';
import { useToast } from '@/hooks/use-toast';
import { useUser, useFirestore, updateDocumentNonBlocking } from '@/firebase';
import { doc } from 'firebase/firestore';


export default function VerifyIdPage() {
    const [file, setFile] = React.useState<File | null>(null);
    const [isUploading, setIsUploading] = React.useState(false);
    const [isVerified, setIsVerified] = React.useState(false);
    const [isPending, setIsPending] = React.useState(false);
    const { toast } = useToast();
    const { user } = useUser();
    const firestore = useFirestore();

    const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {
        if (event.target.files) {
            setFile(event.target.files[0]);
        }
    };

    const handleVerify = () => {
        if (!file) {
            toast({
                variant: 'destructive',
                title: 'No File Selected',
                description: 'Please select a file to upload.',
            });
            return;
        }

        setIsUploading(true);
        // In a real app, you'd upload the file to Firebase Storage here.
        // For this simulation, we'll just update the user's status to 'pending'.
        setTimeout(() => {
            if (user && firestore) {
                 const userRef = doc(firestore, 'users', user.uid);
                 // The 'aadharVerified' is now controlled by an admin panel.
                 // We just mark the status as 'pending' for review.
                 updateDocumentNonBlocking(userRef, { verificationStatus: 'pending' });
            }
            setIsUploading(false);
            setIsPending(true); // Show pending message
            toast({
                title: 'ID Submitted for Verification!',
                description: 'Your ID has been submitted and is pending review. This may take 24-48 hours.',
            });
        }, 2000);
    };

    if (isPending) {
        return (
            <div className="w-full max-w-md mx-auto flex flex-col gap-6 text-foreground items-center justify-center h-[calc(100vh-10rem)]">
                <Loader className="w-24 h-24 text-yellow-500 animate-spin" />
                <h1 className="text-3xl font-bold text-center">Verification Pending</h1>
                <p className="text-gray-500 text-center">Your document has been submitted for review. We will notify you once the process is complete.</p>
                <Link href="/profile" className="w-full">
                    <Button className="w-full h-12 text-lg cyan-glow-button">Back to Profile</Button>
                </Link>
            </div>
        )
    }

    if (isVerified) {
        return (
            <div className="w-full max-w-md mx-auto flex flex-col gap-6 text-foreground items-center justify-center h-[calc(100vh-10rem)]">
                <ShieldCheck className="w-24 h-24 text-green-500" style={{filter: 'drop-shadow(0 0 15px #22c55e)'}}/>
                <h1 className="text-3xl font-bold text-center">You are Verified!</h1>
                <p className="text-gray-500 text-center">Congratulations! You've unlocked new features and higher transaction limits.</p>
                <Link href="/profile" className="w-full">
                    <Button className="w-full h-12 text-lg cyan-glow-button">Go to Profile</Button>
                </Link>
            </div>
        )
    }

    return (
        <div className="w-full max-w-md mx-auto flex flex-col gap-6 text-foreground">
            <header className="flex items-center gap-4 p-4">
                <Link href="/">
                    <ArrowLeft className="w-6 h-6 cursor-pointer hover:text-main-accent transition-colors" />
                </Link>
                <h1 className="text-3xl font-bold text-main-accent">Verify Your ID</h1>
            </header>

            <main className="flex flex-col gap-4 px-4">
                <Card className="glass-card">
                    <CardHeader>
                        <CardTitle>Upload Your Aadhar/ID Card</CardTitle>
                        <CardDescription>
                            Please upload a clear image of your government-issued ID to complete verification.
                        </CardDescription>
                    </CardHeader>
                    <CardContent className="space-y-6">
                        <div className="relative border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-main-accent transition-colors">
                            <input 
                                type="file"
                                className="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                                onChange={handleFileChange}
                                accept="image/png, image/jpeg"
                            />
                            <div className="flex flex-col items-center justify-center gap-2 text-gray-500">
                                {file ? (
                                    <>
                                        <FileCheck2 className="w-12 h-12 text-green-500"/>
                                        <p className="font-semibold text-foreground">{file.name}</p>
                                        <p className="text-xs">Ready to be uploaded</p>
                                    </>
                                ) : (
                                    <>
                                        <UploadCloud className="w-12 h-12" />
                                        <p>Click to browse or drag & drop</p>
                                        <p className="text-xs">PNG, JPG up to 5MB</p>
                                    </>
                                )}
                            </div>
                        </div>

                        <Button 
                            className="w-full h-14 text-lg font-bold cyan-glow-button"
                            onClick={handleVerify}
                            disabled={isUploading}
                        >
                            {isUploading ? (
                                <>
                                    <Loader className="w-6 h-6 animate-spin mr-2"/>
                                    Submitting...
                                </>
                            ) : "Submit for Verification"}
                        </Button>
                    </CardContent>
                </Card>
            </main>
        </div>
    );
}

--- FILE: src/app/refer/page.tsx ---

'use client';
import { ArrowLeft, Gift, Copy, Check } from 'lucide-react';
import Link from 'next/link';
import { Button } from '@/components/ui/button';
import { useCopyToClipboard } from '@/hooks/use-copy-to-clipboard';
import { useToast } from '@/hooks/use-toast';

export default function ReferPage() {
    const referralCode = 'BUDDY-R8K4P';
    const [copiedText, copy] = useCopyToClipboard();
    const { toast } = useToast();

    const handleCopy = () => {
        copy(referralCode).then((success) => {
            if (success) {
                toast({
                    title: 'Copied to Clipboard!',
                    description: 'Your referral code has been copied.',
                });
            }
        });
    }

    return (
        <div className="w-full max-w-md mx-auto flex flex-col gap-6 text-foreground">
            <header className="flex items-center gap-4 p-4">
                <Link href="/">
                    <ArrowLeft className="w-6 h-6 cursor-pointer hover:text-main-accent transition-colors" />
                </Link>
                <h1 className="text-3xl font-bold text-main-accent">Refer a Buddy</h1>
            </header>

            <main className="flex flex-col gap-8 px-4">
                <div className="glass-card p-8 text-center flex flex-col items-center">
                    <Gift className="w-16 h-16 text-yellow-500 mb-4" style={{ filter: 'drop-shadow(0 0 10px #f59e0b)' }} />
                    <h2 className="text-2xl font-bold">Refer & Earn ₹100</h2>
                    <p className="text-gray-500 mt-2">
                        Share your referral code with friends. When they complete their first task, you both get ₹100 in your wallet!
                    </p>
                </div>
                
                <div className="glass-card p-6">
                    <p className="text-sm text-center text-gray-500 mb-2">Your unique referral code</p>
                    <div className="relative flex items-center">
                        <input 
                            type="text"
                            value={referralCode}
                            readOnly
                            className="glass-card w-full h-14 pl-6 pr-16 text-center text-2xl font-mono tracking-widest border-none"
                        />
                        <Button 
                            size="icon" 
                            className="absolute right-3 top-1/2 -translate-y-1/2 h-10 w-10 bg-main-accent/80 hover:bg-main-accent"
                            onClick={handleCopy}
                        >
                            {copiedText === referralCode ? <Check className="w-6 h-6"/> : <Copy className="w-6 h-6" />}
                        </Button>
                    </div>
                </div>

                <Button className="w-full h-14 text-lg font-bold cyan-glow-button">
                    Share with Friends
                </Button>
            </main>
        </div>
    );
}

--- FILE: src/app/sos/page.tsx ---

'use client';
import { ArrowLeft, Siren, Shield, Phone } from 'lucide-react';
import Link from 'next/link';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

const EmergencyContact = ({ name, relation, avatar }: { name: string, relation: string, avatar: string}) => (
    <div className="flex items-center justify-between glass-pill p-3">
        <div className="flex items-center gap-3">
            <img src={avatar} alt={name} className="w-10 h-10 rounded-full" />
            <div>
                <p className="font-semibold text-foreground">{name}</p>
                <p className="text-xs text-gray-500">{relation}</p>
            </div>
        </div>
        <div className="flex items-center gap-3">
            <Button variant="ghost" size="icon"><Phone className="w-5 h-5 text-main-accent"/></Button>
        </div>
    </div>
);

export default function SosPage() {
    return (
        <div className="w-full max-w-md mx-auto flex flex-col gap-6 text-foreground">
            <header className="flex items-center gap-4 p-4">
                <Link href="/">
                    <ArrowLeft className="w-6 h-6 cursor-pointer hover:text-main-accent transition-colors" />
                </Link>
                <h1 className="text-3xl font-bold text-destructive-accent">SOS Alerts</h1>
            </header>

            <main className="flex flex-col gap-8 px-4">
                <div className="flex flex-col items-center justify-center">
                    <button className="relative w-48 h-48 rounded-full bg-gray-200 flex items-center justify-center group transition-all duration-300 hover:bg-red-100">
                        <div className="absolute inset-0 rounded-full bg-destructive-accent animate-ping-slow opacity-70 group-hover:animate-ping"></div>
                        <div className="relative w-40 h-40 rounded-full bg-destructive-accent/80 flex items-center justify-center shadow-lg group-hover:bg-destructive-accent">
                            <Siren className="w-20 h-20 text-white" />
                        </div>
                    </button>
                    <p className="mt-6 text-lg text-center font-semibold text-gray-600">Press and hold for 3 seconds to send an alert</p>
                </div>
                
                <Card className="glass-card">
                    <CardHeader>
                        <CardTitle className="flex items-center gap-2">
                            <Shield className="w-5 h-5 text-green-500"/>
                            Emergency Contacts
                        </CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-3">
                        <EmergencyContact name="Rahul Kumar" relation="Friend" avatar="https://i.pravatar.cc/150?u=a042581f4e29026704d" />
                        <EmergencyContact name="Priya Singh" relation="Sister" avatar="https://i.pravatar.cc/150?u=a042581f4e29026705e" />
                        <Button variant="outline" className="w-full mt-4">Add Contact</Button>
                    </CardContent>
                </Card>
            </main>
        </div>
    );
}

--- FILE: src/app/tasks/[taskId]/page.tsx ---

'use client';

import { useParams, useRouter } from 'next/navigation';
import { useDoc, useFirestore, useMemoFirebase, useUser, updateDocumentNonBlocking } from '@/firebase';
import { doc, DocumentReference, collection, serverTimestamp } from 'firebase/firestore';
import { ArrowLeft, Loader, User, MapPin, Calendar, Tag, IndianRupee, Shield, MessageSquare, Zap, Clock, Wallet } from 'lucide-react';
import Image from 'next/image';
import { PlaceHolderImages } from '@/lib/placeholder-images';
import { formatCurrency, timeAgo } from '@/lib/utils';
import { Button } from '@/components/ui/button';
import Link from 'next/link';
import * as React from 'react';
import { useToast } from '@/hooks/use-toast';

const getImage = (id: string) => PlaceHolderImages.find((img) => img.id === id);

const DetailItem = ({ icon, label, value }: { icon: React.ReactNode, label: string, value: string | React.ReactNode }) => (
    <div className="flex items-start gap-4">
        <div className="text-main-accent mt-1">{icon}</div>
        <div>
            <p className="text-sm text-gray-500">{label}</p>
            <p className="font-semibold text-foreground">{value}</p>
        </div>
    </div>
);


export default function TaskDetailPage() {
    const params = useParams();
    const router = useRouter();
    const taskId = params.taskId as string;
    const { user } = useUser();
    const firestore = useFirestore();
    const { toast } = useToast();
    const [isAccepting, setIsAccepting] = React.useState(false);

    const taskDocRef = useMemoFirebase(() => {
        if (!firestore || !taskId) return null;
        return doc(firestore, 'tasks', taskId);
    }, [firestore, taskId]);

    const { data: taskData, isLoading: isTaskLoading } = useDoc(taskDocRef);

    const posterDocRef = useMemoFirebase(() => {
        if (!firestore || !taskData?.posterId) return null;
        return doc(firestore, 'users', taskData.posterId);
    }, [firestore, taskData?.posterId]);
    
    const { data: posterData, isLoading: isPosterLoading } = useDoc(posterDocRef);

    const handleAcceptTask = async () => {
        if (!user || !firestore) {
            toast({ variant: 'destructive', title: "You must be logged in to accept tasks." });
            return;
        }
        setIsAccepting(true);

        const taskRef = doc(firestore, 'tasks', taskId);

        try {
            // Optimistically update UI while non-blocking update happens in background
            updateDocumentNonBlocking(taskRef, {
                status: 'assigned',
                buddyId: user.uid,
            });

            toast({
                title: "Task Accepted!",
                description: "The task poster has been notified. You can start a chat now.",
            });
            router.push(`/chat?taskId=${taskId}`);
        } catch (error: any) {
            console.error("Failed to accept task:", error);
            toast({
                variant: 'destructive',
                title: 'Error Accepting Task',
                description: error.message,
            });
            setIsAccepting(false);
        }
    };

    if (isTaskLoading || isPosterLoading) {
        return (
            <div className="w-full h-[calc(100vh-150px)] flex items-center justify-center">
                <Loader className="w-12 h-12 animate-spin text-main-accent" />
            </div>
        );
    }

    if (!taskData) {
        return (
            <div className="w-full h-[calc(100vh-150px)] flex flex-col items-center justify-center text-center">
                <h2 className="text-2xl font-bold text-destructive-accent">Task Not Found</h2>
                <p className="text-gray-500 mt-2">The task you are looking for might have been deleted or does not exist.</p>
                <Link href="/" className="mt-6">
                    <Button variant="outline">Go Back Home</Button>
                </Link>
            </div>
        );
    }
    
    const taskImage = getImage(`task_${taskData.category?.toLowerCase()}`) || getImage('task_other');
    const posterImage = posterData?.photoUrl || getImage('user5')?.imageUrl;

    const isMyTask = taskData.posterId === user?.uid;
    const isAssigned = taskData.status === 'assigned';
    const isAssignedToMe = isAssigned && taskData.buddyId === user?.uid;
    
    const totalEarning = (taskData.budget || 0) + (taskData.tip || 0);

    return (
        <div className="w-full flex flex-col gap-6 text-foreground">
            <header className="relative">
                 <Link href="/" className="absolute top-4 left-4 z-10 p-2 bg-black/50 rounded-full text-white">
                    <ArrowLeft className="w-6 h-6 cursor-pointer hover:text-main-accent transition-colors" />
                </Link>
                {taskImage && (
                    <div className="relative w-full h-64 rounded-b-3xl overflow-hidden">
                        <Image src={taskImage.imageUrl} alt={taskData.title} fill className="object-cover" />
                        <div className="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                    </div>
                )}
                 <div className="absolute bottom-6 left-6 text-white">
                    <h1 className="text-4xl font-bold" style={{textShadow: '0 2px 10px rgba(0,0,0,0.5)'}}>{taskData.title}</h1>
                 </div>
            </header>

            <main className="flex flex-col gap-6 -mt-8">
                <div className="glass-card p-6 z-10">
                    <p className="text-gray-600">{taskData.description}</p>
                </div>

                <div className="glass-card p-6 grid grid-cols-2 gap-x-4 gap-y-6">
                    <DetailItem 
                        icon={<IndianRupee />} 
                        label="Total Earning" 
                        value={
                            <span>
                                {formatCurrency(totalEarning)}
                                {taskData.tip > 0 && <span className="text-xs text-green-500 ml-1">(incl. ₹{taskData.tip} tip)</span>}
                            </span>
                        } 
                    />
                    <DetailItem icon={<Tag />} label="Category" value={taskData.category} />
                    <DetailItem icon={<MapPin />} label="Location" value={taskData.location} />
                    <DetailItem icon={<Calendar />} label="Posted" value={taskData.createdAt ? timeAgo(new Date(taskData.createdAt)) : 'Recently'} />
                    <DetailItem icon={<Clock />} label="Est. Duration" value={taskData.duration} />
                    <DetailItem icon={<Wallet />} label="Payment Mode" value={taskData.paymentMode} />
                </div>

                <div className="glass-card p-6">
                    <h3 className="font-bold text-lg mb-4">Posted By</h3>
                    <div className="flex items-center justify-between">
                         <div className="flex items-center gap-4">
                            {posterImage && <Image src={posterImage} alt={posterData?.name || 'Poster'} width={48} height={48} className="rounded-full border-2 border-secondary-accent" />}
                            <div>
                                <p className="font-bold text-lg">{posterData?.name || 'Loading...'}</p>
                                {posterData?.aadharVerified && (
                                    <div className="flex items-center gap-2 text-sm text-green-500">
                                        <Shield size={14} />
                                        <span>Identity Verified</span>
                                    </div>
                                )}
                            </div>
                        </div>
                        <Link href={`/chat?taskId=${taskId}`}>
                            <Button variant="ghost" size="icon">
                                <MessageSquare className="w-6 h-6 text-main-accent" />
                            </Button>
                        </Link>
                    </div>
                </div>

                <div className="mt-4">
                    {isMyTask ? (
                         <Button disabled className="w-full h-14 text-lg font-bold" variant="outline">This is Your Task</Button>
                    ) : isAssignedToMe ? (
                         <Link href={`/chat?taskId=${taskId}`} className='w-full'>
                            <Button className="w-full h-14 text-lg font-bold bg-green-500 text-white">Open Chat</Button>
                         </Link>
                    ) : isAssigned ? (
                         <Button disabled className="w-full h-14 text-lg font-bold" variant="destructive">Task Already Taken</Button>
                    ) : (
                        <Button onClick={handleAcceptTask} disabled={isAccepting} className="w-full h-14 text-lg font-bold cyan-glow-button">
                           {isAccepting ? <Loader className="w-5 h-5 animate-spin mr-2" /> : <Zap className="w-5 h-5 mr-2" /> }
                           {isAccepting ? "Accepting..." : "Accept Task"}
                        </Button>
                    )}
                </div>
            </main>
        </div>
    );
}

    
--- FILE: src/app/tasks/create/page.tsx ---

'use client';
import { ArrowLeft, Loader, Wand2 } from 'lucide-react';
import Link from 'next/link';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import { Button } from '@/components/ui/button';
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { useToast } from '@/hooks/use-toast';
import { useUser, useFirestore, addDocumentNonBlocking } from '@/firebase';
import * as React from 'react';
import { collection } from 'firebase/firestore';
import { useRouter } from 'next/navigation';
import { generateDescription } from '@/ai/flows/description-flow';
import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';
import { Slider } from '@/components/ui/slider';

const taskSchema = z.object({
  title: z.string().min(5, { message: 'Title must be at least 5 characters.' }),
  description: z.string().min(20, { message: 'Description must be at least 20 characters.' }),
  category: z.string({ required_error: 'Please select a category.' }),
  budget: z.coerce.number().min(1, { message: 'Budget must be at least ₹1.' }),
  location: z.string().min(3, { message: 'Location is required.' }),
  paymentMode: z.enum(['online', 'cash'], { required_error: 'Please select a payment mode.' }),
  duration: z.string().min(3, { message: 'Please enter an estimated duration.' }),
  tip: z.number().optional(),
});

export default function CreateTaskPage() {
    const { toast } = useToast();
    const router = useRouter();
    const { user } = useUser();
    const firestore = useFirestore();
    const [isLoading, setIsLoading] = React.useState(false);
    const [isGenerating, setIsGenerating] = React.useState(false);
    const [tipValue, setTipValue] = React.useState([0]);

    const form = useForm<z.infer<typeof taskSchema>>({
        resolver: zodResolver(taskSchema),
        defaultValues: {
            title: '',
            description: '',
            budget: 0,
            location: '',
            duration: '',
            tip: 0,
        },
    });

    const handleGenerateDescription = async () => {
        const title = form.getValues('title');
        if (!title || title.length < 5) {
            toast({
                variant: 'destructive',
                title: 'Title is too short',
                description: 'Please enter a descriptive title first (at least 5 characters).',
            });
            return;
        }

        setIsGenerating(true);
        try {
            const result = await generateDescription({ title });
            form.setValue('description', result.description, { shouldValidate: true });
            toast({
                title: 'Description Generated!',
                description: 'The AI has crafted a description for you.',
            });
        } catch (error) {
            console.error("Failed to generate description", error);
            toast({
                variant: "destructive",
                title: "AI Error",
                description: "Could not generate description. Please try again.",
            });
        } finally {
            setIsGenerating(false);
        }
    };


    const onSubmit = async (values: z.infer<typeof taskSchema>) => {
        if (!user || !firestore) {
            toast({ variant: 'destructive', title: 'You must be logged in to create a task.' });
            return;
        }
        setIsLoading(true);
        try {
            const tasksCol = collection(firestore, 'tasks');
            await addDocumentNonBlocking(tasksCol, {
                ...values,
                tip: tipValue[0],
                posterId: user.uid,
                status: 'Open',
                createdAt: new Date().toISOString(),
            });
            
            toast({
                title: 'Task Created!',
                description: 'Your task has been posted successfully.',
            });
            router.push('/');

        } catch (error: any) {
            toast({
                variant: 'destructive',
                title: 'Failed to Create Task',
                description: error.message || 'An unknown error occurred.',
            });
            setIsLoading(false);
        }
    };

    return (
        <div className="w-full max-w-md mx-auto flex flex-col gap-6 text-foreground">
            <header className="flex items-center gap-4 p-4">
                <Link href="/">
                    <ArrowLeft className="w-6 h-6 cursor-pointer hover:text-main-accent transition-colors" />
                </Link>
                <h1 className="text-3xl font-bold text-main-accent">Create a New Task</h1>
            </header>

            <main className="flex flex-col gap-4 px-4">
                <div className="glass-card p-6">
                     <Form {...form}>
                        <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
                            <FormField
                                control={form.control}
                                name="title"
                                render={({ field }) => (
                                <FormItem>
                                    <FormLabel>Task Title</FormLabel>
                                    <FormControl>
                                    <Input placeholder="e.g., Fix a leaking pipe" {...field} />
                                    </FormControl>
                                    <FormMessage />
                                </FormItem>
                                )}
                            />
                            <FormField
                                control={form.control}
                                name="description"
                                render={({ field }) => (
                                <FormItem>
                                    <FormLabel>Task Description</FormLabel>
                                    <FormControl>
                                    <div className="relative">
                                        <Textarea placeholder="Describe the task in detail, or click the magic wand to generate one!" {...field} />
                                        <button
                                            type="button"
                                            onClick={handleGenerateDescription}
                                            className="absolute bottom-3 right-3 p-2 rounded-full bg-main-accent/20 hover:bg-main-accent/30 transition-colors"
                                            disabled={isGenerating}
                                            title="Generate with AI"
                                        >
                                            <Wand2 className={`w-5 h-5 text-main-accent ${isGenerating ? 'animate-spin' : ''}`} />
                                        </button>
                                    </div>
                                    </FormControl>
                                    <FormMessage />
                                </FormItem>
                                )}
                            />
                            <FormField
                                control={form.control}
                                name="category"
                                render={({ field }) => (
                                <FormItem>
                                    <FormLabel>Category</FormLabel>
                                    <Select onValueChange={field.onChange} defaultValue={field.value}>
                                    <FormControl>
                                        <SelectTrigger>
                                        <SelectValue placeholder="Select a category" />
                                        </SelectTrigger>
                                    </FormControl>
                                    <SelectContent>
                                        <SelectItem value="Household">Household</SelectItem>
                                        <SelectItem value="Tech">Tech</SelectItem>
                                        <SelectItem value="Cleaning">Cleaning</SelectItem>
                                        <SelectItem value="Delivery">Delivery</SelectItem>
                                        <SelectItem value="Tutoring">Tutoring</SelectItem>
                                        <SelectItem value="Other">Other</SelectItem>
                                    </SelectContent>
                                    </Select>
                                    <FormMessage />
                                </FormItem>
                                )}
                            />
                            <div className="grid grid-cols-2 gap-4">
                                <FormField
                                    control={form.control}
                                    name="budget"
                                    render={({ field }) => (
                                    <FormItem>
                                        <FormLabel>Budget (₹)</FormLabel>
                                        <FormControl>
                                        <Input type="number" placeholder="e.g., 500" {...field} />
                                        </FormControl>
                                        <FormMessage />
                                    </FormItem>
                                    )}
                                />
                                <FormField
                                    control={form.control}
                                    name="location"
                                    render={({ field }) => (
                                    <FormItem>
                                        <FormLabel>Location</FormLabel>
                                        <FormControl>
                                        <Input placeholder="e.g., Mumbai" {...field} />
                                        </FormControl>
                                        <FormMessage />
                                    </FormItem>
                                    )}
                                />
                            </div>

                             <FormField
                                control={form.control}
                                name="duration"
                                render={({ field }) => (
                                <FormItem>
                                    <FormLabel>Time Duration</FormLabel>
                                    <FormControl>
                                    <Input placeholder="e.g., 2 hours" {...field} />
                                    </FormControl>
                                    <FormMessage />
                                </FormItem>
                                )}
                            />

                            <FormField
                                control={form.control}
                                name="paymentMode"
                                render={({ field }) => (
                                    <FormItem className="space-y-3">
                                    <FormLabel>Payment Mode</FormLabel>
                                    <FormControl>
                                        <RadioGroup
                                        onValueChange={field.onChange}
                                        defaultValue={field.value}
                                        className="flex gap-4"
                                        >
                                        <FormItem className="flex items-center space-x-3 space-y-0">
                                            <FormControl>
                                            <RadioGroupItem value="online" />
                                            </FormControl>
                                            <FormLabel className="font-normal">
                                            Online
                                            </FormLabel>
                                        </FormItem>
                                        <FormItem className="flex items-center space-x-3 space-y-0">
                                            <FormControl>
                                            <RadioGroupItem value="cash" />
                                            </FormControl>
                                            <FormLabel className="font-normal">
                                            Cash
                                            </FormLabel>
                                        </FormItem>
                                        </RadioGroup>
                                    </FormControl>
                                    <FormMessage />
                                    </FormItem>
                                )}
                            />

                             <FormField
                                control={form.control}
                                name="tip"
                                render={({ field }) => (
                                    <FormItem>
                                        <FormLabel>Extra Tip (₹{tipValue[0]})</FormLabel>
                                        <FormControl>
                                            <Slider
                                                defaultValue={[0]}
                                                max={100}
                                                step={10}
                                                onValueChange={setTipValue}
                                                className="py-2"
                                            />
                                        </FormControl>
                                    </FormItem>
                                )}
                            />


                            <Button type="submit" className="w-full h-14 text-lg font-bold cyan-glow-button" disabled={isLoading}>
                                {isLoading && <Loader className="mr-2 h-5 w-5 animate-spin" />}
                                Post Task
                            </Button>
                        </form>
                    </Form>
                </div>
            </main>
        </div>
    );
}

    
--- FILE: src/app/ui-kit/page.tsx ---

'use client';

import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Progress, CircleProgress } from "@/components/ui/progress";
import { cn } from "@/lib/utils";
import { AlertTriangle, Award, Check, ChevronRight, Home, Zap } from "lucide-react";
import * as React from "react";

const ComponentShowcase = ({ title, children }: { title: string, children: React.ReactNode }) => (
    <div className="glass-card p-6">
        <h2 className="text-2xl font-bold mb-6 text-main-accent border-b-2 border-main-accent/30 pb-2">{title}</h2>
        <div className="flex flex-wrap items-start gap-4">
            {children}
        </div>
    </div>
);

export default function UIKitPage() {
  const [progress, setProgress] = React.useState(13);

  React.useEffect(() => {
    const timer = setTimeout(() => setProgress(66), 500);
    return () => clearTimeout(timer);
  }, []);

  return (
    <div className="w-full max-w-6xl mx-auto flex flex-col gap-8 text-white pb-28">
        <header className="text-center">
            <h1 className="text-5xl font-bold" style={{ textShadow: '0 0 15px var(--destructive-accent)' }}>UI Component Kit</h1>
            <p className="text-gray-400 mt-2">A showcase of all available UI components with the new monochrome styling.</p>
        </header>

        <ComponentShowcase title="Buttons">
            <Button className="cyan-glow-button h-12 text-base font-bold transition-all duration-300 ease-in-out transform hover:scale-105">
                Glow Button <Zap className="ml-2 w-5 h-5"/>
            </Button>
            <Button variant="outline" className="h-12 text-md glass-card border-secondary-accent/50 text-secondary-accent hover:bg-secondary-accent/10 hover:text-secondary-accent">
                Outline Secondary
            </Button>
            <Button variant="outline" className="h-12 text-md glass-card border-destructive-accent/50 text-destructive-accent hover:bg-destructive-accent/10 hover:text-destructive-accent">
                Outline Destructive
            </Button>
             <Button variant="destructive" className="h-12">
                Destructive
            </Button>
            <Button size="lg" className="pill-active">
                Pill Active
            </Button>
        </ComponentShowcase>

        <ComponentShowcase title="Inputs">
            <Input
                type="text"
                placeholder="Your text here..."
                className="glass-card w-full max-w-sm h-12 px-6 rounded-full border-none focus-visible:ring-2 focus-visible:ring-main-accent"
            />
            <Input
                type="password"
                placeholder="Your password..."
                className="glass-pill w-full max-w-sm h-12 px-6 rounded-md border-secondary-accent/50 focus-visible:ring-2 focus-visible:ring-secondary-accent"
            />
        </ComponentShowcase>

        <ComponentShowcase title="Cards & Pills">
            <Card className="glass-card w-full max-w-sm">
                <CardHeader>
                    <CardTitle className="text-main-accent">Glass Card</CardTitle>
                </CardHeader>
                <CardContent>
                    <p>This is a standard glass-morphic card component.</p>
                </CardContent>
            </Card>
             <div className="p-4 rounded-lg glass-pill w-full max-w-sm">
                <p className="font-bold text-white">Glass Pill</p>
                <p className="text-sm text-gray-400">A smaller, pill-shaped glass component.</p>
            </div>
        </ComponentShowcase>

        <ComponentShowcase title="Progress Bars">
            <div className="w-full max-w-md flex flex-col gap-4">
                <Progress value={progress} className="h-3 [&>div]:bg-main-accent" />
                <Progress value={progress + 20} className="h-3 [&>div]:bg-secondary-accent" />
                <Progress value={progress - 10} className="h-3 [&>div]:bg-destructive-accent" />
            </div>
            <CircleProgress value={72} size={150} strokeWidth={12} color="var(--main-accent)" />
            <CircleProgress value={45} size={120} strokeWidth={10} color="var(--secondary-accent)" />
            <CircleProgress value={90} size={100} strokeWidth={8} color="var(--main-accent)" showPercentage={false}/>
        </ComponentShowcase>
        
        <ComponentShowcase title="Navigation & Badges">
             <nav className="glass-card flex items-center justify-around p-3 rounded-full w-full max-w-sm">
              <a href="#" className="flex flex-col items-center gap-1 text-main-accent">
                 <div className="p-2 bg-main-accent/20 rounded-full">
                    <Home className="w-6 h-6" style={{ filter: 'drop-shadow(0 0 5px var(--main-accent))' }} />
                 </div>
              </a>
              <a href="#" className="flex flex-col items-center gap-1 text-gray-400 hover:text-main-accent transition-colors">
                <Zap className="w-6 h-6" />
              </a>
            </nav>
            <div className="flex flex-col gap-2">
              <div className="bg-destructive-accent/80 text-white text-xs font-bold px-3 py-1 rounded-full shadow-[0_0_8px_var(--destructive-accent)]">
                  Urgent
              </div>
               <span className="text-xs font-semibold px-2 py-1 rounded-full bg-main-accent/20 text-main-accent">New</span>
            </div>
        </ComponentShowcase>

         <ComponentShowcase title="Complex Components">
            <div className="flex items-center gap-4 p-3 glass-pill mb-3 transition-all duration-300 hover:bg-white/5 hover:border-main-accent border border-transparent rounded-lg cursor-pointer group w-full max-w-md">
                <div className="p-3 bg-white/5 rounded-full transition-all duration-300 group-hover:bg-main-accent/10 group-hover:scale-110">
                   <Zap className="w-6 h-6 text-secondary-accent transition-colors duration-300 group-hover:text-main-accent" />
                </div>
                <div className="flex-grow">
                    <p className="font-bold text-white">Advanced List Item</p>p>
                    <p className="text-sm text-gray-400 group-hover:text-gray-300">Subtitle goes here</p>
                </div>
                <div className="flex items-center gap-2">
                   <span className="text-xs font-semibold px-2 py-1 rounded-full bg-main-accent/20 text-main-accent transition-all duration-300">Tag</span>
                   <ChevronRight className="w-5 h-5 text-gray-500 transition-transform duration-300 group-hover:translate-x-1 group-hover:text-main-accent" />
                </div>
            </div>
            <div className="flex items-center justify-center gap-2 text-yellow-400 text-sm glass-card p-2 px-4 cursor-pointer hover:bg-yellow-400/10 transition-all transform hover:scale-105">
                <AlertTriangle className="w-4 h-4" />
                <span>Verification Banner</span>
            </div>
         </ComponentShowcase>
    </div>
  );
}

--- FILE: src/app/wallet/add/page.tsx ---
'use client';
import { ArrowLeft, IndianRupee, Loader, Wallet } from 'lucide-react';
import Link from 'next/link';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { useToast } from '@/hooks/use-toast';
import { useUser, useFirestore, addDocumentNonBlocking, updateDocumentNonBlocking } from '@/firebase';
import * as React from 'react';
import { doc, increment, serverTimestamp, collection } from 'firebase/firestore';
import { useRouter } from 'next/navigation';

declare global {
  interface Window {
    Razorpay: any;
  }
}

async function createOrder(amount: number) {
  try {
    const response = await fetch('/api/razorpay', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ amount: amount * 100 }), // Amount in paise
    });

    if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || 'Failed to create order');
    }
    
    return await response.json();
  } catch (error) {
    console.error("Order creation failed:", error);
    throw error;
  }
}

export default function AddMoneyPage() {
  const [amount, setAmount] = React.useState('');
  const [isLoading, setIsLoading] = React.useState(false);
  const { toast } = useToast();
  const { user } = useUser();
  const firestore = useFirestore();
  const router = useRouter();

  const handlePayment = async () => {
    if (!user || !firestore) {
      toast({ variant: 'destructive', title: 'User not logged in' });
      return;
    }

    const numericAmount = parseFloat(amount);
    if (isNaN(numericAmount) || numericAmount <= 0) {
      toast({ variant: 'destructive', title: 'Invalid Amount', description: 'Please enter a valid amount.' });
      return;
    }

    setIsLoading(true);

    try {
      const order = await createOrder(numericAmount);

      const options = {
        key: process.env.NEXT_PUBLIC_RAZORPAY_KEY_ID,
        amount: order.amount,
        currency: order.currency,
        name: 'Local Buddy Pro',
        description: 'Add Money to Wallet',
        order_id: order.id,
        handler: async function (response: any) {
          const userRef = doc(firestore, 'users', user.uid);
          const transactionRef = collection(firestore, 'transactions');
          
          await updateDocumentNonBlocking(userRef, {
            walletBalance: increment(numericAmount),
          });

          await addDocumentNonBlocking(transactionRef, {
            userId: user.uid,
            amount: numericAmount,
            type: 'add',
            status: 'success',
            timestamp: serverTimestamp(),
            paymentId: response.razorpay_payment_id,
          });

          toast({ title: 'Success!', description: `${numericAmount} added to your wallet.` });
          router.push('/wallet');
        },
        prefill: {
          name: user.displayName || 'Buddy User',
          email: user.email,
        },
        theme: {
          color: '#10B981',
        },
      };

      const rzp = new window.Razorpay(options);
      rzp.open();
    } catch (error: any) {
      toast({
        variant: 'destructive',
        title: 'Payment Failed',
        description: error.message || 'Could not initiate payment.',
      });
    } finally {
      setIsLoading(false);
    }
  };
  
  React.useEffect(() => {
    const script = document.createElement('script');
    script.src = 'https://checkout.razorpay.com/v1/checkout.js';
    script.async = true;
    document.body.appendChild(script);

    return () => {
      document.body.removeChild(script);
    };
  }, []);

  return (
    <div className="w-full max-w-md mx-auto flex flex-col gap-6 text-foreground">
      <header className="flex items-center gap-4 p-4">
        <Link href="/wallet">
          <ArrowLeft className="w-6 h-6 cursor-pointer hover:text-main-accent transition-colors" />
        </Link>
        <h1 className="text-3xl font-bold text-main-accent">Add Money to Wallet</h1>
      </header>

      <main className="glass-card p-8 flex flex-col gap-8">
        <div className="flex flex-col items-center text-center">
            <div className="p-4 bg-main-accent/20 rounded-full mb-4 border border-main-accent/50">
                <Wallet className="w-10 h-10 text-main-accent"/>
            </div>
            <h2 className="text-2xl font-bold">Enter Amount</h2>
            <p className="text-gray-500 mt-1">Add funds to your wallet securely.</p>
        </div>

        <div className="relative">
          <IndianRupee className="absolute left-4 top-1/2 -translate-y-1/2 w-6 h-6 text-gray-400" />
          <Input
            type="number"
            placeholder="0.00"
            value={amount}
            onChange={(e) => setAmount(e.target.value)}
            className="h-16 text-4xl text-center pl-12 glass-card border-none focus-visible:ring-2 focus-visible:ring-main-accent"
            disabled={isLoading}
          />
        </div>

        <Button onClick={handlePayment} disabled={isLoading || !amount} className="w-full h-14 text-lg font-bold cyan-glow-button">
          {isLoading ? (
            <Loader className="mr-2 h-6 w-6 animate-spin" />
          ) : (
            'Add Money'
          )}
        </Button>
      </main>
    </div>
  );
}

--- FILE: src/app/wallet/page.tsx ---

'use client';
import { Wallet, Lock, ArrowDown, ArrowUp, AlertTriangle, ShieldCheck, CreditCard, Banknote, History, ChevronRight, Loader, Plus } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Progress } from "@/components/ui/progress";
import * as React from 'react';
import { cn, formatCurrency } from '@/lib/utils';
import { useUser, useFirestore, useDoc, useMemoFirebase } from '@/firebase';
import { collection, query, where, orderBy, doc, getDocs } from 'firebase/firestore';
import Link from 'next/link';

const TransactionItem = ({ icon, title, date, amount, color, type }: { icon: React.ReactNode, title: string, date: string, amount: string, color: string, type: string }) => (
  <div className={cn("flex items-center justify-between glass-pill p-3 my-2 hover:bg-gray-100 transition-all border border-transparent rounded-lg group cursor-pointer")}>
    <div className="flex items-center gap-4">
      <div className={cn(`p-3 rounded-full glass-pill transition-all duration-300 group-hover:scale-110`, color ? `bg-${color.replace('text-','')}/10` : '')}>{icon}</div>
      <div>
        <p className="font-semibold text-foreground group-hover:text-main-accent transition-colors">{title}</p>
        <p className="text-xs text-gray-500">{date} - {type}</p>
      </div>
    </div>
    <p className={cn(`font-bold text-lg`, color)}>{amount}</p>
  </div>
);

const BalanceCard = ({ title, balance, icon, color, progress, isLoading }: { title: string, balance: number, icon: React.ReactNode, color: string, progress: number, isLoading: boolean }) => {
    const accentColor = color.split('-')[0];
    
    return (
    <div className="glass-card p-6 relative overflow-hidden group">
        <div className={cn(`absolute -top-1/4 -left-1/4 w-1/2 h-1/2 rounded-full blur-3xl transition-all duration-500 group-hover:scale-150`, `bg-${accentColor}-500/30`)}></div>
        <div className="relative z-10">
            <div className="flex items-start justify-between">
                <div>
                  {isLoading ? <Loader className="w-8 h-8 animate-spin text-gray-400" /> : <p className="text-4xl font-bold text-foreground">{formatCurrency(balance)}</p>}
                  <p className="text-gray-500 mt-1">{title}</p>
                </div>
                {React.cloneElement(icon as React.ReactElement, { className: `w-8 h-8 text-${accentColor}-500 transition-transform duration-300 group-hover:scale-125 group-hover:rotate-6`, style: { filter: `drop-shadow(0 0 10px var(--${accentColor}))` } })}
            </div>
            <div className="mt-6">
                <div className="flex justify-between text-xs text-gray-500 mb-1">
                    <span>Spending Limit</span>
                    <span>₹{progress * 100} / ₹10000</span>
                </div>
                <Progress value={progress} className={cn(`h-2 bg-gray-200 [&>div]:bg-${accentColor}-500`)} />
            </div>
        </div>
    </div>
)};

const ActionMenuItem = ({icon, title, subtitle}: {icon: React.ReactNode, title: string, subtitle: string}) => (
    <div className="flex items-center p-3 glass-pill w-full hover:bg-gray-100 transition-colors cursor-pointer rounded-lg group">
        <div className="p-2 bg-gray-100 rounded-lg mr-4 transition-all duration-300 group-hover:scale-110 group-hover:bg-main-accent/20">
            {React.cloneElement(icon as React.ReactElement, { className: 'w-6 h-6 transition-colors duration-300 group-hover:text-main-accent'})}
        </div>
        <div className="flex-grow">
            <p className="font-semibold text-foreground">{title}</p>
            <p className="text-xs text-gray-500 group-hover:text-gray-600">{subtitle}</p>
        </div>
        <ChevronRight className="w-5 h-5 text-gray-500 transition-transform duration-300 group-hover:translate-x-1 group-hover:text-main-accent" />
    </div>
);

export default function WalletPage() {
  const { user } = useUser();
  const firestore = useFirestore();
  const [filter, setFilter] = React.useState('All');
  const [transactions, setTransactions] = React.useState<any[]>([]);
  const [isTransactionsLoading, setIsTransactionsLoading] = React.useState(true);
  const filters = ['All', 'Income', 'Outcome', 'Escrow'];

  const userDocRef = useMemoFirebase(() => {
    if (!firestore || !user) return null;
    return doc(firestore, 'users', user.uid);
  }, [firestore, user]);
  const { data: userData, isLoading: isUserLoading } = useDoc(userDocRef);

  React.useEffect(() => {
    const fetchTransactions = async () => {
      if (!firestore || !user) {
        setIsTransactionsLoading(false);
        return;
      }
      setIsTransactionsLoading(true);
      try {
        const transactionsRef = collection(firestore, 'transactions');
        const q = query(transactionsRef, where('userId', '==', user.uid));
        const querySnapshot = await getDocs(q);
        const userTransactions = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

        userTransactions.sort((a, b) => {
          const dateA = a.timestamp?.toDate() || 0;
          const dateB = b.timestamp?.toDate() || 0;
          return dateB - dateA;
        });

        setTransactions(userTransactions);
      } catch (error) {
        console.error("Error fetching transactions:", error);
      } finally {
        setIsTransactionsLoading(false);
      }
    };

    fetchTransactions();
  }, [firestore, user]);


  const filteredTransactions = React.useMemo(() => {
    if (!transactions) return [];
    if (filter === 'All') return transactions;
    
    const incomeTypes = ['release', 'add'];
    const outcomeTypes = ['withdraw'];
    const escrowTypes = ['lock'];
    
    switch(filter) {
        case 'Income':
            return transactions.filter(t => incomeTypes.includes(t.type));
        case 'Outcome':
            return transactions.filter(t => outcomeTypes.includes(t.type));
        case 'Escrow':
            return transactions.filter(t => escrowTypes.includes(t.type));
        default:
             return transactions;
    }
  }, [transactions, filter]);


  const getTransactionIcon = (type: string) => {
    switch (type) {
      case 'release':
      case 'add':
        return <ArrowUp className="w-5 h-5 text-green-500" />;
      case 'withdraw':
        return <ArrowDown className="w-5 h-5 text-main-accent" />;
      case 'lock':
        return <Lock className="w-5 h-5 text-yellow-500" />;
      default:
        return <Wallet className="w-5 h-5 text-gray-500" />;
    }
  };
  
  const getTransactionColor = (type: string) => {
      switch (type) {
          case 'release':
          case 'add':
              return "text-green-500";
          case 'withdraw':
              return "text-main-accent";
          case 'lock':
              return "text-yellow-500";
          default:
              return "text-red-500";
      }
  };

  const getTransactionAmount = (transaction: any) => {
      switch (transaction.type) {
          case 'release':
          case 'add':
              return `+ ${formatCurrency(transaction.amount)}`;
          case 'withdraw':
          case 'lock':
               return `- ${formatCurrency(transaction.amount)}`;
          default:
              return formatCurrency(transaction.amount);
      }
  };
  
  const VerificationBanner = () => (
    <div className="flex items-center justify-center gap-2 text-yellow-600 text-sm glass-card p-2 px-4 cursor-pointer hover:bg-yellow-500/10 transition-all transform hover:scale-105">
        <AlertTriangle className="w-4 h-4" />
        <span>ID Verification Needed for Higher Limits</span>
    </div>
  );

  const availableBalance = userData?.walletBalance ?? 0;
  
  const lockedBalance = transactions
    ?.filter(t => t.type === 'lock' && t.status === 'success')
    .reduce((acc, t) => acc + t.amount, 0) ?? 0;

  return (
    <>
       <header className="glass-card p-4 text-center">
        <h1 className="text-3xl font-bold">Wallet & Finance</h1>
        <p className="text-gray-500 text-sm mt-1">Manage your funds and transactions securely</p>
       </header>

      <section className="flex flex-col gap-6">
        <BalanceCard 
            title="Available Balance"
            balance={availableBalance}
            icon={<Wallet />}
            color="green-500"
            progress={isUserLoading ? 0 : (availableBalance / 10000) * 100}
            isLoading={isUserLoading}
        />
        <BalanceCard 
            title="Locked in Escrow"
            balance={lockedBalance}
            icon={<Lock />}
            color="yellow-500"
            progress={isTransactionsLoading ? 0 : (lockedBalance / 10000) * 100}
            isLoading={isTransactionsLoading}
        />
      </section>

      <section className="flex flex-col items-center gap-3">
        <div className="grid grid-cols-2 gap-4 w-full">
            <Link href="/wallet/add" className="w-full">
                <Button className="w-full text-white font-bold py-4 rounded-full text-lg h-14 cyan-glow-button transform hover:scale-105 transition-transform">
                    <Plus className="mr-2"/> Add Money
                </Button>
            </Link>
            <Button className="w-full text-black font-bold py-4 rounded-full text-lg h-14 glass-pill transform hover:scale-105 transition-transform">
                Withdraw
            </Button>
        </div>
        <VerificationBanner />
      </section>

      <section className="flex flex-col gap-4">
        <h2 className="text-xl font-bold px-2">Quick Actions</h2>
        <div className="flex flex-col gap-3 glass-card p-4">
            <ActionMenuItem icon={<CreditCard />} title="Manage Payment Methods" subtitle="Add or remove cards & UPI" />
            <ActionMenuItem icon={<Banknote />} title="Setup Auto-Withdrawal" subtitle="Weekly to your primary bank" />
            <ActionMenuItem icon={<History />} title="Download Statement" subtitle="Get PDF statement for any period" />
            <ActionMenuItem icon={<ShieldCheck />} title="Security Center" subtitle="Manage your account security" />
        </div>
      </section>

      <section className="flex flex-col gap-4">
        <div className="flex justify-between items-center px-2">
            <h2 className="text-xl font-bold">Transaction History</h2>
            <div className="flex items-center gap-2 text-main-accent">
                <ShieldCheck className="w-6 h-6" />
                <span className="text-xs font-semibold">Secured</span>
            </div>
        </div>
        
        <div className="flex items-center gap-2 overflow-x-auto pb-2 -ml-4 pl-4">
          {filters.map((f) => (
            <button
              key={f}
              onClick={() => setFilter(f)}
              className={cn(
                'px-4 py-1.5 rounded-full text-sm font-semibold transition-all duration-300 whitespace-nowrap transform hover:-translate-y-0.5',
                filter === f
                  ? 'pill-active'
                  : 'glass-card text-gray-500 hover:bg-gray-100'
              )}
            >
              {f}
            </button>
          ))}
        </div>
        
        <div className="flex flex-col gap-3 glass-card p-4 min-h-[200px]">
          {isTransactionsLoading ? (
            <div className="flex justify-center items-center h-full">
              <Loader className="w-8 h-8 animate-spin text-gray-400" />
            </div>
          ) : (filteredTransactions && filteredTransactions.length > 0) ? filteredTransactions.map((item: any) => (
            <TransactionItem
              key={item.id}
              icon={getTransactionIcon(item.type)}
              title={item.taskId ? `Task: ${item.taskId.slice(0,6)}...` : 'Wallet Action'}
              date={new Date(item.timestamp?.toDate()).toLocaleDateString()}
              amount={getTransactionAmount(item)}
              color={getTransactionColor(item.type)}
              type={item.type}
            />
          )) : (
            <div className="text-center text-gray-500 py-8 flex flex-col items-center">
                <Wallet className="w-12 h-12 text-gray-300 mb-4" />
                <p>No transactions found for this filter.</p>
                <p className="text-xs mt-1">Try selecting another category.</p>
            </div>
          )}
        </div>
      </section>
    </>
  );
}

--- FILE: src/components/FirebaseErrorListener.tsx ---
'use client';

import { useState, useEffect } from 'react';
import { errorEmitter } from '@/firebase/error-emitter';
import { FirestorePermissionError } from '@/firebase/errors';

/**
 * An invisible component that listens for globally emitted 'permission-error' events.
 * It throws any received error to be caught by Next.js's global-error.tsx.
 */
export function FirebaseErrorListener() {
  // Use the specific error type for the state for type safety.
  const [error, setError] = useState<FirestorePermissionError | null>(null);

  useEffect(() => {
    // The callback now expects a strongly-typed error, matching the event payload.
    const handleError = (error: FirestorePermissionError) => {
      // Set error in state to trigger a re-render.
      setError(error);
    };

    // The typed emitter will enforce that the callback for 'permission-error'
    // matches the expected payload type (FirestorePermissionError).
    errorEmitter.on('permission-error', handleError);

    // Unsubscribe on unmount to prevent memory leaks.
    return () => {
      errorEmitter.off('permission-error', handleError);
    };
  }, []);

  // On re-render, if an error exists in state, throw it.
  if (error) {
    throw error;
  }

  // This component renders nothing.
  return null;
}

--- FILE: src/components/ProfileSetupDialog.tsx ---

'use client';
import * as React from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import { motion, AnimatePresence } from 'framer-motion';
import { User, Check, Languages, ArrowRight } from 'lucide-react';
import { useUser, useFirestore, setDocumentNonBlocking } from '@/firebase';
import { doc } from 'firebase/firestore';
import { Input } from './ui/input';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from './ui/select';
import { Form, FormControl, FormField, FormItem, FormMessage } from './ui/form';
import { cn } from '@/lib/utils';
import { Button } from './ui/button';

const profileSchema = z.object({
  name: z.string().min(3, { message: 'Name must be at least 3 characters.' }),
  birthYear: z.string().nonempty({ message: 'Please select a year.' }),
  appLanguage: z.string().optional(),
});

type ProfileFormData = z.infer<typeof profileSchema>;

const StepVariants = {
  hidden: (direction: number) => ({
    opacity: 0,
    x: direction > 0 ? 200 : -200,
  }),
  visible: {
    opacity: 1,
    x: 0,
    transition: { type: 'spring', stiffness: 260, damping: 20 },
  },
  exit: (direction: number) => ({
    opacity: 0,
    x: direction < 0 ? 200 : -200,
    transition: { duration: 0.3 },
  }),
};

type ProfileSetupDialogProps = {
  onOpenChange: (isOpen: boolean) => void;
};

export function ProfileSetupDialog({ onOpenChange }: ProfileSetupDialogProps) {
  const [isOpen, setIsOpen] = React.useState(false);
  const [step, setStep] = React.useState(0);
  const [direction, setDirection] = React.useState(1);
  const { user } = useUser();
  const firestore = useFirestore();

  const form = useForm<ProfileFormData>({
    resolver: zodResolver(profileSchema),
    defaultValues: { name: '', birthYear: '', appLanguage: 'english' },
  });

  const {
    handleSubmit,
    trigger,
    setValue,
    watch,
    control,
    formState: { errors },
  } = form;
  const appLanguage = watch('appLanguage');

  const years = Array.from(
    { length: new Date().getFullYear() - 1899 },
    (_, i) => (new Date().getFullYear() - i).toString()
  );

  const nextStep = async () => {
    let isValid = false;
    if (step === 0) isValid = await trigger('name');
    if (step === 1) isValid = await trigger('birthYear');
    if (isValid) {
      setDirection(1);
      setStep((s) => s + 1);
    }
  };

  const prevStep = () => {
    setDirection(-1);
    setStep((s) => s - 1);
  };

  const onSubmit = (data: ProfileFormData) => {
    if (!user || !firestore) return;
    const userRef = doc(firestore, 'users', user.uid);
    setDocumentNonBlocking(userRef, {
        name: data.name,
        birthYear: parseInt(data.birthYear, 10),
        appLanguage: data.appLanguage,
        profileCompleted: true,
      },
      { merge: true }
    );
    setIsOpen(false);
  };
  
  React.useEffect(() => {
    const timer = setTimeout(() => setIsOpen(true), 2000);
    return () => clearTimeout(timer);
  }, []);

  React.useEffect(() => {
    onOpenChange(isOpen);
  }, [isOpen, onOpenChange]);

  return (
    <>
      <AnimatePresence>
        {isOpen && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm"
          >
            <motion.div
              initial={{ scale: 0.9, opacity: 0.8 }}
              animate={{ scale: 1, opacity: 1 }}
              exit={{ scale: 0.9, opacity: 0 }}
              className="glass-card w-full max-w-md m-4 p-6 sm:p-8 rounded-2xl overflow-hidden"
            >
              <Form {...form}>
                <form onSubmit={handleSubmit(onSubmit)}>
                  <AnimatePresence initial={false} custom={direction}>
                    {step === 0 && (
                      <motion.div
                        key="step0"
                        custom={direction}
                        variants={StepVariants}
                        initial="hidden"
                        animate="visible"
                        exit="exit"
                        className="flex flex-col items-center text-center"
                      >
                        <div className="bg-main-accent/20 p-4 rounded-full mb-4 border border-main-accent/50">
                          <User className="w-8 h-8 text-main-accent" />
                        </div>
                        <h2 className="text-2xl font-bold mb-2">What should we call you?</h2>
                        <p className="text-gray-500 mb-6">Let's get your identity set up.</p>
                        <FormField
                          control={control}
                          name="name"
                          render={({ field }) => (
                            <FormItem className="w-full">
                              <FormControl>
                                <Input {...field} placeholder="Enter your name" className="h-12 text-center glass-card" />
                              </FormControl>
                              <FormMessage />
                            </FormItem>
                          )}
                        />
                        <Button type="button" onClick={nextStep} className="cyan-glow-button mt-6 w-full h-12 text-lg">
                          Next
                        </Button>
                      </motion.div>
                    )}

                    {step === 1 && (
                      <motion.div
                        key="step1"
                        custom={direction}
                        variants={StepVariants}
                        initial="hidden"
                        animate="visible"
                        exit="exit"
                        className="flex flex-col items-center text-center"
                      >
                        <div className="bg-main-accent/20 p-4 rounded-full mb-4 border border-main-accent/50">
                          <User className="w-8 h-8 text-main-accent" />
                        </div>
                        <h2 className="text-2xl font-bold mb-2">When were you born?</h2>
                        <p className="text-gray-500 mb-6">This helps us personalize your experience.</p>
                        <FormField
                          control={control}
                          name="birthYear"
                          render={({ field }) => (
                            <FormItem className="w-full">
                               <Select onValueChange={field.onChange} defaultValue={field.value}>
                                <FormControl>
                                  <SelectTrigger className="h-12 text-center glass-card">
                                    <SelectValue placeholder="Select your birth year" />
                                  </SelectTrigger>
                                </FormControl>
                                <SelectContent className="glass-card">
                                    {years.map((year) => (
                                    <SelectItem key={year} value={year}>{year}</SelectItem>
                                    ))}
                                </SelectContent>
                              </Select>
                              <FormMessage />
                            </FormItem>
                          )}
                        />
                        <div className="flex gap-4 w-full mt-6">
                          <Button type="button" onClick={prevStep} className="glass-card w-full h-12 text-lg" variant="outline">Back</Button>
                          <Button type="button" onClick={nextStep} className="cyan-glow-button w-full h-12 text-lg">Next</Button>
                        </div>
                      </motion.div>
                    )}

                    {step === 2 && (
                      <motion.div
                        key="step2"
                        custom={direction}
                        variants={StepVariants}
                        initial="hidden"
                        animate="visible"
                        exit="exit"
                        className="flex flex-col items-center text-center"
                      >
                        <div className="bg-main-accent/20 p-4 rounded-full mb-4 border border-main-accent/50">
                          <Languages className="w-8 h-8 text-main-accent" />
                        </div>
                        <h2 className="text-2xl font-bold mb-2">Choose your language</h2>
                        <p className="text-gray-500 mb-6">Select the language for your app interface.</p>
                        <div className="w-full space-y-3">
                           <div 
                            onClick={() => setValue('appLanguage', 'english')} 
                            className={cn('glass-card p-4 rounded-lg cursor-pointer border-2 transition-all', appLanguage === 'english' ? 'border-main-accent' : 'border-transparent')}
                          >
                            <p className="text-lg font-bold">English</p>
                          </div>
                          <div 
                            onClick={() => setValue('appLanguage', 'hindi')}
                            className={cn('glass-card p-4 rounded-lg cursor-pointer border-2 transition-all', appLanguage === 'hindi' ? 'border-main-accent' : 'border-transparent')}
                          >
                             <p className="text-lg font-bold">हिंदी (Hindi)</p>
                          </div>
                        </div>
                         <div className="flex gap-4 w-full mt-6">
                          <Button type="button" onClick={prevStep} className="glass-card w-full h-12 text-lg" variant="outline">Back</Button>
                          <Button type="submit" className="cyan-glow-button w-full h-12 text-lg flex items-center justify-center gap-2">
                            Finish <ArrowRight className="w-5 h-5"/>
                          </Button>
                        </div>
                      </motion.div>
                    )}

                  </AnimatePresence>
                </form>
              </Form>
            </motion.div>
          </motion.div>
        )}
      </AnimatePresence>
    </>
  );
}

--- FILE: src/components/ui/accordion.tsx ---
"use client"

import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const Accordion = AccordionPrimitive.Root

const AccordionItem = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>
>(({ className, ...props }, ref) => (
  <AccordionPrimitive.Item
    ref={ref}
    className={cn("border-b", className)}
    {...props}
  />
))
AccordionItem.displayName = "AccordionItem"

const AccordionTrigger = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Header className="flex">
    <AccordionPrimitive.Trigger
      ref={ref}
      className={cn(
        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",
        className
      )}
      {...props}
    >
      {children}
      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />
    </AccordionPrimitive.Trigger>
  </AccordionPrimitive.Header>
))
AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName

const AccordionContent = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Content
    ref={ref}
    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"
    {...props}
  >
    <div className={cn("pb-4 pt-0", className)}>{children}</div>
  </AccordionPrimitive.Content>
))

AccordionContent.displayName = AccordionPrimitive.Content.displayName

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }

--- FILE: src/components/ui/alert-dialog.tsx ---
"use client"

import * as React from "react"
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

const AlertDialog = AlertDialogPrimitive.Root

const AlertDialogTrigger = AlertDialogPrimitive.Trigger

const AlertDialogPortal = AlertDialogPrimitive.Portal

const AlertDialogOverlay = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
AlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName

const AlertDialogContent = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>
>(({ className, ...props }, ref) => (
  <AlertDialogPortal>
    <AlertDialogOverlay />
    <AlertDialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    />
  </AlertDialogPortal>
))
AlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName

const AlertDialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
AlertDialogHeader.displayName = "AlertDialogHeader"

const AlertDialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
AlertDialogFooter.displayName = "AlertDialogFooter"

const AlertDialogTitle = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold", className)}
    {...props}
  />
))
AlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName

const AlertDialogDescription = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
AlertDialogDescription.displayName =
  AlertDialogPrimitive.Description.displayName

const AlertDialogAction = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Action>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Action
    ref={ref}
    className={cn(buttonVariants(), className)}
    {...props}
  />
))
AlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName

const AlertDialogCancel = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Cancel
    ref={ref}
    className={cn(
      buttonVariants({ variant: "outline" }),
      "mt-2 sm:mt-0",
      className
    )}
    {...props}
  />
))
AlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}

--- FILE: src/components/ui/alert.tsx ---
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive:
          "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Alert = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>
>(({ className, variant, ...props }, ref) => (
  <div
    ref={ref}
    role="alert"
    className={cn(alertVariants({ variant }), className)}
    {...props}
  />
))
Alert.displayName = "Alert"

const AlertTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h5
    ref={ref}
    className={cn("mb-1 font-medium leading-none tracking-tight", className)}
    {...props}
  />
))
AlertTitle.displayName = "AlertTitle"

const AlertDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm [&_p]:leading-relaxed", className)}
    {...props}
  />
))
AlertDescription.displayName = "AlertDescription"

export { Alert, AlertTitle, AlertDescription }

--- FILE: src/components/ui/avatar.tsx ---
"use client"

import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",
      className
    )}
    {...props}
  />
))
Avatar.displayName = AvatarPrimitive.Root.displayName

const AvatarImage = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Image>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Image
    ref={ref}
    className={cn("aspect-square h-full w-full", className)}
    {...props}
  />
))
AvatarImage.displayName = AvatarPrimitive.Image.displayName

const AvatarFallback = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Fallback>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Fallback
    ref={ref}
    className={cn(
      "flex h-full w-full items-center justify-center rounded-full bg-muted",
      className
    )}
    {...props}
  />
))
AvatarFallback.displayName = AvatarPrimitive.Fallback.displayName

export { Avatar, AvatarImage, AvatarFallback }

--- FILE: src/components/ui/badge.tsx ---
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  )
}

export { Badge, badgeVariants }

--- FILE: src/components/ui/button.tsx ---
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }

--- FILE: src/components/ui/calendar.tsx ---
"use client"

import * as React from "react"
import { ChevronLeft, ChevronRight } from "lucide-react"
import { DayPicker } from "react-day-picker"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

export type CalendarProps = React.ComponentProps<typeof DayPicker>

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  ...props
}: CalendarProps) {
  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn("p-3", className)}
      classNames={{
        months: "flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",
        month: "space-y-4",
        caption: "flex justify-center pt-1 relative items-center",
        caption_label: "text-sm font-medium",
        nav: "space-x-1 flex items-center",
        nav_button: cn(
          buttonVariants({ variant: "outline" }),
          "h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"
        ),
        nav_button_previous: "absolute left-1",
        nav_button_next: "absolute right-1",
        table: "w-full border-collapse space-y-1",
        head_row: "flex",
        head_cell:
          "text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",
        row: "flex w-full mt-2",
        cell: "h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",
        day: cn(
          buttonVariants({ variant: "ghost" }),
          "h-9 w-9 p-0 font-normal aria-selected:opacity-100"
        ),
        day_range_end: "day-range-end",
        day_selected:
          "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",
        day_today: "bg-accent text-accent-foreground",
        day_outside:
          "day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",
        day_disabled: "text-muted-foreground opacity-50",
        day_range_middle:
          "aria-selected:bg-accent aria-selected:text-accent-foreground",
        day_hidden: "invisible",
        ...classNames,
      }}
      components={{
        IconLeft: ({ className, ...props }) => (
          <ChevronLeft className={cn("h-4 w-4", className)} {...props} />
        ),
        IconRight: ({ className, ...props }) => (
          <ChevronRight className={cn("h-4 w-4", className)} {...props} />
        ),
      }}
      {...props}
    />
  )
}
Calendar.displayName = "Calendar"

export { Calendar }

--- FILE: src/components/ui/card.tsx ---
import * as React from "react"

import { cn } from "@/lib/utils"

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-lg border bg-card text-card-foreground shadow-sm",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }

--- FILE: src/components/ui/carousel.tsx ---
"use client"

import * as React from "react"
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react"
import { ArrowLeft, ArrowRight } from "lucide-react"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"

type CarouselApi = UseEmblaCarouselType[1]
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>
type CarouselOptions = UseCarouselParameters[0]
type CarouselPlugin = UseCarouselParameters[1]

type CarouselProps = {
  opts?: CarouselOptions
  plugins?: CarouselPlugin
  orientation?: "horizontal" | "vertical"
  setApi?: (api: CarouselApi) => void
}

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0]
  api: ReturnType<typeof useEmblaCarousel>[1]
  scrollPrev: () => void
  scrollNext: () => void
  canScrollPrev: boolean
  canScrollNext: boolean
} & CarouselProps

const CarouselContext = React.createContext<CarouselContextProps | null>(null)

function useCarousel() {
  const context = React.useContext(CarouselContext)

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />")
  }

  return context
}

const Carousel = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & CarouselProps
>(
  (
    {
      orientation = "horizontal",
      opts,
      setApi,
      plugins,
      className,
      children,
      ...props
    },
    ref
  ) => {
    const [carouselRef, api] = useEmblaCarousel(
      {
        ...opts,
        axis: orientation === "horizontal" ? "x" : "y",
      },
      plugins
    )
    const [canScrollPrev, setCanScrollPrev] = React.useState(false)
    const [canScrollNext, setCanScrollNext] = React.useState(false)

    const onSelect = React.useCallback((api: CarouselApi) => {
      if (!api) {
        return
      }

      setCanScrollPrev(api.canScrollPrev())
      setCanScrollNext(api.canScrollNext())
    }, [])

    const scrollPrev = React.useCallback(() => {
      api?.scrollPrev()
    }, [api])

    const scrollNext = React.useCallback(() => {
      api?.scrollNext()
    }, [api])

    const handleKeyDown = React.useCallback(
      (event: React.KeyboardEvent<HTMLDivElement>) => {
        if (event.key === "ArrowLeft") {
          event.preventDefault()
          scrollPrev()
        } else if (event.key === "ArrowRight") {
          event.preventDefault()
          scrollNext()
        }
      },
      [scrollPrev, scrollNext]
    )

    React.useEffect(() => {
      if (!api || !setApi) {
        return
      }

      setApi(api)
    }, [api, setApi])

    React.useEffect(() => {
      if (!api) {
        return
      }

      onSelect(api)
      api.on("reInit", onSelect)
      api.on("select", onSelect)

      return () => {
        api?.off("select", onSelect)
      }
    }, [api, onSelect])

    return (
      <CarouselContext.Provider
        value={{
          carouselRef,
          api: api,
          opts,
          orientation:
            orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
          scrollPrev,
          scrollNext,
          canScrollPrev,
          canScrollNext,
        }}
      >
        <div
          ref={ref}
          onKeyDownCapture={handleKeyDown}
          className={cn("relative", className)}
          role="region"
          aria-roledescription="carousel"
          {...props}
        >
          {children}
        </div>
      </CarouselContext.Provider>
    )
  }
)
Carousel.displayName = "Carousel"

const CarouselContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { carouselRef, orientation } = useCarousel()

  return (
    <div ref={carouselRef} className="overflow-hidden">
      <div
        ref={ref}
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className
        )}
        {...props}
      />
    </div>
  )
})
CarouselContent.displayName = "CarouselContent"

const CarouselItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { orientation } = useCarousel()

  return (
    <div
      ref={ref}
      role="group"
      aria-roledescription="slide"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className
      )}
      {...props}
    />
  )
})
CarouselItem.displayName = "CarouselItem"

const CarouselPrevious = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute  h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-left-12 top-1/2 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft className="h-4 w-4" />
      <span className="sr-only">Previous slide</span>
    </Button>
  )
})
CarouselPrevious.displayName = "CarouselPrevious"

const CarouselNext = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollNext, canScrollNext } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-right-12 top-1/2 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight className="h-4 w-4" />
      <span className="sr-only">Next slide</span>
    </Button>
  )
})
CarouselNext.displayName = "CarouselNext"

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
}

--- FILE: src/components/ui/chart.tsx ---
"use client"

import * as React from "react"
import * as RechartsPrimitive from "recharts"

import { cn } from "@/lib/utils"

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode
    icon?: React.ComponentType
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  )
}

type ChartContextProps = {
  config: ChartConfig
}

const ChartContext = React.createContext<ChartContextProps | null>(null)

function useChart() {
  const context = React.useContext(ChartContext)

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />")
  }

  return context
}

const ChartContainer = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    config: ChartConfig
    children: React.ComponentProps<
      typeof RechartsPrimitive.ResponsiveContainer
    >["children"]
  }
>(({ id, className, children, config, ...props }, ref) => {
  const uniqueId = React.useId()
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-chart={chartId}
        ref={ref}
        className={cn(
          "flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",
          className
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  )
})
ChartContainer.displayName = "Chart"

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([, config]) => config.theme || config.color
  )

  if (!colorConfig.length) {
    return null
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color
    return color ? `  --color-${key}: ${color};` : null
  })
  .join("\n")}
}
`
          )
          .join("\n"),
      }}
    />
  )
}

const ChartTooltip = RechartsPrimitive.Tooltip

const ChartTooltipContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
    React.ComponentProps<"div"> & {
      hideLabel?: boolean
      hideIndicator?: boolean
      indicator?: "line" | "dot" | "dashed"
      nameKey?: string
      labelKey?: string
    }
>(
  (
    {
      active,
      payload,
      className,
      indicator = "dot",
      hideLabel = false,
      hideIndicator = false,
      label,
      labelFormatter,
      labelClassName,
      formatter,
      color,
      nameKey,
      labelKey,
    },
    ref
  ) => {
    const { config } = useChart()

    const tooltipLabel = React.useMemo(() => {
      if (hideLabel || !payload?.length) {
        return null
      }

      const [item] = payload
      const key = `${labelKey || item.dataKey || item.name || "value"}`
      const itemConfig = getPayloadConfigFromPayload(config, item, key)
      const value =
        !labelKey && typeof label === "string"
          ? config[label as keyof typeof config]?.label || label
          : itemConfig?.label

      if (labelFormatter) {
        return (
          <div className={cn("font-medium", labelClassName)}>
            {labelFormatter(value, payload)}
          </div>
        )
      }

      if (!value) {
        return null
      }

      return <div className={cn("font-medium", labelClassName)}>{value}</div>
    }, [
      label,
      labelFormatter,
      payload,
      hideLabel,
      labelClassName,
      config,
      labelKey,
    ])

    if (!active || !payload?.length) {
      return null
    }

    const nestLabel = payload.length === 1 && indicator !== "dot"

    return (
      <div
        ref={ref}
        className={cn(
          "grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",
          className
        )}
      >
        {!nestLabel ? tooltipLabel : null}
        <div className="grid gap-1.5">
          {payload.map((item, index) => {
            const key = `${nameKey || item.name || item.dataKey || "value"}`
            const itemConfig = getPayloadConfigFromPayload(config, item, key)
            const indicatorColor = color || item.payload.fill || item.color

            return (
              <div
                key={item.dataKey}
                className={cn(
                  "flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",
                  indicator === "dot" && "items-center"
                )}
              >
                {formatter && item?.value !== undefined && item.name ? (
                  formatter(item.value, item.name, item, index, item.payload)
                ) : (
                  <>
                    {itemConfig?.icon ? (
                      <itemConfig.icon />
                    ) : (
                      !hideIndicator && (
                        <div
                          className={cn(
                            "shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",
                            {
                              "h-2.5 w-2.5": indicator === "dot",
                              "w-1": indicator === "line",
                              "w-0 border-[1.5px] border-dashed bg-transparent":
                                indicator === "dashed",
                              "my-0.5": nestLabel && indicator === "dashed",
                            }
                          )}
                          style={
                            {
                              "--color-bg": indicatorColor,
                              "--color-border": indicatorColor,
                            } as React.CSSProperties
                          }
                        />
                      )
                    )}
                    <div
                      className={cn(
                        "flex flex-1 justify-between leading-none",
                        nestLabel ? "items-end" : "items-center"
                      )}
                    >
                      <div className="grid gap-1.5">
                        {nestLabel ? tooltipLabel : null}
                        <span className="text-muted-foreground">
                          {itemConfig?.label || item.name}
                        </span>
                      </div>
                      {item.value && (
                        <span className="font-mono font-medium tabular-nums text-foreground">
                          {item.value.toLocaleString()}
                        </span>
                      )}
                    </div>
                  </>
                )}
              </div>
            )
          })}
        </div>
      </div>
    )
  }
)
ChartTooltipContent.displayName = "ChartTooltip"

const ChartLegend = RechartsPrimitive.Legend

const ChartLegendContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> &
    Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
      hideIcon?: boolean
      nameKey?: string
    }
>(
  (
    { className, hideIcon = false, payload, verticalAlign = "bottom", nameKey },
    ref
  ) => {
    const { config } = useChart()

    if (!payload?.length) {
      return null
    }

    return (
      <div
        ref={ref}
        className={cn(
          "flex items-center justify-center gap-4",
          verticalAlign === "top" ? "pb-3" : "pt-3",
          className
        )}
      >
        {payload.map((item) => {
          const key = `${nameKey || item.dataKey || "value"}`
          const itemConfig = getPayloadConfigFromPayload(config, item, key)

          return (
            <div
              key={item.value}
              className={cn(
                "flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"
              )}
            >
              {itemConfig?.icon && !hideIcon ? (
                <itemConfig.icon />
              ) : (
                <div
                  className="h-2 w-2 shrink-0 rounded-[2px]"
                  style={{
                    backgroundColor: item.color,
                  }}
                />
              )}
              {itemConfig?.label}
            </div>
          )
        })}
      </div>
    )
  }
)
ChartLegendContent.displayName = "ChartLegend"

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string
) {
  if (typeof payload !== "object" || payload === null) {
    return undefined
  }

  const payloadPayload =
    "payload" in payload &&
    typeof payload.payload === "object" &&
    payload.payload !== null
      ? payload.payload
      : undefined

  let configLabelKey: string = key

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === "string"
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config]
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
}

--- FILE: src/components/ui/checkbox.tsx ---
"use client"

import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { Check } from "lucide-react"

import { cn } from "@/lib/utils"

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn("flex items-center justify-center text-current")}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
))
Checkbox.displayName = CheckboxPrimitive.Root.displayName

export { Checkbox }

--- FILE: src/components/ui/collapsible.tsx ---
"use client"

import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"

const Collapsible = CollapsiblePrimitive.Root

const CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger

const CollapsibleContent = CollapsiblePrimitive.CollapsibleContent

export { Collapsible, CollapsibleTrigger, CollapsibleContent }

--- FILE: src/components/ui/dialog.tsx ---
"use client"

import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Dialog = DialogPrimitive.Root

const DialogTrigger = DialogPrimitive.Trigger

const DialogPortal = DialogPrimitive.Portal

const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
))
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}

--- FILE: src/components/ui/dropdown-menu.tsx ---
"use client"

import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const DropdownMenu = DropdownMenuPrimitive.Root

const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger

const DropdownMenuGroup = DropdownMenuPrimitive.Group

const DropdownMenuPortal = DropdownMenuPrimitive.Portal

const DropdownMenuSub = DropdownMenuPrimitive.Sub

const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup

const DropdownMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto" />
  </DropdownMenuPrimitive.SubTrigger>
))
DropdownMenuSubTrigger.displayName =
  DropdownMenuPrimitive.SubTrigger.displayName

const DropdownMenuSubContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
DropdownMenuSubContent.displayName =
  DropdownMenuPrimitive.SubContent.displayName

const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
))
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName

const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName

const DropdownMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
))
DropdownMenuCheckboxItem.displayName =
  DropdownMenuPrimitive.CheckboxItem.displayName

const DropdownMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.RadioItem>
))
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName

const DropdownMenuLabel = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName

const DropdownMenuSeparator = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName

const DropdownMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}
      {...props}
    />
  )
}
DropdownMenuShortcut.displayName = "DropdownMenuShortcut"

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
}

--- FILE: src/components/ui/form.tsx ---
"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { Slot } from "@radix-ui/react-slot"
import {
  Controller,
  FormProvider,
  useFormContext,
  type ControllerProps,
  type FieldPath,
  type FieldValues,
} from "react-hook-form"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState, formState } = useFormContext()

  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>")
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue
)

const FormItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div ref={ref} className={cn("space-y-2", className)} {...props} />
    </FormItemContext.Provider>
  )
})
FormItem.displayName = "FormItem"

const FormLabel = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
>(({ className, ...props }, ref) => {
  const { error, formItemId } = useFormField()

  return (
    <Label
      ref={ref}
      className={cn(error && "text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  )
})
FormLabel.displayName = "FormLabel"

const FormControl = React.forwardRef<
  React.ElementRef<typeof Slot>,
  React.ComponentPropsWithoutRef<typeof Slot>
>(({ ...props }, ref) => {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      ref={ref}
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
})
FormControl.displayName = "FormControl"

const FormDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => {
  const { formDescriptionId } = useFormField()

  return (
    <p
      ref={ref}
      id={formDescriptionId}
      className={cn("text-sm text-muted-foreground", className)}
      {...props}
    />
  )
})
FormDescription.displayName = "FormDescription"

const FormMessage = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, children, ...props }, ref) => {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message ?? "") : children

  if (!body) {
    return null
  }

  return (
    <p
      ref={ref}
      id={formMessageId}
      className={cn("text-sm font-medium text-destructive", className)}
      {...props}
    >
      {body}
    </p>
  )
})
FormMessage.displayName = "FormMessage"

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}

--- FILE: src/components/ui/icons.tsx ---
import * as React from 'react';

export const GoogleIcon = (props: React.SVGProps<SVGSVGElement>) => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 48 48"
    width="48px"
    height="48px"
    {...props}
  >
    <path
      fill="#FFC107"
      d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"
    />
    <path
      fill="#FF3D00"
      d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"
    />
    <path
      fill="#4CAF50"
      d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.222,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"
    />
    <path
      fill="#1976D2"
      d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l6.19,5.238C42.022,35.244,44,30.036,44,24C44,22.659,43.862,21.35,43.611,20.083z"
    />
  </svg>
);

--- FILE: src/components/ui/input.tsx ---

import * as React from "react"

import { cn } from "@/lib/utils"

const Input = React.forwardRef<HTMLInputElement, React.ComponentProps<"input">>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-12 w-full rounded-md border border-input bg-background px-4 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
          'glass-card'
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }

--- FILE: src/components/ui/label.tsx ---
"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }

--- FILE: src/components/ui/menubar.tsx ---
"use client"

import * as React from "react"
import * as MenubarPrimitive from "@radix-ui/react-menubar"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

function MenubarMenu({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {
  return <MenubarPrimitive.Menu {...props} />
}

function MenubarGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Group>) {
  return <MenubarPrimitive.Group {...props} />
}

function MenubarPortal({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {
  return <MenubarPrimitive.Portal {...props} />
}

function MenubarRadioGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {
  return <MenubarPrimitive.RadioGroup {...props} />
}

function MenubarSub({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {
  return <MenubarPrimitive.Sub data-slot="menubar-sub" {...props} />
}

const Menubar = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Root
    ref={ref}
    className={cn(
      "flex h-10 items-center space-x-1 rounded-md border bg-background p-1",
      className
    )}
    {...props}
  />
))
Menubar.displayName = MenubarPrimitive.Root.displayName

const MenubarTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      className
    )}
    {...props}
  />
))
MenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName

const MenubarSubTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <MenubarPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </MenubarPrimitive.SubTrigger>
))
MenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName

const MenubarSubContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
MenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName

const MenubarContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>
>(
  (
    { className, align = "start", alignOffset = -4, sideOffset = 8, ...props },
    ref
  ) => (
    <MenubarPrimitive.Portal>
      <MenubarPrimitive.Content
        ref={ref}
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
          className
        )}
        {...props}
      />
    </MenubarPrimitive.Portal>
  )
)
MenubarContent.displayName = MenubarPrimitive.Content.displayName

const MenubarItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarItem.displayName = MenubarPrimitive.Item.displayName

const MenubarCheckboxItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <MenubarPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.CheckboxItem>
))
MenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName

const MenubarRadioItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <MenubarPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.RadioItem>
))
MenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName

const MenubarLabel = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarLabel.displayName = MenubarPrimitive.Label.displayName

const MenubarSeparator = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
MenubarSeparator.displayName = MenubarPrimitive.Separator.displayName

const MenubarShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
MenubarShortcut.displayname = "MenubarShortcut"

export {
  Menubar,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarItem,
  MenubarSeparator,
  MenubarLabel,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarPortal,
  MenubarSubContent,
  MenubarSubTrigger,
  MenubarGroup,
  MenubarSub,
  MenubarShortcut,
}

--- FILE: src/components/ui/popover.tsx ---
"use client"

import * as React from "react"
import * as PopoverPrimitive from "@radix-ui/react-popover"

import { cn } from "@/lib/utils"

const Popover = PopoverPrimitive.Root

const PopoverTrigger = PopoverPrimitive.Trigger

const PopoverContent = React.forwardRef<
  React.ElementRef<typeof PopoverPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <PopoverPrimitive.Portal>
    <PopoverPrimitive.Content
      ref={ref}
      align={align}
      sideOffset={sideOffset}
      className={cn(
        "z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </PopoverPrimitive.Portal>
))
PopoverContent.displayName = PopoverPrimitive.Content.displayName

export { Popover, PopoverTrigger, PopoverContent }

--- FILE: src/components/ui/progress.tsx ---

"use client"

import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"

import { cn } from "@/lib/utils"

const Progress = React.forwardRef<
  React.ElementRef<typeof ProgressPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>
>(({ className, value, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn(
      "relative h-4 w-full overflow-hidden rounded-full bg-black/20",
      className
    )}
    {...props}
  >
    <ProgressPrimitive.Indicator
      className="h-full w-full flex-1 bg-primary transition-all duration-500 ease-out"
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
    />
  </ProgressPrimitive.Root>
))
Progress.displayName = ProgressPrimitive.Root.displayName

const CircleProgress = ({
  className,
  value = 0,
  strokeWidth = 10,
  size = 120,
  showPercentage = true,
  color = 'var(--neon-cyan)',
}: {
  className?: string;
  value?: number;
  strokeWidth?: number;
  size?: number;
  showPercentage?: boolean;
  color?: string;
}) => {
  const radius = (size - strokeWidth) / 2;
  const circumference = 2 * Math.PI * radius;
  const [offset, setOffset] = React.useState(circumference);
  
  React.useEffect(() => {
    const progressOffset = circumference - (value / 100) * circumference;
    setOffset(progressOffset);
  }, [value, circumference]);


  return (
    <div className={cn("relative", className)} style={{ width: size, height: size }}>
      <svg className="w-full h-full transform -rotate-90" viewBox={`0 0 ${size} ${size}`}>
        <circle
          className="text-gray-700/50"
          stroke="currentColor"
          strokeWidth={strokeWidth}
          fill="transparent"
          r={radius}
          cx={size / 2}
          cy={size / 2}
        />
        <circle
          stroke={color}
          strokeWidth={strokeWidth}
          strokeLinecap="round"
          fill="transparent"
          r={radius}
          cx={size / 2}
          cy={size / 2}
          style={{
            strokeDasharray: circumference,
            strokeDashoffset: offset,
            transition: 'stroke-dashoffset 0.5s ease-out',
            filter: `drop-shadow(0 0 5px ${color})`
          }}
        />
      </svg>
      {showPercentage && (
        <div className="absolute inset-0 flex items-center justify-center">
            <span className="text-xl font-bold text-white">{`${Math.round(value)}%`}</span>
        </div>
      )}
    </div>
  );
};
CircleProgress.displayName = "CircleProgress";


export { Progress, CircleProgress }

--- FILE: src/components/ui/radio-group.tsx ---
"use client"

import * as React from "react"
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group"
import { Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const RadioGroup = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Root
      className={cn("grid gap-2", className)}
      {...props}
      ref={ref}
    />
  )
})
RadioGroup.displayName = RadioGroupPrimitive.Root.displayName

const RadioGroupItem = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Item
      ref={ref}
      className={cn(
        "aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">
        <Circle className="h-2.5 w-2.5 fill-current text-current" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  )
})
RadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName

export { RadioGroup, RadioGroupItem }

--- FILE: src/components/ui/scroll-area.tsx ---
"use client"

import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

const ScrollArea = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <ScrollAreaPrimitive.Root
    ref={ref}
    className={cn("relative overflow-hidden", className)}
    {...props}
  >
    <ScrollAreaPrimitive.Viewport className="h-full w-full rounded-[inherit]">
      {children}
    </ScrollAreaPrimitive.Viewport>
    <ScrollBar />
    <ScrollAreaPrimitive.Corner />
  </ScrollAreaPrimitive.Root>
))
ScrollArea.displayName = ScrollAreaPrimitive.Root.displayName

const ScrollBar = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>
>(({ className, orientation = "vertical", ...props }, ref) => (
  <ScrollAreaPrimitive.ScrollAreaScrollbar
    ref={ref}
    orientation={orientation}
    className={cn(
      "flex touch-none select-none transition-colors",
      orientation === "vertical" &&
        "h-full w-2.5 border-l border-l-transparent p-[1px]",
      orientation === "horizontal" &&
        "h-2.5 flex-col border-t border-t-transparent p-[1px]",
      className
    )}
    {...props}
  >
    <ScrollAreaPrimitive.ScrollAreaThumb className="relative flex-1 rounded-full bg-border" />
  </ScrollAreaPrimitive.ScrollAreaScrollbar>
))
ScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName

export { ScrollArea, ScrollBar }

--- FILE: src/components/ui/select.tsx ---
"use client"

import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { Check, ChevronDown, ChevronUp } from "lucide-react"

import { cn } from "@/lib/utils"

const Select = SelectPrimitive.Root

const SelectGroup = SelectPrimitive.Group

const SelectValue = SelectPrimitive.Value

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
      className
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
))
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
))
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
))
SelectScrollDownButton.displayName =
  SelectPrimitive.ScrollDownButton.displayName

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = "popper", ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      className={cn(
        "relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        position === "popper" &&
          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
        className
      )}
      position={position}
      {...props}
    >
      <SelectScrollUpButton />
      <SelectPrimitive.Viewport
        className={cn(
          "p-1",
          position === "popper" &&
            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"
        )}
      >
        {children}
      </SelectPrimitive.Viewport>
      <SelectScrollDownButton />
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
))
SelectContent.displayName = SelectPrimitive.Content.displayName

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label
    ref={ref}
    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}
    {...props}
  />
))
SelectLabel.displayName = SelectPrimitive.Label.displayName

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
))
SelectItem.displayName = SelectPrimitive.Item.displayName

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
SelectSeparator.displayName = SelectPrimitive.Separator.displayName

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
}

--- FILE: src/components/ui/separator.tsx ---
"use client"

import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

const Separator = React.forwardRef<
  React.ElementRef<typeof SeparatorPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
>(
  (
    { className, orientation = "horizontal", decorative = true, ...props },
    ref
  ) => (
    <SeparatorPrimitive.Root
      ref={ref}
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
        className
      )}
      {...props}
    />
  )
)
Separator.displayName = SeparatorPrimitive.Root.displayName

export { Separator }

--- FILE: src/components/ui/sheet.tsx ---
"use client"

import * as React from "react"
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Sheet = SheetPrimitive.Root

const SheetTrigger = SheetPrimitive.Trigger

const SheetClose = SheetPrimitive.Close

const SheetPortal = SheetPrimitive.Portal

const SheetOverlay = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
SheetOverlay.displayName = SheetPrimitive.Overlay.displayName

const sheetVariants = cva(
  "fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
  {
    variants: {
      side: {
        top: "inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
        bottom:
          "inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
        left: "inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",
        right:
          "inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm",
      },
    },
    defaultVariants: {
      side: "right",
    },
  }
)

interface SheetContentProps
  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
    VariantProps<typeof sheetVariants> {}

const SheetContent = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Content>,
  SheetContentProps
>(({ side = "right", className, children, ...props }, ref) => (
  <SheetPortal>
    <SheetOverlay />
    <SheetPrimitive.Content
      ref={ref}
      className={cn(sheetVariants({ side }), className)}
      {...props}
    >
      {children}
      <SheetPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </SheetPrimitive.Close>
    </SheetPrimitive.Content>
  </SheetPortal>
))
SheetContent.displayName = SheetPrimitive.Content.displayName

const SheetHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
SheetHeader.displayName = "SheetHeader"

const SheetFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
SheetFooter.displayName = "SheetFooter"

const SheetTitle = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold text-foreground", className)}
    {...props}
  />
))
SheetTitle.displayName = SheetPrimitive.Title.displayName

const SheetDescription = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
SheetDescription.displayName = SheetPrimitive.Description.displayName

export {
  Sheet,
  SheetPortal,
  SheetOverlay,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
}

--- FILE: src/components/ui/sidebar.tsx ---
"use client"

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { VariantProps, cva } from "class-variance-authority"
import { PanelLeft } from "lucide-react"

import { useIsMobile } from "@/hooks/use-mobile"
import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Separator } from "@/components/ui/separator"
import { Sheet, SheetContent } from "@/components/ui/sheet"
import { Skeleton } from "@/components/ui/skeleton"
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip"

const SIDEBAR_COOKIE_NAME = "sidebar_state"
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7
const SIDEBAR_WIDTH = "16rem"
const SIDEBAR_WIDTH_MOBILE = "18rem"
const SIDEBAR_WIDTH_ICON = "3rem"
const SIDEBAR_KEYBOARD_SHORTCUT = "b"

type SidebarContext = {
  state: "expanded" | "collapsed"
  open: boolean
  setOpen: (open: boolean) => void
  openMobile: boolean
  setOpenMobile: (open: boolean) => void
  isMobile: boolean
  toggleSidebar: () => void
}

const SidebarContext = React.createContext<SidebarContext | null>(null)

function useSidebar() {
  const context = React.useContext(SidebarContext)
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.")
  }

  return context
}

const SidebarProvider = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    defaultOpen?: boolean
    open?: boolean
    onOpenChange?: (open: boolean) => void
  }
>(
  (
    {
      defaultOpen = true,
      open: openProp,
      onOpenChange: setOpenProp,
      className,
      style,
      children,
      ...props
    },
    ref
  ) => {
    const isMobile = useIsMobile()
    const [openMobile, setOpenMobile] = React.useState(false)

    const [_open, _setOpen] = React.useState(defaultOpen)
    const open = openProp ?? _open
    const setOpen = React.useCallback(
      (value: boolean | ((value: boolean) => boolean)) => {
        const openState = typeof value === "function" ? value(open) : value
        if (setOpenProp) {
          setOpenProp(openState)
        } else {
          _setOpen(openState)
        }
        if (typeof document !== 'undefined') {
          document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`
        }
      },
      [setOpenProp, open]
    )

    const toggleSidebar = React.useCallback(() => {
      return isMobile
        ? setOpenMobile((open) => !open)
        : setOpen((open) => !open)
    }, [isMobile, setOpen, setOpenMobile])

    React.useEffect(() => {
      const handleKeyDown = (event: KeyboardEvent) => {
        if (
          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
          (event.metaKey || event.ctrlKey)
        ) {
          event.preventDefault()
          toggleSidebar()
        }
      }

      window.addEventListener("keydown", handleKeyDown)
      return () => window.removeEventListener("keydown", handleKeyDown)
    }, [toggleSidebar])

    const state = open ? "expanded" : "collapsed"

    const contextValue = React.useMemo<SidebarContext>(
      () => ({
        state,
        open,
        setOpen,
        isMobile,
        openMobile,
        setOpenMobile,
        toggleSidebar,
      }),
      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]
    )

    return (
      <SidebarContext.Provider value={contextValue}>
        <TooltipProvider delayDuration={0}>
          <div
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH,
                "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
                ...style,
              } as React.CSSProperties
            }
            className={cn(
              "group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",
              className
            )}
            ref={ref}
            {...props}
          >
            {children}
          </div>
        </TooltipProvider>
      </SidebarContext.Provider>
    )
  }
)
SidebarProvider.displayName = "SidebarProvider"

const Sidebar = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    side?: "left" | "right"
    variant?: "sidebar" | "floating" | "inset"
    collapsible?: "offcanvas" | "icon" | "none"
  }
>(
  (
    {
      side = "left",
      variant = "sidebar",
      collapsible = "offcanvas",
      className,
      children,
      ...props
    },
    ref
  ) => {
    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()

    if (collapsible === "none") {
      return (
        <div
          className={cn(
            "flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",
            className
          )}
          ref={ref}
          {...props}
        >
          {children}
        </div>
      )
    }

    if (isMobile) {
      return (
        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
          <SheetContent
            data-sidebar="sidebar"
            data-mobile="true"
            className="w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden"
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
              } as React.CSSProperties
            }
            side={side}
          >
            <div className="flex h-full w-full flex-col">{children}</div>
          </SheetContent>
        </Sheet>
      )
    }

    return (
      <div
        ref={ref}
        className="group peer hidden md:block text-sidebar-foreground"
        data-state={state}
        data-collapsible={state === "collapsed" ? collapsible : ""}
        data-variant={variant}
        data-side={side}
      >
        <div
          className={cn(
            "duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear",
            "group-data-[collapsible=offcanvas]:w-0",
            "group-data-[side=right]:rotate-180",
            variant === "floating" || variant === "inset"
              ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon]"
          )}
        />
        <div
          className={cn(
            "duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex",
            side === "left"
              ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
              : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
            variant === "floating" || variant === "inset"
              ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",
            className
          )}
          {...props}
        >
          <div
            data-sidebar="sidebar"
            className="flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow"
          >
            {children}
          </div>
        </div>
      </div>
    )
  }
)
Sidebar.displayName = "Sidebar"

const SidebarTrigger = React.forwardRef<
  React.ElementRef<typeof Button>,
  React.ComponentProps<typeof Button>
>(({ className, onClick, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <Button
      ref={ref}
      data-sidebar="trigger"
      variant="ghost"
      size="icon"
      className={cn("h-7 w-7", className)}
      onClick={(event) => {
        onClick?.(event)
        toggleSidebar()
      }}
      {...props}
    >
      <PanelLeft />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  )
})
SidebarTrigger.displayName = "SidebarTrigger"

const SidebarRail = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button">
>(({ className, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <button
      ref={ref}
      data-sidebar="rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex",
        "[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className
      )}
      {...props}
    />
  )
})
SidebarRail.displayName = "SidebarRail"

const SidebarInset = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"main">
>(({ className, ...props }, ref) => {
  return (
    <main
      ref={ref}
      className={cn(
        "relative flex min-h-svh flex-1 flex-col bg-background",
        "peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",
        className
      )}
      {...props}
    />
  )
})
SidebarInset.displayName = "SidebarInset"

const SidebarInput = React.forwardRef<
  React.ElementRef<typeof Input>,
  React.ComponentProps<typeof Input>
>(({ className, ...props }, ref) => {
  return (
    <Input
      ref={ref}
      data-sidebar="input"
      className={cn(
        "h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",
        className
      )}
      {...props}
    />
  )
})
SidebarInput.displayName = "SidebarInput"

const SidebarHeader = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarHeader.displayName = "SidebarHeader"

const SidebarFooter = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarFooter.displayName = "SidebarFooter"

const SidebarSeparator = React.forwardRef<
  React.ElementRef<typeof Separator>,
  React.ComponentProps<typeof Separator>
>(({ className, ...props }, ref) => {
  return (
    <Separator
      ref={ref}
      data-sidebar="separator"
      className={cn("mx-2 w-auto bg-sidebar-border", className)}
      {...props}
    />
  )
})
SidebarSeparator.displayName = "SidebarSeparator"

const SidebarContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarContent.displayName = "SidebarContent"

const SidebarGroup = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  )
})
SidebarGroup.displayName = "SidebarGroup"

const SidebarGroupLabel = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "div"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-label"
      className={cn(
        "duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupLabel.displayName = "SidebarGroupLabel"

const SidebarGroupAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-action"
      className={cn(
        "absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "after:absolute after:-inset-2 after:md:hidden",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupAction.displayName = "SidebarGroupAction"

const SidebarGroupContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="group-content"
    className={cn("w-full text-sm", className)}
    {...props}
  />
))
SidebarGroupContent.displayName = "SidebarGroupContent"

const SidebarMenu = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu"
    className={cn("flex w-full min-w-0 flex-col gap-1", className)}
    {...props}
  />
))
SidebarMenu.displayName = "SidebarMenu"

const SidebarMenuItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    data-sidebar="menu-item"
    className={cn("group/menu-item relative", className)}
    {...props}
  />
))
SidebarMenuItem.displayName = "SidebarMenuItem"

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:!p-0",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const SidebarMenuButton = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    isActive?: boolean
    tooltip?: string | React.ComponentProps<typeof TooltipContent>
  } & VariantProps<typeof sidebarMenuButtonVariants>
>(
  (
    {
      asChild = false,
      isActive = false,
      variant = "default",
      size = "default",
      tooltip,
      className,
      ...props
    },
    ref
  ) => {
    const Comp = asChild ? Slot : "button"
    const { isMobile, state } = useSidebar()

    const button = (
      <Comp
        ref={ref}
        data-sidebar="menu-button"
        data-size={size}
        data-active={isActive}
        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
        {...props}
      />
    )

    if (!tooltip) {
      return button
    }

    if (typeof tooltip === "string") {
      tooltip = {
        children: tooltip,
      }
    }

    return (
      <Tooltip>
        <TooltipTrigger asChild>{button}</TooltipTrigger>
        <TooltipContent
          side="right"
          align="center"
          hidden={state !== "collapsed" || isMobile}
          {...tooltip}
        />
      </Tooltip>
    )
  }
)
SidebarMenuButton.displayName = "SidebarMenuButton"

const SidebarMenuAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    showOnHover?: boolean
  }
>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-action"
      className={cn(
        "absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0",
        "after:absolute after:-inset-2 after:md:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuAction.displayName = "SidebarMenuAction"

const SidebarMenuBadge = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="menu-badge"
    className={cn(
      "absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none",
      "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
      "peer-data-[size=sm]/menu-button:top-1",
      "peer-data-[size=default]/menu-button:top-1.5",
      "peer-data-[size=lg]/menu-button:top-2.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuBadge.displayName = "SidebarMenuBadge"

const SidebarMenuSkeleton = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    showIcon?: boolean
  }
>(({ className, showIcon = false, ...props }, ref) => {
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`
  }, [])

  return (
    <div
      ref={ref}
      data-sidebar="menu-skeleton"
      className={cn("rounded-md h-8 flex gap-2 px-2 items-center", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 flex-1 max-w-[--skeleton-width]"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  )
})
SidebarMenuSkeleton.displayName = "SidebarMenuSkeleton"

const SidebarMenuSub = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu-sub"
    className={cn(
      "mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuSub.displayName = "SidebarMenuSub"

const SidebarMenuSubItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ ...props }, ref) => <li ref={ref} {...props} />)
SidebarMenuSubItem.displayName = "SidebarMenuSubItem"

const SidebarMenuSubButton = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentProps<"a"> & {
    asChild?: boolean
    size?: "sm" | "md"
    isActive?: boolean
  }
>(({ asChild = false, size = "md", isActive, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuSubButton.displayName = "SidebarMenuSubButton"

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
}

--- FILE: src/components/ui/skeleton.tsx ---
import { cn } from "@/lib/utils"

function Skeleton({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn("animate-pulse rounded-md bg-muted", className)}
      {...props}
    />
  )
}

export { Skeleton }

--- FILE: src/components/ui/slider.tsx ---
"use client"

import * as React from "react"
import * as SliderPrimitive from "@radix-ui/react-slider"

import { cn } from "@/lib/utils"

const Slider = React.forwardRef<
  React.ElementRef<typeof SliderPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>
>(({ className, ...props }, ref) => (
  <SliderPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex w-full touch-none select-none items-center",
      className
    )}
    {...props}
  >
    <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-secondary">
      <SliderPrimitive.Range className="absolute h-full bg-primary" />
    </SliderPrimitive.Track>
    <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" />
  </SliderPrimitive.Root>
))
Slider.displayName = SliderPrimitive.Root.displayName

export { Slider }

--- FILE: src/components/ui/switch.tsx ---
"use client"

import * as React from "react"
import * as SwitchPrimitives from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

const Switch = React.forwardRef<
  React.ElementRef<typeof SwitchPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>
>(({ className, ...props }, ref) => (
  <SwitchPrimitives.Root
    className={cn(
      "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",
      className
    )}
    {...props}
    ref={ref}
  >
    <SwitchPrimitives.Thumb
      className={cn(
        "pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0"
      )}
    />
  </SwitchPrimitives.Root>
))
Switch.displayName = SwitchPrimitives.Root.displayName

export { Switch }

--- FILE: src/components/ui/table.tsx ---
import * as React from "react"

import { cn } from "@/lib/utils"

const Table = React.forwardRef<
  HTMLTableElement,
  React.HTMLAttributes<HTMLTableElement>
>(({ className, ...props }, ref) => (
  <div className="relative w-full overflow-auto">
    <table
      ref={ref}
      className={cn("w-full caption-bottom text-sm", className)}
      {...props}
    />
  </div>
))
Table.displayName = "Table"

const TableHeader = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />
))
TableHeader.displayName = "TableHeader"

const TableBody = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tbody
    ref={ref}
    className={cn("[&_tr:last-child]:border-0", className)}
    {...props}
  />
))
TableBody.displayName = "TableBody"

const TableFooter = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tfoot
    ref={ref}
    className={cn(
      "border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",
      className
    )}
    {...props}
  />
))
TableFooter.displayName = "TableFooter"

const TableRow = React.forwardRef<
  HTMLTableRowElement,
  React.HTMLAttributes<HTMLTableRowElement>
>(({ className, ...props }, ref) => (
  <tr
    ref={ref}
    className={cn(
      "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",
      className
    )}
    {...props}
  />
))
TableRow.displayName = "TableRow"

const TableHead = React.forwardRef<
  HTMLTableCellElement,
  React.ThHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <th
    ref={ref}
    className={cn(
      "h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",
      className
    )}
    {...props}
  />
))
TableHead.displayName = "TableHead"

const TableCell = React.forwardRef<
  HTMLTableCellElement,
  React.TdHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <td
    ref={ref}
    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}
    {...props}
  />
))
TableCell.displayName = "TableCell"

const TableCaption = React.forwardRef<
  HTMLTableCaptionElement,
  React.HTMLAttributes<HTMLTableCaptionElement>
>(({ className, ...props }, ref) => (
  <caption
    ref={ref}
    className={cn("mt-4 text-sm text-muted-foreground", className)}
    {...props}
  />
))
TableCaption.displayName = "TableCaption"

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}

--- FILE: src/components/ui/tabs.tsx ---
"use client"

import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }

--- FILE: src/components/ui/textarea.tsx ---

import * as React from 'react';

import {cn} from '@/lib/utils';

const Textarea = React.forwardRef<HTMLTextAreaElement, React.ComponentProps<'textarea'>>(
  ({className, ...props}, ref) => {
    return (
      <textarea
        className={cn(
          'flex min-h-[120px] w-full rounded-md border border-input bg-background px-4 py-3 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',
          'glass-card'
        )}
        ref={ref}
        {...props}
      />
    );
  }
);
Textarea.displayName = 'Textarea';

export {Textarea};

--- FILE: src/components/ui/toast.tsx ---

"use client"

import * as React from "react"
import * as ToastPrimitives from "@radix-ui/react-toast"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const ToastProvider = ToastPrimitives.Provider

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",
      className
    )}
    {...props}
  />
))
ToastViewport.displayName = ToastPrimitives.Viewport.displayName

const toastVariants = cva(
  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",
  {
    variants: {
      variant: {
        default: "border bg-background text-foreground",
        destructive:
          "destructive group border-destructive bg-destructive text-destructive-foreground",
        'blur-blue': "border-blue-500/50 bg-blue-600/80 backdrop-blur-xl text-white",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &
    VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return (
    <ToastPrimitives.Root
      ref={ref}
      className={cn(toastVariants({ variant }), className)}
      {...props}
    />
  )
})
Toast.displayName = ToastPrimitives.Root.displayName

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",
      "group-[.blur-blue]:border-blue-400 group-[.blur-blue]:hover:bg-blue-500 group-[.blur-blue]:hover:text-white",
      className
    )}
    {...props}
  />
))
ToastAction.displayName = ToastPrimitives.Action.displayName

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      "absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",
      "group-[.blur-blue]:text-blue-200 group-[.blur-blue]:hover:text-white",
      className
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
))
ToastClose.displayName = ToastPrimitives.Close.displayName

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title
    ref={ref}
    className={cn("text-sm font-semibold", className)}
    {...props}
  />
))
ToastTitle.displayName = ToastPrimitives.Title.displayName

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description
    ref={ref}
    className={cn("text-sm opacity-90", "group-[.blur-blue]:opacity-100 group-[.blur-blue]:text-blue-100", className)}
    {...props}
  />
))
ToastDescription.displayName = ToastPrimitives.Description.displayName

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>

type ToastActionElement = React.ReactElement<typeof ToastAction>

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
}

--- FILE: src/components/ui/toaster.tsx ---
"use client"

import { useToast } from "@/hooks/use-toast"
import {
  Toast,
  ToastClose,
  ToastDescription,
  ToastProvider,
  ToastTitle,
  ToastViewport,
} from "@/components/ui/toast"

export function Toaster() {
  const { toasts } = useToast()

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        )
      })}
      <ToastViewport />
    </ToastProvider>
  )
}

--- FILE: src/docs/backend.json ---

{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the Local Buddy Pro application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user (matches auth.uid)."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "photoUrl": {
          "type": "string",
          "description": "URL of the user's profile photo.",
          "format": "uri"
        },
        "location": {
          "type": "string",
          "description": "The user's location (e.g., city, state)."
        },
        "walletBalance": {
          "type": "number",
          "description": "The user's current wallet balance."
        },
        "xp": {
          "type": "number",
          "description": "The user's experience points."
        },
        "level": {
          "type": "string",
          "description": "The user's current level (e.g., Rookie, Pro, Local Hero)."
        },
        "verificationStatus": {
          "type": "string",
          "description": "The user's verification status (e.g., pending, verified)."
        },
        "mobileVerified": {
          "type": "boolean",
          "description": "Indicates if the user's mobile number is verified."
        },
        "aadharVerified": {
          "type": "boolean",
          "description": "Indicates if the user's Aadhar/ID is verified."
        },
        "joinDate": {
          "type": "string",
          "description": "The date the user joined the platform.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "walletBalance"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task posted on the Local Buddy Pro platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the task."
        },
        "title": {
          "type": "string",
          "description": "The title of the task."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the task."
        },
        "category": {
          "type": "string",
          "description": "The category of the task (e.g., Household, Tech, Delivery)."
        },
        "budget": {
          "type": "number",
          "description": "The budget allocated for the task."
        },
        "location": {
          "type": "string",
          "description": "The location where the task needs to be performed."
        },
        "status": {
          "type": "string",
          "description": "The current status of the task (e.g., Open, Assigned, Completed)."
        },
        "posterId": {
          "type": "string",
          "description": "Reference to User who posted the task."
        },
        "buddyId": {
          "type": "string",
          "description": "Reference to User who is assigned to the task."
        },
        "deadline": {
          "type": "string",
          "description": "The deadline for the task completion.",
          "format": "date-time"
        },
        "paymentMode": {
            "type": "string",
            "enum": ["online", "cash"],
            "description": "The mode of payment for the task."
        },
        "duration": {
            "type": "string",
            "description": "Estimated time duration to complete the task."
        },
        "tip": {
            "type": "number",
            "description": "Optional tip amount for the buddy."
        }
      },
      "required": [
        "id",
        "title",
        "posterId",
        "budget",
        "status",
        "paymentMode",
        "duration"
      ]
    },
    "Chat": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Chat",
      "type": "object",
      "description": "Represents a chat session between a poster and a buddy for a specific task.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat session."
        },
        "taskId": {
          "type": "string",
          "description": "Reference to Task that this chat is associated with."
        },
        "participantIds": {
          "type": "array",
          "description": "Array of user IDs participating in the chat.",
          "items": {
            "type": "string"
          }
        },
        "messages": {
          "type": "array",
          "description": "Array of messages in the chat session.",
          "items": {
            "type": "object",
            "properties": {
              "senderId": { "type": "string" },
              "text": { "type": "string" },
              "timestamp": { "type": "string", "format": "date-time" }
            }
          }
        }
      },
      "required": [
        "id",
        "taskId",
        "participantIds"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a transaction record (Lock, Release, Add, Withdraw).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User that initiated the transaction."
        },
        "taskId": {
          "type": "string",
          "description": "Reference to Task that the transaction is for (if applicable)."
        },
        "type": {
          "type": "string",
          "description": "The type of transaction (e.g., Lock, Release, Add, Withdraw)."
        },
        "amount": {
          "type": "number",
          "description": "The amount involved in the transaction."
        },
        "status": {
          "type": "string",
          "description": "The status of the transaction (e.g., Success, Pending, Failed)."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp of the transaction.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "type",
        "amount",
        "status",
        "timestamp"
      ]
    },
    "Notification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Notification",
      "type": "object",
      "description": "Represents a notification for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the notification."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who this notification is for."
        },
        "title": {
          "type": "string",
          "description": "The title of the notification."
        },
        "message": {
          "type": "string",
          "description": "The main content of the notification."
        },
        "type": {
          "type": "string",
          "enum": ["TASK_ACCEPTED", "PAYMENT_RELEASED", "NEW_MESSAGE"],
          "description": "The type of the notification."
        },
        "taskId": {
          "type": "string",
          "description": "The ID of the task related to this notification, if any."
        },
        "isRead": {
          "type": "boolean",
          "description": "Whether the user has read the notification."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The time the notification was created."
        }
      },
      "required": ["id", "userId", "title", "message", "type", "isRead", "timestamp"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "paths": {
      "/users/{userId}": {
        "schema": {
          "$ref": "#/entities/User"
        },
        "description": "Stores user profiles. Uses path-based ownership for private user data."
      },
       "/users/{userId}/notifications/{notificationId}": {
        "schema": {
          "$ref": "#/entities/Notification"
        },
        "description": "Stores notifications for a specific user. Path-based ownership ensures privacy."
      },
      "/tasks/{taskId}": {
        "schema": {
          "$ref": "#/entities/Task"
        },
        "description": "Stores tasks posted on the platform. Includes 'posterId' to associate the task with the user who posted it, as well as 'buddyId' to save the user assigned to the task."
      },
      "/chats/{chatId}": {
        "schema": {
          "$ref": "#/entities/Chat"
        },
        "description": "Stores chat sessions between users for specific tasks. Includes 'taskId' and a list of participantIds to secure the chat."
      },
      "/transactions/{transactionId}": {
        "schema": {
          "$ref": "#/entities/Transaction"
        },
        "description": "Stores transaction records related to wallet operations. Includes 'userId' and 'taskId' to track user and task associations."
      }
    }
  }
}

    
--- FILE: src/firebase/client-provider.tsx ---
'use client';

import React, { useMemo, type ReactNode } from 'react';
import { FirebaseProvider } from '@/firebase/provider';
import { initializeFirebase } from '@/firebase';

interface FirebaseClientProviderProps {
  children: ReactNode;
}

export function FirebaseClientProvider({ children }: FirebaseClientProviderProps) {
  const firebaseServices = useMemo(() => {
    // Initialize Firebase on the client side, once per component mount.
    return initializeFirebase();
  }, []); // Empty dependency array ensures this runs only once on mount

  return (
    <FirebaseProvider
      firebaseApp={firebaseServices.firebaseApp}
      auth={firebaseServices.auth}
      firestore={firebaseServices.firestore}
    >
      {children}
    </FirebaseProvider>
  );
}
--- FILE: src/firebase/config.ts ---
export const firebaseConfig = {
  "projectId": "studio-3301259230-2093f",
  "appId": "1:840757376042:web:dc9cadded4da0e60b7ff53",
  "apiKey": "AIzaSyB46aAGNIQFLhr5fWt-JA_lalHfmHpxlSo",
  "authDomain": "studio-3301259230-2093f.firebaseapp.com",
  "measurementId": "",
  "messagingSenderId": "840757376042"
};

--- FILE: src/firebase/error-emitter.ts ---
'use client';
import { FirestorePermissionError } from '@/firebase/errors';

/**
 * Defines the shape of all possible events and their corresponding payload types.
 * This centralizes event definitions for type safety across the application.
 */
export interface AppEvents {
  'permission-error': FirestorePermissionError;
}

// A generic type for a callback function.
type Callback<T> = (data: T) => void;

/**
 * A strongly-typed pub/sub event emitter.
 * It uses a generic type T that extends a record of event names to payload types.
 */
function createEventEmitter<T extends Record<string, any>>() {
  // The events object stores arrays of callbacks, keyed by event name.
  // The types ensure that a callback for a specific event matches its payload type.
  const events: { [K in keyof T]?: Array<Callback<T[K]>> } = {};

  return {
    /**
     * Subscribe to an event.
     * @param eventName The name of the event to subscribe to.
     * @param callback The function to call when the event is emitted.
     */
    on<K extends keyof T>(eventName: K, callback: Callback<T[K]>) {
      if (!events[eventName]) {
        events[eventName] = [];
      }
      events[eventName]?.push(callback);
    },

    /**
     * Unsubscribe from an event.
     * @param eventName The name of the event to unsubscribe from.
     * @param callback The specific callback to remove.
     */
    off<K extends keyof T>(eventName: K, callback: Callback<T[K]>) {
      if (!events[eventName]) {
        return;
      }
      events[eventName] = events[eventName]?.filter(cb => cb !== callback);
    },

    /**
     * Publish an event to all subscribers.
     * @param eventName The name of the event to emit.
     * @param data The data payload that corresponds to the event's type.
     */
    emit<K extends keyof T>(eventName: K, data: T[K]) {
      if (!events[eventName]) {
        return;
      }
      events[eventName]?.forEach(callback => callback(data));
    },
  };
}

// Create and export a singleton instance of the emitter, typed with our AppEvents interface.
export const errorEmitter = createEventEmitter<AppEvents>();

--- FILE: src/firebase/errors.ts ---
'use client';
import { getAuth, type User } from 'firebase/auth';

type SecurityRuleContext = {
  path: string;
  operation: 'get' | 'list' | 'create' | 'update' | 'delete' | 'write';
  requestResourceData?: any;
};

interface FirebaseAuthToken {
  name: string | null;
  email: string | null;
  email_verified: boolean;
  phone_number: string | null;
  sub: string;
  firebase: {
    identities: Record<string, string[]>;
    sign_in_provider: string;
    tenant: string | null;
  };
}

interface FirebaseAuthObject {
  uid: string;
  token: FirebaseAuthToken;
}

interface SecurityRuleRequest {
  auth: FirebaseAuthObject | null;
  method: string;
  path: string;
  resource?: {
    data: any;
  };
}

/**
 * Builds a security-rule-compliant auth object from the Firebase User.
 * @param currentUser The currently authenticated Firebase user.
 * @returns An object that mirrors request.auth in security rules, or null.
 */
function buildAuthObject(currentUser: User | null): FirebaseAuthObject | null {
  if (!currentUser) {
    return null;
  }

  const token: FirebaseAuthToken = {
    name: currentUser.displayName,
    email: currentUser.email,
    email_verified: currentUser.emailVerified,
    phone_number: currentUser.phoneNumber,
    sub: currentUser.uid,
    firebase: {
      identities: currentUser.providerData.reduce((acc, p) => {
        if (p.providerId) {
          acc[p.providerId] = [p.uid];
        }
        return acc;
      }, {} as Record<string, string[]>),
      sign_in_provider: currentUser.providerData[0]?.providerId || 'custom',
      tenant: currentUser.tenantId,
    },
  };

  return {
    uid: currentUser.uid,
    token: token,
  };
}

/**
 * Builds the complete, simulated request object for the error message.
 * It safely tries to get the current authenticated user.
 * @param context The context of the failed Firestore operation.
 * @returns A structured request object.
 */
function buildRequestObject(context: SecurityRuleContext): SecurityRuleRequest {
  let authObject: FirebaseAuthObject | null = null;
  try {
    // Safely attempt to get the current user.
    const firebaseAuth = getAuth();
    const currentUser = firebaseAuth.currentUser;
    if (currentUser) {
      authObject = buildAuthObject(currentUser);
    }
  } catch {
    // This will catch errors if the Firebase app is not yet initialized.
    // In this case, we'll proceed without auth information.
  }

  return {
    auth: authObject,
    method: context.operation,
    path: `/databases/(default)/documents/${context.path}`,
    resource: context.requestResourceData ? { data: context.requestResourceData } : undefined,
  };
}

/**
 * Builds the final, formatted error message for the LLM.
 * @param requestObject The simulated request object.
 * @returns A string containing the error message and the JSON payload.
 */
function buildErrorMessage(requestObject: SecurityRuleRequest): string {
  return `Missing or insufficient permissions: The following request was denied by Firestore Security Rules:
${JSON.stringify(requestObject, null, 2)}`;
}

/**
 * A custom error class designed to be consumed by an LLM for debugging.
 * It structures the error information to mimic the request object
 * available in Firestore Security Rules.
 */
export class FirestorePermissionError extends Error {
  public readonly request: SecurityRuleRequest;

  constructor(context: SecurityRuleContext) {
    const requestObject = buildRequestObject(context);
    super(buildErrorMessage(requestObject));
    this.name = 'FirebaseError';
    this.request = requestObject;
  }
}

--- FILE: src/firebase/firestore/use-collection.tsx ---
'use client';

import { useState, useEffect } from 'react';
import {
  Query,
  onSnapshot,
  DocumentData,
  FirestoreError,
  QuerySnapshot,
  CollectionReference,
} from 'firebase/firestore';
import { errorEmitter } from '@/firebase/error-emitter';
import { FirestorePermissionError } from '@/firebase/errors';

/** Utility type to add an 'id' field to a given type T. */
export type WithId<T> = T & { id: string };

/**
 * Interface for the return value of the useCollection hook.
 * @template T Type of the document data.
 */
export interface UseCollectionResult<T> {
  data: WithId<T>[] | null; // Document data with ID, or null.
  isLoading: boolean;       // True if loading.
  error: FirestoreError | Error | null; // Error object, or null.
}

/* Internal implementation of Query:
  https://github.com/firebase/firebase-js-sdk/blob/c5f08a9bc5da0d2b0207802c972d53724ccef055/packages/firestore/src/lite-api/reference.ts#L143
*/
export interface InternalQuery extends Query<DocumentData> {
  _query: {
    path: {
      canonicalString(): string;
      toString(): string;
    }
  }
}

/**
 * React hook to subscribe to a Firestore collection or query in real-time.
 * Handles nullable references/queries.
 * 
 *
 * IMPORTANT! YOU MUST MEMOIZE the inputted memoizedTargetRefOrQuery or BAD THINGS WILL HAPPEN
 * use useMemo to memoize it per React guidence.  Also make sure that it's dependencies are stable
 * references
 *  
 * @template T Optional type for document data. Defaults to any.
 * @param {CollectionReference<DocumentData> | Query<DocumentData> | null | undefined} targetRefOrQuery -
 * The Firestore CollectionReference or Query. Waits if null/undefined.
 * @returns {UseCollectionResult<T>} Object with data, isLoading, error.
 */
export function useCollection<T = any>(
    memoizedTargetRefOrQuery: ((CollectionReference<DocumentData> | Query<DocumentData>) & {__memo?: boolean})  | null | undefined,
): UseCollectionResult<T> {
  type ResultItemType = WithId<T>;
  type StateDataType = ResultItemType[] | null;

  const [data, setData] = useState<StateDataType>(null);
  const [isLoading, setIsLoading] = useState<boolean>(false);
  const [error, setError] = useState<FirestoreError | Error | null>(null);

  useEffect(() => {
    if (!memoizedTargetRefOrQuery) {
      setData(null);
      setIsLoading(false);
      setError(null);
      return;
    }

    setIsLoading(true);
    setError(null);

    // Directly use memoizedTargetRefOrQuery as it's assumed to be the final query
    const unsubscribe = onSnapshot(
      memoizedTargetRefOrQuery,
      (snapshot: QuerySnapshot<DocumentData>) => {
        const results: ResultItemType[] = [];
        for (const doc of snapshot.docs) {
          results.push({ ...(doc.data() as T), id: doc.id });
        }
        setData(results);
        setError(null);
        setIsLoading(false);
      },
      (error: FirestoreError) => {
        // This logic extracts the path from either a ref or a query
        const path: string =
          memoizedTargetRefOrQuery.type === 'collection'
            ? (memoizedTargetRefOrQuery as CollectionReference).path
            : (memoizedTargetRefOrQuery as unknown as InternalQuery)._query.path.canonicalString()

        const contextualError = new FirestorePermissionError({
          operation: 'list',
          path,
        })

        setError(contextualError)
        setData(null)
        setIsLoading(false)

        // trigger global error propagation
        errorEmitter.emit('permission-error', contextualError);
      }
    );

    return () => unsubscribe();
  }, [memoizedTargetRefOrQuery]); // Re-run if the target query/reference changes.
  if(memoizedTargetRefOrQuery && !memoizedTargetRefOrQuery.__memo) {
    throw new Error(memoizedTargetRefOrQuery + ' was not properly memoized using useMemoFirebase');
  }
  return { data, isLoading, error };
}
--- FILE: src/firebase/firestore/use-doc.tsx ---
'use client';
    
import { useState, useEffect } from 'react';
import {
  DocumentReference,
  onSnapshot,
  DocumentData,
  FirestoreError,
  DocumentSnapshot,
} from 'firebase/firestore';
import { errorEmitter } from '@/firebase/error-emitter';
import { FirestorePermissionError } from '@/firebase/errors';

/** Utility type to add an 'id' field to a given type T. */
type WithId<T> = T & { id: string };

/**
 * Interface for the return value of the useDoc hook.
 * @template T Type of the document data.
 */
export interface UseDocResult<T> {
  data: WithId<T> | null; // Document data with ID, or null.
  isLoading: boolean;       // True if loading.
  error: FirestoreError | Error | null; // Error object, or null.
}

/**
 * React hook to subscribe to a single Firestore document in real-time.
 * Handles nullable references.
 * 
 * IMPORTANT! YOU MUST MEMOIZE the inputted memoizedTargetRefOrQuery or BAD THINGS WILL HAPPEN
 * use useMemo to memoize it per React guidence.  Also make sure that it's dependencies are stable
 * references
 *
 *
 * @template T Optional type for document data. Defaults to any.
 * @param {DocumentReference<DocumentData> | null | undefined} docRef -
 * The Firestore DocumentReference. Waits if null/undefined.
 * @returns {UseDocResult<T>} Object with data, isLoading, error.
 */
export function useDoc<T = any>(
  memoizedDocRef: DocumentReference<DocumentData> | null | undefined,
): UseDocResult<T> {
  type StateDataType = WithId<T> | null;

  const [data, setData] = useState<StateDataType>(null);
  const [isLoading, setIsLoading] = useState<boolean>(false);
  const [error, setError] = useState<FirestoreError | Error | null>(null);

  useEffect(() => {
    if (!memoizedDocRef) {
      setData(null);
      setIsLoading(false);
      setError(null);
      return;
    }

    setIsLoading(true);
    setError(null);
    // Optional: setData(null); // Clear previous data instantly

    const unsubscribe = onSnapshot(
      memoizedDocRef,
      (snapshot: DocumentSnapshot<DocumentData>) => {
        if (snapshot.exists()) {
          setData({ ...(snapshot.data() as T), id: snapshot.id });
        } else {
          // Document does not exist
          setData(null);
        }
        setError(null); // Clear any previous error on successful snapshot (even if doc doesn't exist)
        setIsLoading(false);
      },
      (error: FirestoreError) => {
        const contextualError = new FirestorePermissionError({
          operation: 'get',
          path: memoizedDocRef.path,
        })

        setError(contextualError)
        setData(null)
        setIsLoading(false)

        // trigger global error propagation
        errorEmitter.emit('permission-error', contextualError);
      }
    );

    return () => unsubscribe();
  }, [memoizedDocRef]); // Re-run if the memoizedDocRef changes.

  return { data, isLoading, error };
}
--- FILE: src/firebase/index.ts ---
'use client';

import { firebaseConfig } from '@/firebase/config';
import { initializeApp, getApps, getApp, FirebaseApp } from 'firebase/app';
import { getAuth } from 'firebase/auth';
import { getFirestore } from 'firebase/firestore'

// IMPORTANT: DO NOT MODIFY THIS FUNCTION
export function initializeFirebase() {
  if (!getApps().length) {
    // Important! initializeApp() is called without any arguments because Firebase App Hosting
    // integrates with the initializeApp() function to provide the environment variables needed to
    // populate the FirebaseOptions in production. It is critical that we attempt to call initializeApp()
    // without arguments.
    let firebaseApp;
    try {
      // Attempt to initialize via Firebase App Hosting environment variables
      firebaseApp = initializeApp();
    } catch (e) {
      // Only warn in production because it's normal to use the firebaseConfig to initialize
      // during development
      if (process.env.NODE_ENV === "production") {
        console.warn('Automatic initialization failed. Falling back to firebase config object.', e);
      }
      firebaseApp = initializeApp(firebaseConfig);
    }

    return getSdks(firebaseApp);
  }

  // If already initialized, return the SDKs with the already initialized App
  return getSdks(getApp());
}

export function getSdks(firebaseApp: FirebaseApp) {
  return {
    firebaseApp,
    auth: getAuth(firebaseApp),
    firestore: getFirestore(firebaseApp)
  };
}

export * from './provider';
export * from './client-provider';
export * from './firestore/use-collection';
export * from './firestore/use-doc';
export * from './non-blocking-updates';
export * from './non-blocking-login';
export * from './errors';
export * from './error-emitter';

--- FILE: src/firebase/non-blocking-login.tsx ---

'use client';
import {
  Auth,
  GoogleAuthProvider,
  signInAnonymously,
  signInWithPopup,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  RecaptchaVerifier,
  signInWithPhoneNumber,
  ConfirmationResult,
  UserCredential,
} from 'firebase/auth';

/** Initiate anonymous sign-in (non-blocking). */
export async function initiateAnonymousSignIn(authInstance: Auth): Promise<UserCredential> {
  return signInAnonymously(authInstance);
}

/** Initiate email/password sign-up (non-blocking). */
export async function initiateEmailSignUp(authInstance: Auth, email: string, password: string): Promise<UserCredential> {
  return createUserWithEmailAndPassword(authInstance, email, password);
}

/** Initiate email/password sign-in (non-blocking). */
export async function initiateEmailSignIn(authInstance: Auth, email: string, password: string): Promise<UserCredential> {
  return signInWithEmailAndPassword(authInstance, email, password);
}

/** Initiate Google sign-in with a popup (non-blocking). */
export function initiateGoogleSignIn(authInstance: Auth): void {
  const provider = new GoogleAuthProvider();
  signInWithPopup(authInstance, provider).catch(error => {
    if (error.code !== 'auth/popup-closed-by-user') {
      console.error('Google Sign-In Error:', error);
    } else {
      console.info('Google Sign-In popup closed by user.');
    }
  });
}


/**
 * Initiates phone number sign-in.
 * @param authInstance The Firebase Auth instance.
 * @param phoneNumber The user's phone number in E.164 format.
 * @param appVerifier The RecaptchaVerifier instance.
 * @returns A Promise that resolves with a ConfirmationResult object.
 */
export async function initiatePhoneNumberSignIn(
  authInstance: Auth,
  phoneNumber: string,
  appVerifier: RecaptchaVerifier
): Promise<ConfirmationResult> {
  return signInWithPhoneNumber(authInstance, phoneNumber, appVerifier);
}

/**
 * Confirms the OTP code sent to the user's phone. This is now a blocking call.
 * @param confirmationResult The ConfirmationResult object from initiatePhoneNumberSignIn.
 * @param otpCode The 6-digit OTP code entered by the user.
 * @returns A Promise that resolves with the UserCredential on successful sign-in.
 */
export async function confirmOtpCode(
  confirmationResult: ConfirmationResult,
  otpCode: string
): Promise<UserCredential> {
  // CRITICAL: This must be awaited to verify the code before proceeding.
  return await confirmationResult.confirm(otpCode);
}

--- FILE: src/firebase/non-blocking-updates.tsx ---

'use client';
    
import {
  setDoc,
  addDoc,
  updateDoc,
  deleteDoc,
  CollectionReference,
  DocumentReference,
  SetOptions,
  runTransaction,
  writeBatch,
} from 'firebase/firestore';
import { errorEmitter } from '@/firebase/error-emitter';
import {FirestorePermissionError} from '@/firebase/errors';

/**
 * Initiates a setDoc operation for a document reference.
 * Does NOT await the write operation internally.
 */
export function setDocumentNonBlocking(docRef: DocumentReference, data: any, options: SetOptions) {
  setDoc(docRef, data, options).catch(error => {
    errorEmitter.emit(
      'permission-error',
      new FirestorePermissionError({
        path: docRef.path,
        operation: 'write', // or 'create'/'update' based on options
        requestResourceData: data,
      })
    )
  })
  // Execution continues immediately
}


/**
 * Initiates an addDoc operation for a collection reference.
 * Does NOT await the write operation internally.
 * Returns the Promise for the new doc ref, but typically not awaited by caller.
 */
export function addDocumentNonBlocking(colRef: CollectionReference, data: any) {
  const promise = addDoc(colRef, data)
    .catch(error => {
      errorEmitter.emit(
        'permission-error',
        new FirestorePermissionError({
          path: colRef.path,
          operation: 'create',
          requestResourceData: data,
        })
      )
    });
  return promise;
}


/**
 * Initiates an updateDoc operation for a document reference.
 * Does NOT await the write operation internally.
 */
export function updateDocumentNonBlocking(docRef: DocumentReference, data: any) {
  updateDoc(docRef, data)
    .catch(error => {
      errorEmitter.emit(
        'permission-error',
        new FirestorePermissionError({
          path: docRef.path,
          operation: 'update',
          requestResourceData: data,
        })
      )
    });
}


/**
 * Initiates a deleteDoc operation for a document reference.
 * Does NOT await the write operation internally.
 */
export function deleteDocumentNonBlocking(docRef: DocumentReference) {
  deleteDoc(docRef)
    .catch(error => {
      errorEmitter.emit(
        'permission-error',
        new FirestorePermissionError({
          path: docRef.path,
          operation: 'delete',
        })
      )
    });
}

--- FILE: src/firebase/provider.tsx ---

'use client';

import React, { DependencyList, createContext, useContext, ReactNode, useMemo, useState, useEffect } from 'react';
import { FirebaseApp } from 'firebase/app';
import { Firestore, doc, getDoc, setDoc } from 'firebase/firestore';
import { Auth, User, onAuthStateChanged } from 'firebase/auth';
import { FirebaseErrorListener } from '@/components/FirebaseErrorListener'

interface FirebaseProviderProps {
  children: ReactNode;
  firebaseApp: FirebaseApp;
  firestore: Firestore;
  auth: Auth;
}

// Internal state for user authentication
interface UserAuthState {
  user: User | null;
  isUserLoading: boolean;
  userError: Error | null;
  userData: any | null; // Add userData state
  isUserDataLoading: boolean; // Add userData loading state
}


// Combined state for the Firebase context
export interface FirebaseContextState {
  areServicesAvailable: boolean; // True if core services (app, firestore, auth instance) are provided
  firebaseApp: FirebaseApp | null;
  firestore: Firestore | null;
  auth: Auth | null; // The Auth service instance
  // User authentication state
  user: User | null;
  isUserLoading: boolean; // True during initial auth check
  userError: Error | null; // Error from auth listener
  userData: any | null;
  isUserDataLoading: boolean;
}

// Return type for useFirebase()
export interface FirebaseServicesAndUser {
  firebaseApp: FirebaseApp;
  firestore: Firestore;
  auth: Auth;
  user: User | null;
  isUserLoading: boolean;
  userError: Error | null;
  userData: any | null;
  isUserDataLoading: boolean;
}

// Return type for useUser() - specific to user auth state
export interface UserHookResult { 
  user: User | null;
  isUserLoading: boolean;
  userError: Error | null;
  userData: any | null;
  isUserDataLoading: boolean;
}

// React Context
export const FirebaseContext = createContext<FirebaseContextState | undefined>(undefined);

/**
 * FirebaseProvider manages and provides Firebase services and user authentication state.
 */
export const FirebaseProvider: React.FC<FirebaseProviderProps> = ({
  children,
  firebaseApp,
  firestore,
  auth,
}) => {
  const [userAuthState, setUserAuthState] = useState<UserAuthState>({
    user: null,
    isUserLoading: true, // Start loading until first auth event
    userError: null,
    userData: null,
    isUserDataLoading: true,
  });

  // Effect to subscribe to Firebase auth state changes
  useEffect(() => {
    if (!auth) { 
      setUserAuthState({ user: null, isUserLoading: false, userError: new Error("Auth service not provided."), userData: null, isUserDataLoading: false });
      return;
    }

    const unsubscribe = onAuthStateChanged(
      auth,
      async (firebaseUser) => { 
        setUserAuthState(prevState => ({...prevState, user: firebaseUser, isUserLoading: false, userError: null}));
        if (firebaseUser) {
          setUserAuthState(prevState => ({...prevState, isUserDataLoading: true}));
          const userRef = doc(firestore, 'users', firebaseUser.uid);
          
          try {
            const userSnap = await getDoc(userRef);
            if (userSnap.exists()) {
              setUserAuthState(prevState => ({...prevState, userData: userSnap.data(), isUserDataLoading: false}));
            } else {
              const newUserDoc = {
                  id: firebaseUser.uid,
                  name: firebaseUser.displayName || firebaseUser.email || 'Anonymous',
                  photoUrl: firebaseUser.photoURL || `https://i.pravatar.cc/150?u=${firebaseUser.uid}`,
                  location: '',
                  walletBalance: 0, 
                  xp: 0,
                  level: 'Rookie',
                  verificationStatus: 'not_started',
                  mobileVerified: !!firebaseUser.phoneNumber,
                  aadharVerified: false,
                  joinDate: new Date().toISOString(),
                  profileCompleted: false, 
                  birthYear: null,
                  appLanguage: 'english',
              };
              await setDoc(userRef, newUserDoc, { merge: true });
              setUserAuthState(prevState => ({...prevState, userData: newUserDoc, isUserDataLoading: false}));
            }
          } catch (e) {
            console.error("Failed to check/create user document:", e);
            setUserAuthState(prevState => ({...prevState, isUserDataLoading: false}));
          }
        } else {
            setUserAuthState(prevState => ({...prevState, user: null, userData: null, isUserDataLoading: false}));
        }
      },
      (error) => {
        console.error("FirebaseProvider: onAuthStateChanged error:", error);
        setUserAuthState({ user: null, isUserLoading: false, userError: error, userData: null, isUserDataLoading: false });
      }
    );
    return () => unsubscribe(); 
  }, [auth, firestore]);

  const contextValue = useMemo((): FirebaseContextState => {
    const servicesAvailable = !!(firebaseApp && firestore && auth);
    return {
      areServicesAvailable: servicesAvailable,
      firebaseApp: servicesAvailable ? firebaseApp : null,
      firestore: servicesAvailable ? firestore : null,
      auth: servicesAvailable ? auth : null,
      ...userAuthState
    };
  }, [firebaseApp, firestore, auth, userAuthState]);

  return (
    <FirebaseContext.Provider value={contextValue}>
      <FirebaseErrorListener />
      {children}
    </FirebaseContext.Provider>
  );
};


export const useFirebase = (): FirebaseServicesAndUser => {
  const context = useContext(FirebaseContext);

  if (context === undefined) {
    throw new Error('useFirebase must be used within a FirebaseProvider.');
  }

  if (!context.areServicesAvailable || !context.firebaseApp || !context.firestore || !context.auth) {
    throw new Error('Firebase core services not available. Check FirebaseProvider props.');
  }

  return {
    firebaseApp: context.firebaseApp,
    firestore: context.firestore,
    auth: context.auth,
    user: context.user,
    isUserLoading: context.isUserLoading,
    userError: context.userError,
    userData: context.userData,
    isUserDataLoading: context.isUserDataLoading,
  };
};

export const useAuth = (): Auth => {
  const { auth } = useFirebase();
  return auth;
};

export const useFirestore = (): Firestore => {
  const { firestore } = useFirebase();
  return firestore;
};

export const useFirebaseApp = (): FirebaseApp => {
  const { firebaseApp } = useFirebase();
  return firebaseApp;
};

type MemoFirebase <T> = T & {__memo?: boolean};

export function useMemoFirebase<T>(factory: () => T, deps: DependencyList): T | (MemoFirebase<T>) {
  const memoized = useMemo(factory, deps);
  
  if(typeof memoized !== 'object' || memoized === null) return memoized;
  (memoized as MemoFirebase<T>).__memo = true;
  
  return memoized;
}

export const useUser = (): UserHookResult => { 
  const { user, isUserLoading, userError, userData, isUserDataLoading } = useFirebase();
  return { user, isUserLoading, userError, userData, isUserDataLoading };
};

--- FILE: src/firestore.rules ---
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // WARNING: This rule is for development only and is completely insecure.
    // It allows anyone (authenticated or not) to read and write to the entire database.
    // You MUST secure your database before going to production.
    match /{document=**} {
      allow read, write: if true;
    }
  }
}

--- FILE: src/hooks/use-copy-to-clipboard.ts ---

'use client';
import { useState } from 'react';

type CopiedValue = string | null;
type CopyFn = (text: string) => Promise<boolean>;

export function useCopyToClipboard(): [CopiedValue, CopyFn] {
  const [copiedText, setCopiedText] = useState<CopiedValue>(null);

  const copy: CopyFn = async (text) => {
    if (!navigator?.clipboard) {
      console.warn('Clipboard not supported');
      return false;
    }

    try {
      await navigator.clipboard.writeText(text);
      setCopiedText(text);
      return true;
    } catch (error) {
      console.warn('Copy failed', error);
      setCopiedText(null);
      return false;
    }
  };

  return [copiedText, copy];
}

--- FILE: src/hooks/use-debounce.ts ---

'use client';
import { useState, useEffect } from 'react';

export function useDebounce<T>(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState<T>(value);

  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => {
      clearTimeout(handler);
    };
  }, [value, delay]);

  return debouncedValue;
}

--- FILE: src/hooks/use-local-storage.ts ---

'use client';
import { useState, useEffect, useCallback } from 'react';

function parseJSON<T>(value: string | null): T | undefined {
  try {
    return value === 'undefined' ? undefined : JSON.parse(value ?? '');
  } catch {
    console.log('parsing error on', { value });
    return undefined;
  }
}

export function useLocalStorage<T>(key: string, initialValue: T): [T, (value: T | ((val: T) => T)) => void] {
  const readValue = useCallback((): T => {
    if (typeof window === 'undefined') {
      return initialValue;
    }

    try {
      const item = window.localStorage.getItem(key);
      return item ? (parseJSON(item) as T) : initialValue;
    } catch (error) {
      console.warn(`Error reading localStorage key “${key}”:`, error);
      return initialValue;
    }
  }, [initialValue, key]);

  const [storedValue, setStoredValue] = useState<T>(readValue);

  const setValue = (value: T | ((val: T) => T)) => {
    if (typeof window === 'undefined') {
      console.warn(
        `Tried setting localStorage key “${key}” even though environment is not a client`,
      );
    }

    try {
      const newValue = value instanceof Function ? value(storedValue) : value;
      window.localStorage.setItem(key, JSON.stringify(newValue));
      setStoredValue(newValue);
      window.dispatchEvent(new Event('local-storage'));
    } catch (error) {
      console.warn(`Error setting localStorage key “${key}”:`, error);
    }
  };

  useEffect(() => {
    setStoredValue(readValue());
  }, [readValue]);

  useEffect(() => {
    const handleStorageChange = () => {
      setStoredValue(readValue());
    };
    window.addEventListener('storage', handleStorageChange);
    window.addEventListener('local-storage', handleStorageChange);
    return () => {
      window.removeEventListener('storage', handleStorageChange);
      window.removeEventListener('local-storage', handleStorageChange);
    };
  }, [readValue]);

  return [storedValue, setValue];
}

--- FILE: src/hooks/use-media-query.ts ---

'use client';
import { useState, useEffect } from 'react';

export function useMediaQuery(query: string): boolean {
  const [matches, setMatches] = useState<boolean>(false);

  useEffect(() => {
    if (typeof window === 'undefined') return;
    
    const mediaQueryList = window.matchMedia(query);
    const listener = (event: MediaQueryListEvent) => setMatches(event.matches);

    setMatches(mediaQueryList.matches);
    
    mediaQueryList.addEventListener('change', listener);
    
    return () => {
      mediaQueryList.removeEventListener('change', listener);
    };
  }, [query]);

  return matches;
}

--- FILE: src/hooks/use-mobile.tsx ---
import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    if (typeof window === 'undefined') {
      setIsMobile(false);
      return;
    }
    
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return isMobile
}

--- FILE: src/hooks/use-toast.ts ---
"use client"

// Inspired by react-hot-toast library
import * as React from "react"

import type {
  ToastActionElement,
  ToastProps,
} from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      variant: props.variant || 'blur-blue', // Set default variant
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }

--- FILE: src/lib/placeholder-images.json ---
{
  "placeholderImages": [
    {
      "id": "user1",
      "description": "Avatar of Sarah",
      "imageUrl": "https://images.unsplash.com/photo-1592621385612-4d7129426394?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHwzfHx3b21hbiUyMHBvcnRyYWl0fGVufDB8fHx8MTc2MzgzNjUwNXww&ixlib=rb-4.1.0&q=80&w=1080",
      "imageHint": "woman portrait"
    },
    {
      "id": "user2",
      "description": "Avatar of Mike",
      "imageUrl": "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHw1fHxtYW4lMjBwb3J0cmFpdHxlbnwwfHx8fDE3NjM4MDkyNTJ8MA&ixlib=rb-4.1.0&q=80&w=1080",
      "imageHint": "man portrait"
    },
    {
      "id": "user3",
      "description": "Avatar of Jenny",
      "imageUrl": "https://images.unsplash.com/photo-1711645169736-53327e726205?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHw0fHx3b21hbiUyMHNtaWxpbmd8ZW58MHx8fHwxNzYzODE0MjEwfDA&ixlib=rb-4.1.0&q=80&w=1080",
      "imageHint": "woman smiling"
    },
    {
      "id": "user4",
      "description": "Avatar of David",
      "imageUrl": "https://images.unsplash.com/photo-1714356333088-45a9ba618365?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHwxMHx8bWFuJTIwZ2xhc3Nlc3xlbnwwfHx8fDE3NjM4NDY4NDZ8MA&ixlib=rb-4.1.0&q=80&w=1080",
      "imageHint": "man glasses"
    },
    {
      "id": "user5",
      "description": "Avatar of a user",
      "imageUrl": "https://images.unsplash.com/photo-1521119989659-a83eee488004?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHw5fHxwZXJzb24lMjBwb3J0cmFpdHxlbnwwfHx8fDE3NjM4NDAwOTZ8MA&ixlib=rb-4.1.0&q=80&w=1080",
      "imageHint": "person portrait"
    },
    {
      "id": "story1",
      "description": "Urgent task highlight",
      "imageUrl": "https://images.unsplash.com/photo-1762805080882-84c2d3855963?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHwyfHx1cmdlbnQlMjBhbGVydHxlbnwwfHx8fDE3NjM4NjI2ODZ8MA&ixlib=rb-4.1.0&q=80&w=1080",
      "imageHint": "urgent alert"
    },
    {
      "id": "story2",
      "description": "Top buddies highlight",
      "imageUrl": "https://images.unsplash.com/photo-1581094273788-cba84678c0a3?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHwyfHx0ZWFtd29yayUyMHN1Y2Nlc3N8ZW58MHx8fHwxNzYzODYyNjg2fDA&ixlib=rb-4.1.0&q=80&w=1080",
      "imageHint": "teamwork success"
    },
    {
      "id": "story3",
      "description": "Safety tips highlight",
      "imageUrl": "https://images.unsplash.com/photo-1623906841898-d6a7dc0204f5?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHw1fHxzYWZldHklMjBzaGllbGR8ZW58MHx8fHwxNzYzODYyNjg2fDA&ixlib=rb-4.1.0&q=80&w=1080",
      "imageHint": "safety shield"
    },
    {
      "id": "task_household",
      "description": "A clean living room",
      "imageUrl": "https://images.unsplash.com/photo-1576697133123-675aa93f3e28?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHwyfHxjbGVhbiUyMGxpdmluZ3Jvb218ZW58MHx8fHwxNzYzNzc1MTY2fDA&ixlib=rb-4.1.0&q=80&w=1080",
      "imageHint": "clean livingroom"
    },
    {
      "id": "task_tech",
      "description": "A person repairing a laptop",
      "imageUrl": "https://images.unsplash.com/photo-1658240527554-9cf987b4de49?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHwxfHxsYXB0b3AlMjByZXBhaXJ8ZW58MHx8fHwxNzYzODYyNjg2fDA&ixlib=rb-4.1.0&q=80&w=1080",
      "imageHint": "laptop repair"
    },
    {
      "id": "task_delivery",
      "description": "A delivery package",
      "imageUrl": "https://images.unsplash.com/photo-1758523670564-d1d6a734dc0b?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHw2fHxkZWxpdmVyeSUyMHBhY2thZ2V8ZW58MHx8fHwxNzYzODI3NzMwfDA&ixlib=rb-4.1.0&q=80&w=1080",
      "imageHint": "delivery package"
    },
    {
      "id": "task_tutor",
      "description": "A person tutoring a student",
      "imageUrl": "https://images.unsplash.com/photo-1629360057380-18b15b42e650?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHw1fHx0dXRvcmluZyUyMHN0dWRlbnR8ZW58MHx8fHwxNzYzODI2MjM2fDA&ixlib=rb-4.1.0&q=80&w=1080",
      "imageHint": "tutoring student"
    },
    {
      "id": "task_cleaning",
      "description": "Cleaning supplies",
      "imageUrl": "https://images.unsplash.com/photo-1583947215259-38e31be8751f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHwzfHxjbGVhbmluZyUyMHN1cHBsaWVzfGVufDB8fHx8MTc2Mzg2MDg1OXww&ixlib=rb-4.1.0&q=80&w=1080",
      "imageHint": "cleaning supplies"
    },
    {
      "id": "profile_hero",
      "description": "Profile hero background",
      "imageUrl": "https://images.unsplash.com/photo-1604076913837-52ab5629fba9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHw2fHxhYnN0cmFjdCUyMGdyYWRpZW50fGVufDB8fHx8MTc2Mzg1OTk1OXww&ixlib=rb-4.1.0&q=80&w=1080",
      "imageHint": "abstract gradient"
    }
  ]
}
--- FILE: src/lib/placeholder-images.ts ---
import data from './placeholder-images.json';

export type ImagePlaceholder = {
  id: string;
  description: string;
  imageUrl: string;
  imageHint: string;
};

export const PlaceHolderImages: ImagePlaceholder[] = data.placeholderImages;

--- FILE: src/lib/utils.ts ---

import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

export function sleep(ms: number): Promise<void> {
  return new Promise(resolve => setTimeout(resolve, ms));
}

export function getRandomNumber(min: number, max: number): number {
  return Math.random() * (max - min) + min;
}

export function capitalize(str: string): string {
  if (typeof str !== 'string' || str.length === 0) {
    return str;
  }
  return str.charAt(0).toUpperCase() + str.slice(1);
}

export function truncate(str: string, length: number, suffix: string = '...'): string {
  if (typeof str !== 'string' || str.length <= length) {
    return str;
  }
  return str.slice(0, length) + suffix;
}

export function isEmpty(value: any): boolean {
  if (value === null || value === undefined) {
    return true;
  }
  if (Array.isArray(value) || typeof value === 'string') {
    return value.length === 0;
  }
  if (typeof value === 'object' && Object.keys(value).length === 0) {
    return true;
  }
  return false;
}

export function formatCurrency(amount: number, currency: string = 'INR', locale: string = 'en-IN'): string {
    if (typeof amount !== 'number') {
        return String(amount);
    }
  try {
    return new Intl.NumberFormat(locale, {
      style: 'currency',
      currency: currency,
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(amount);
  } catch (error) {
    console.error("Currency formatting failed:", error);
    return `${currency} ${amount}`;
  }
}

export function debounce<T extends (...args: any[]) => any>(func: T, delay: number): (...args: Parameters<T>) => void {
  let timeoutId: ReturnType<typeof setTimeout>;
  return function(this: ThisParameterType<T>, ...args: Parameters<T>) {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => {
      func.apply(this, args);
    }, delay);
  };
}

export function throttle<T extends (...args: any[]) => void>(func: T, limit: number): (...args: Parameters<T>) => void {
  let inThrottle: boolean;
  let lastResult: any;

  return function(this: ThisParameterType<T>, ...args: Parameters<T>) {
    if (!inThrottle) {
      inThrottle = true;
      setTimeout(() => (inThrottle = false), limit);
      lastResult = func.apply(this, args);
    }
    return lastResult;
  };
}

export function uniqueId(prefix: string = 'uid_'): string {
  if (typeof window !== 'undefined' && window.crypto && window.crypto.randomUUID) {
    return `${prefix}${window.crypto.randomUUID()}`;
  }
  return `${prefix}${Date.now().toString(36)}_${Math.random().toString(36).substr(2, 9)}`;
}

export function groupBy<T extends Record<string, any>>(array: T[], key: keyof T | ((item: T) => string)): Record<string, T[]> {
  return array.reduce((result, currentValue) => {
    const groupKey = typeof key === 'function' ? key(currentValue) : currentValue[key];
    (result[groupKey] = result[groupKey] || []).push(currentValue);
    return result;
  }, {} as Record<string, T[]>);
}

export function clamp(num: number, min: number, max: number): number {
  return Math.min(Math.max(num, min), max);
}

export function lerp(start: number, end: number, amount: number): number {
  return (1 - amount) * start + amount * end;
}

export function formatDate(date: Date | string, locale: string = 'en-US'): string {
  const d = typeof date === 'string' ? new Date(date) : date;
  return d.toLocaleDateString(locale, {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  });
}

export function parseQueryString(queryString: string): Record<string, string> {
  if (queryString.startsWith('?')) {
    queryString = queryString.substring(1);
  }
  return queryString.split('&').reduce((acc, pair) => {
    const [key, value] = pair.split('=');
    if (key) {
      acc[decodeURIComponent(key)] = decodeURIComponent(value || '');
    }
    return acc;
  }, {} as Record<string, string>);
}

export function stringifyQueryParams(params: Record<string, any>): string {
  return Object.keys(params)
    .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
    .join('&');
}

export const localStorageManager = {
  getItem<T>(key: string): T | null {
    if (typeof window === 'undefined') return null;
    const item = window.localStorage.getItem(key);
    if (item) {
      try {
        return JSON.parse(item) as T;
      } catch (e) {
        console.error(`Error parsing localStorage item "${key}":`, e);
        return null;
      }
    }
    return null;
  },
  setItem<T>(key: string, value: T): void {
    if (typeof window === 'undefined') return;
    try {
      const serializedValue = JSON.stringify(value);
      window.localStorage.setItem(key, serializedValue);
    } catch (e) {
      console.error(`Error setting localStorage item "${key}":`, e);
    }
  },
  removeItem(key: string): void {
    if (typeof window === 'undefined') return;
    window.localStorage.removeItem(key);
  }
};

export function getReadingTime(text: string, wordsPerMinute: number = 200): number {
    if (!text) return 0;
    const words = text.trim().split(/\s+/).length;
    return Math.ceil(words / wordsPerMinute);
}

export function escapeHtml(str: string): string {
    return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}

export function getInitials(name: string): string {
  if (!name) return '';
  const parts = name.split(' ');
  if (parts.length > 1) {
    return `${parts[0][0]}${parts[parts.length - 1][0]}`.toUpperCase();
  }
  return name.substring(0, 2).toUpperCase();
}

export function timeAgo(date: Date | string): string {
  const d = typeof date === 'string' ? new Date(date) : date;
  const now = new Date();
  const seconds = Math.floor((now.getTime() - d.getTime()) / 1000);

  let interval = seconds / 31536000;
  if (interval > 1) return `${Math.floor(interval)} years ago`;

  interval = seconds / 2592000;
  if (interval > 1) return `${Math.floor(interval)} months ago`;

  interval = seconds / 86400;
  if (interval > 1) return `${Math.floor(interval)} days ago`;

  interval = seconds / 3600;
  if (interval > 1) return `${Math.floor(interval)} hours ago`;
  
  interval = seconds / 60;
  if (interval > 1) return `${Math.floor(interval)} minutes ago`;

  return `${Math.floor(seconds)} seconds ago`;
}

export function isEmail(email: string): boolean {
  const re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
  return re.test(String(email).toLowerCase());
}

export function isStrongPassword(password: string): boolean {
  const re = new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*])(?=.{8,})");
  return re.test(password);
}

export function createPagination<T>(items: T[], page: number, perPage: number): T[] {
  const start = (page - 1) * perPage;
  const end = start + perPage;
  return items.slice(start, end);
}

export function generateRandomColor(): string {
  return `#${Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0')}`;
}

export function copyToClipboard(text: string): Promise<void> {
  if (navigator.clipboard) {
    return navigator.clipboard.writeText(text);
  }
  return new Promise((resolve, reject) => {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    textArea.style.position = "fixed";
    textArea.style.opacity = "0";
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    try {
      document.execCommand('copy');
      resolve();
    } catch (err) {
      reject(err);
    }
    document.body.removeChild(textArea);
  });
}

export function getCookie(name: string): string | null {
  if (typeof document === 'undefined') return null;
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) {
    return parts.pop()?.split(';').shift() || null;
  }
  return null;
}

export function setCookie(name: string, value: string, days: number): void {
  if (typeof document === 'undefined') return;
  let expires = "";
  if (days) {
    const date = new Date();
    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
    expires = `; expires=${date.toUTCString()}`;
  }
  document.cookie = `${name}=${value || ""}${expires}; path=/`;
}

export function removeCookie(name: string): void {
  if (typeof document === 'undefined') return;
  document.cookie = `${name}=; Max-Age=-99999999;`;
}

export function isBrowser(): boolean {
  return typeof window !== 'undefined';
}

export function animateValue(obj: HTMLElement, start: number, end: number, duration: number): void {
  let startTimestamp: number | null = null;
  const step = (timestamp: number) => {
    if (!startTimestamp) startTimestamp = timestamp;
    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
    obj.innerHTML = Math.floor(progress * (end - start) + start).toString();
    if (progress < 1) {
      window.requestAnimationFrame(step);
    }
  };
  window.requestAnimationFrame(step);
}

    
--- FILE: tailwind.config.ts ---
import type { Config } from 'tailwindcss';

export default {
  darkMode: ['class'],
  content: [
    './src/pages/**/*.{js,ts,jsx,tsx,mdx}',
    './src/components/**/*.{js,ts,jsx,tsx,mdx}',
    './src/app/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      fontFamily: {
        sans: ['var(--font-sans)', 'sans-serif'],
      },
      colors: {
        border: 'hsl(var(--border))',
        input: 'hsl(var(--input))',
        ring: 'hsl(var(--ring))',
        background: 'transparent',
        foreground: 'hsl(var(--foreground))',
        primary: {
          DEFAULT: 'hsl(var(--primary))',
          foreground: 'hsl(var(--primary-foreground))',
        },
        secondary: {
          DEFAULT: 'hsl(var(--secondary))',
          foreground: 'hsl(var(--secondary-foreground))',
        },
        destructive: {
          DEFAULT: 'hsl(var(--destructive))',
          foreground: 'hsl(var(--destructive-foreground))',
        },
        muted: {
          DEFAULT: 'hsl(var(--muted))',
          foreground: 'hsl(var(--muted-foreground))',
        },
        accent: {
          DEFAULT: 'hsl(var(--accent))',
          foreground: 'hsl(var(--accent-foreground))',
        },
        popover: {
          DEFAULT: 'hsl(var(--popover))',
          foreground: 'hsl(var(--popover-foreground))',
        },
        card: {
          DEFAULT: 'hsl(var(--card))',
          foreground: 'hsl(var(--card-foreground))',
        },
        'main-accent': 'var(--main-accent)',
        'secondary-accent': 'var(--secondary-accent)',
        'highlight': 'var(--highlight)',
        'destructive-accent': 'var(--destructive-accent)',
      },
      borderRadius: {
        lg: '24px',
        md: '20px',
        sm: '16px',
      },
      boxShadow: {
        'glow-main': '0 0 20px var(--main-accent)',
      },
      keyframes: {
        'accordion-down': {
          from: { height: '0' },
          to: { height: 'var(--radix-accordion-content-height)' },
        },
        'accordion-up': {
          from: { height: 'var(--radix-accordion-content-height)' },
          to: { height: '0' },
        },
      },
      animation: {
        'accordion-down': 'accordion-down 0.2s ease-out',
        'accordion-up': 'accordion-up 0.2s ease-out',
      },
    },
  },
  plugins: [require('tailwindcss-animate')],
} satisfies Config;

--- FILE: tsconfig.json ---
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
